<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Unity中的Lua | 糖果AIGC实验室-LUA</title><meta name="author" content="糖果AIGC实验室 备案:辽ICP备16003836号-5"><meta name="copyright" content="糖果AIGC实验室 备案:辽ICP备16003836号-5"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="文章目錄 	&lt;&#x2F;div&gt; 	 	&lt;p&gt;结合以前的初步学习了解，这一次要对Lua进行进一步的深入学习。&lt;&#x2F;p&gt;  首先我们要知道Lua是脚本语言，是有自己的虚拟机，是解析执行而非像C#,C++,Java这些编译执行。同时Lua是弱类型语言。 这里不更多的讲解Lua虚拟机相关概念，详情参考http:&#x2F;&#x2F;blog.sina.com.cn&#x2F;s&#x2F;blog_8c7d">
<meta property="og:type" content="article">
<meta property="og:title" content="Unity中的Lua">
<meta property="og:url" content="https://lua.ren/zl/2016-01-01-677_Unity%E4%B8%AD%E7%9A%84Lua/index.html">
<meta property="og:site_name" content="糖果AIGC实验室-LUA">
<meta property="og:description" content="文章目錄 	&lt;&#x2F;div&gt; 	 	&lt;p&gt;结合以前的初步学习了解，这一次要对Lua进行进一步的深入学习。&lt;&#x2F;p&gt;  首先我们要知道Lua是脚本语言，是有自己的虚拟机，是解析执行而非像C#,C++,Java这些编译执行。同时Lua是弱类型语言。 这里不更多的讲解Lua虚拟机相关概念，详情参考http:&#x2F;&#x2F;blog.sina.com.cn&#x2F;s&#x2F;blog_8c7d">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg">
<meta property="article:published_time" content="2024-04-03T03:47:35.907Z">
<meta property="article:modified_time" content="2024-04-03T03:47:35.910Z">
<meta property="article:author" content="糖果AIGC实验室 备案:辽ICP备16003836号-5">
<meta property="article:tag" content="lua文章">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://lua.ren/zl/2016-01-01-677_Unity%E4%B8%AD%E7%9A%84Lua/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?14cc93bf3f08d31c458639d309dde522";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();



</script><script>(function () {
  var meta = document.createElement('meta');
  meta.content = 'no-referrer';
  meta.name = 'referrer';
  document.getElementsByTagName('head')[0].appendChild(meta);
})();</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"OCGZTJTHCQ","apiKey":"4dede33603574dcaed0e9d4641849158","indexName":"jianpan.vip","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Unity中的Lua',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-03 11:47:35'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">1769</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">195</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">96</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清單</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="糖果AIGC实验室-LUA"><span class="site-name">糖果AIGC实验室-LUA</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清單</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">Unity中的Lua</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-04-03T03:47:35.907Z" title="发表于 2024-04-03 11:47:35">2024-04-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-04-03T03:47:35.910Z" title="更新于 2024-04-03 11:47:35">2024-04-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/topic/">topic</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Unity中的Lua"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><div id="toc" class="toc-article">
			<strong class="toc-title">文章目錄</strong>
<pre><code>	&lt;/div&gt;
	
	&lt;p&gt;结合以前的初步学习了解，这一次要对Lua进行进一步的深入学习。&lt;/p&gt;
</code></pre>
<p>首先我们要知道Lua是脚本语言，是有自己的虚拟机，是解析执行而非像C#,C++,Java这些编译执行。同时Lua是弱类型语言。</p>
<p>这里不更多的讲解Lua虚拟机相关概念，详情参考<a href="Scripting System">http://blog.sina.com.cn/s/blog_8c7d49f20102uzsx.html</a><br/><img src="https://TonyTang1990.github.io//img/Lua/Virtual_Machine_Working_Levels.PNG" alt="Virtual_Machine_Working_Levels"/><br/>这里只要知道Lua的虚拟机(程序模拟线程，堆栈等)是运行在程序里而非物理CPU上，因此只要虚拟机把Lua脚本解析成对应平台的机器码就能支持跨平台(好比Java的JVM)。</p>
<h1 id="Lua_Study">Lua Study</h1><p>以前的部分学习参考:<br/><a href="http://blog.sina.com.cn/s/blog_8c7d49f20102uzsx.html" target="_blank" rel="external noopener noreferrer">Scripting System &amp; Lua Study</a><br/><a href="http://blog.sina.com.cn/s/blog_8c7d49f20102v0rk.html" target="_blank" rel="external noopener noreferrer">Lua — some important concept and knowledge</a><br/><a href="http://blog.sina.com.cn/s/blog_8c7d49f20102v0zp.html" target="_blank" rel="external noopener noreferrer">Lua - C API </a><br/><a href="http://blog.sina.com.cn/s/blog_8c7d49f20102v0zs.html" target="_blank" rel="external noopener noreferrer">Lua - C call Lua &amp; Lua call C</a><br/><a href="http://blog.sina.com.cn/s/blog_8c7d49f20102v0s9.html" target="_blank" rel="external noopener noreferrer">Lua - Object Oriented Programming</a><br/><a href="http://blog.sina.com.cn/s/blog_8c7d49f20102v1qg.html" target="_blank" rel="external noopener noreferrer">Lua - Userdata</a><br/><a href="http://blog.sina.com.cn/s/blog_8c7d49f20102v383.html" target="_blank" rel="external noopener noreferrer">Lua - Managing Resources &amp; Threads and States</a></p>
<h2 id="Weak_Tables_And_Finalizers">Weak Tables And Finalizers</h2><p>“and Finalizers Lua  does  automatic  memory  management. Programs  create  objects  (tables, threads,  etc.),  but  there  is  no  function  to  delete  objects. Lua  automatically deletes  objects that become garbage,  using garbage  collection. “</p>
<p><strong>Weak Table</strong><br/>“Weak tables allow the collection of Lua objects that are still accessible to the program”</p>
<p>“A weak reference is a reference to an object hat is not considered by the garbage collector”</p>
<p>“In weak tables,, both keys and values can be weak”(three kinds of week table:1. weak key 2. weak value 3. weak key and value)</p>
<p>Weak Table Using:</p>
<ol>
<li>释放使用不再使用的缓存数据(memorizing)<br/>Auxiliary table(辅助表),Lua里有类似于C#里的internal hash table用于重用使用过的string和访问结果(C#里主要是使用过的string重用。Lua还能将访问过的string的table结果缓存返回)</li>
</ol>
<p>但Auxiliary table有个缺点就是使用不频繁的string和result会一直被缓存无法释放。weak table正是用于解决这一问题的方案之一。(因为weak table的weak reference一旦不再被使用就会被下一次GC释放)</p>
<ol>
<li><p>Object Attributes Implemetation<br/>Solution: use external table to associate objects with attributes<br/>Drawback: external table reference prevent objects from being collected<br/>Final solution: use weak keys for objects in external table</p>
</li>
<li><p>Tables with Default Values<br/>这里有两种各有优缺点的实现方案：<br/>方案1:</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> defaults = {}</span><br/><span class="line"><span class="built_in">setmetatable</span>(defaults, {__mode = <span class="string">&#34;k&#34;</span>})</span><br/><span class="line"><span class="keyword">local</span> mt = {__index = <span class="function"><span class="keyword">function</span> <span class="params">(t)</span></span> <span class="keyword">return</span> defaults[t] <span class="keyword">end</span>}</span><br/><span class="line"><span class="function"><span class="keyword">function</span>  <span class="params">(t, d)</span></span></span><br/><span class="line">defaults[t] = d</span><br/><span class="line"><span class="built_in">setmetatable</span>(t, mt)</span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
</li>
</ol>
<p>方案2:<br/></p><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> metas = {}</span><br/><span class="line"><span class="built_in">setmetatable</span>(metas, {__mode = <span class="string">&#34;v&#34;</span>})</span><br/><span class="line"><span class="function"><span class="keyword">function</span>  <span class="params">(t, d)</span></span></span><br/><span class="line"><span class="keyword">local</span> mt = metas[d]</span><br/><span class="line"><span class="keyword">if</span> mt == <span class="keyword">nil</span> <span class="keyword">then</span></span><br/><span class="line">mt = {__index = <span class="function"><span class="keyword">function</span> <span class="params">()</span></span> <span class="keyword">return</span> d <span class="keyword">end</span>}</span><br/><span class="line">metas[d] = mt </span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"><span class="built_in">setmetatable</span>(t, mt)</span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure><p></p>
<p>前者针对每一个不同的Table都会分配一个defaults入口,table作为key，default value作为value。这样的缺点就是当table数量很大的时候会需要分配很多内存去存储不同table的default value。</p>
<p>后者针对不同的default value分配了更多的内存(比如mt，entry on metas, closure……)，但优点是同样的default value只需要分配一次即可，所以后者更适用于table数量多但default value大都相同的情况。</p>
<ol>
<li>Ephemeron Tables(声明短暂的table Lua 5.2里提供)<br/>Ephemeron Table:<br/>“In Lua 5.2, a table with weak keys and strong values is an ephemeron table. In an ephemeron table, the accessibility of a key controls the accessibility of its corresponding value.(只当有strong<br/>reference to key时value才是strong的)”<br/>e.g. constant-function factory</li>
</ol>
<p>Note:<br/>“Only objects can be collected from a weak table. Values, such as numbers and booleans, are not collectible”(只有Objects在weak table里能被gc回收，number和booleans这种Value类型不能在weak table里被gc回收)</p>
<p>“strings are collectible, but string is not removed from weak table(unless its associated value is collected)”</p>
<p><strong>Finalizers</strong><br/>“Finalizers allow the collection of externa objects that are not directly under control of the garbage collector”</p>
<p>“Finalizer is a function associated with an object that is called when that object is about to be collected.”(相当于C#里的Finalize,在GC object的时候会被调用。但只有一开始设置Metamethod的<strong>gc时才能mark该object为可finalization的，否则就算后面在复制</strong>gc也不会在调用该object的finalizer)</p>
<p>Lua里是通过Metamethod里的__gc实现。<br/></p><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 测试环境要求至少Lua 5.2</span></span><br/><span class="line">o = {x = <span class="string">&#34;hi&#34;</span>}</span><br/><span class="line"><span class="built_in">setmetatable</span>(o, {__gc = <span class="function"><span class="keyword">function</span> <span class="params">(o)</span></span> <span class="built_in">print</span>(o.x) <span class="keyword">end</span>})</span><br/><span class="line">o = <span class="keyword">nil</span></span><br/><span class="line"><span class="built_in">collectgarbage</span>() <span class="comment">--&gt; hi</span></span><br/></pre></td></tr></tbody></table></figure><p></p>
<p>The order of finalization called:<br/>“When the collector finalizes several obejcts in the same cycle, it calls their finalizers in the reverse order that the objects were marked for finalization”(先声明__gc被mark为可finalization的object的finalizer后被调用)</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 测试环境要求至少Lua 5.2</span></span><br/><span class="line">mt = {__gc = <span class="function"><span class="keyword">function</span> <span class="params">(o)</span></span> <span class="built_in">print</span>(o[<span class="number">1</span>]) <span class="keyword">end</span>}</span><br/><span class="line">list = <span class="keyword">nil</span></span><br/><span class="line"><span class="keyword">for</span> i = <span class="number">1</span>, <span class="number">3</span> <span class="keyword">do</span></span><br/><span class="line">    list = <span class="built_in">setmetatable</span>({i, link = list}, mt)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line">list = <span class="keyword">nil</span></span><br/><span class="line"><span class="built_in">collectgarbage</span>()</span><br/><span class="line"><span class="comment">--&gt; 1</span></span><br/><span class="line"><span class="comment">--&gt; 2</span></span><br/><span class="line"><span class="comment">--&gt; 3</span></span><br/></pre></td></tr></tbody></table></figure>
<p>对于被finalize的object，Finlization会使被finalize的object处于两个特殊的状态：</p>
<ol>
<li>transient resurrection(短暂的复苏)</li>
<li>permanent resurrection(永久的复苏)<br/>前者因为在调用__gc的metamethod时我们会得到finalize的object，这样一来使得该object alive again，然后我们可以通过该object用于访问里面的对象。<br/>finalizer被调用时，该alive again的object被存储在了global table里，导致该object在finalize后依然存在。<strong>要想使用finalize也真正回收obejct，我们需要调用两次gc，第一次用于回收原始object，第二次用于回收alive again的object。</strong><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 因为当前测试环境是Lua 5.1(基于LuaTo#插件学习的，JIT支持到5.1的版本)所以不支持Talbe的__gc Metamethod，这里暂时没有写测试程序。</span></span><br/></pre></td></tr></tbody></table></figure>
</li>
</ol>
<p>Note:<br/>“In lua 5.1 the only lua values that work with <strong>gc metamethod is userdata. “(Lua 5.1不支持table的</strong>gc metamethod，只支持userdata的__gc metamethod)</p>
<h2 id="Lua里的OOP">Lua里的OOP</h2><p>OOP(Object Oriented Programming)<br/>首先Lua里面编写更重要的是Think in Lua，所以这里我不是强调OOP的重要性，而是单纯因为OOP被更多的C#程序员所熟悉。</p>
<h3 id="Class抽象">Class抽象</h3><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/><span class="line">33</span><br/><span class="line">34</span><br/><span class="line">35</span><br/><span class="line">36</span><br/><span class="line">37</span><br/><span class="line">38</span><br/><span class="line">39</span><br/><span class="line">40</span><br/><span class="line">41</span><br/><span class="line">42</span><br/><span class="line">43</span><br/><span class="line">44</span><br/><span class="line">45</span><br/><span class="line">46</span><br/><span class="line">47</span><br/><span class="line">48</span><br/><span class="line">49</span><br/><span class="line">50</span><br/><span class="line">51</span><br/><span class="line">52</span><br/><span class="line">53</span><br/><span class="line">54</span><br/><span class="line">55</span><br/><span class="line">56</span><br/><span class="line">57</span><br/><span class="line">58</span><br/><span class="line">59</span><br/><span class="line">60</span><br/><span class="line">61</span><br/><span class="line">62</span><br/><span class="line">63</span><br/><span class="line">64</span><br/><span class="line">65</span><br/><span class="line">66</span><br/><span class="line">67</span><br/><span class="line">68</span><br/><span class="line">69</span><br/><span class="line">70</span><br/><span class="line">71</span><br/><span class="line">72</span><br/><span class="line">73</span><br/><span class="line">74</span><br/><span class="line">75</span><br/><span class="line">76</span><br/><span class="line">77</span><br/><span class="line">78</span><br/><span class="line">79</span><br/><span class="line">80</span><br/><span class="line">81</span><br/><span class="line">82</span><br/><span class="line">83</span><br/><span class="line">84</span><br/><span class="line">85</span><br/><span class="line">86</span><br/><span class="line">87</span><br/><span class="line">88</span><br/><span class="line">89</span><br/><span class="line">90</span><br/><span class="line">91</span><br/><span class="line">92</span><br/><span class="line">93</span><br/><span class="line">94</span><br/><span class="line">95</span><br/><span class="line">96</span><br/><span class="line">97</span><br/><span class="line">98</span><br/><span class="line">99</span><br/><span class="line">100</span><br/><span class="line">101</span><br/><span class="line">102</span><br/><span class="line">103</span><br/><span class="line">104</span><br/><span class="line">105</span><br/><span class="line">106</span><br/><span class="line">107</span><br/><span class="line">108</span><br/><span class="line">109</span><br/><span class="line">110</span><br/><span class="line">111</span><br/><span class="line">112</span><br/><span class="line">113</span><br/><span class="line">114</span><br/><span class="line">115</span><br/><span class="line">116</span><br/><span class="line">117</span><br/><span class="line">118</span><br/><span class="line">119</span><br/><span class="line">120</span><br/><span class="line">121</span><br/><span class="line">122</span><br/><span class="line">123</span><br/><span class="line">124</span><br/><span class="line">125</span><br/><span class="line">126</span><br/></pre></td><td class="code"><pre><span class="line"><span class="comment">-- File Name:    Class.lua</span></span><br/><span class="line"><span class="comment">-- Description:    模拟Lua里OOP特性(不支持多重继承)</span></span><br/><span class="line"><span class="comment">-- Author:       TangHuan</span></span><br/><span class="line"><span class="comment">-- Create Date:    2018/11/09</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 使用方法：</span></span><br/><span class="line"><span class="comment">-- 1. 定义类</span></span><br/><span class="line"><span class="comment">-- local ClassName = Class(&#34;ClassName&#34;, nil)</span></span><br/><span class="line"><span class="comment">-- ***(自定义类数据方法等)</span></span><br/><span class="line"><span class="comment">-- 参数说明：</span></span><br/><span class="line"><span class="comment">-- clsname类名，super父类</span></span><br/><span class="line"><span class="comment">-- 返回结果:</span></span><br/><span class="line"><span class="comment">-- ClassName(含Class基本信息结构的table)</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">-- 2. 实例化类对象</span></span><br/><span class="line"><span class="comment">-- 参数说明：</span></span><br/><span class="line"><span class="comment">-- BaseClass含类定义的Class Table</span></span><br/><span class="line"><span class="comment">-- ...构造类实例对象的构造函数ctor()的参数</span></span><br/><span class="line"><span class="comment">-- 返回结果：</span></span><br/><span class="line"><span class="comment">-- 基于BaseClass的实例对象</span></span><br/><span class="line"><span class="comment">-- new(BaseClass, ...)</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">---克隆对象(建议用于克隆Class对象)</span></span><br/><span class="line"><span class="comment">---@param  any 对象</span></span><br/><span class="line"><span class="comment">---@return  any 克隆对象</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Clone</span><span class="params">(object)</span></span></span><br/><span class="line">    <span class="keyword">local</span> lookup_table = {}</span><br/><span class="line">    <span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">_copy</span><span class="params">(object)</span></span></span><br/><span class="line">        <span class="keyword">if</span> <span class="built_in">type</span>(object) ~= <span class="string">&#34;table&#34;</span> <span class="keyword">then</span></span><br/><span class="line">            <span class="keyword">return</span> object</span><br/><span class="line">        <span class="keyword">elseif</span> lookup_table[object] <span class="keyword">then</span></span><br/><span class="line">            <span class="keyword">return</span> lookup_table[object]</span><br/><span class="line">        <span class="keyword">end</span></span><br/><span class="line">        <span class="keyword">local</span> new_table = {}</span><br/><span class="line">        lookup_table[object] = new_table</span><br/><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> <span class="built_in">pairs</span>(object) <span class="keyword">do</span></span><br/><span class="line">            new_table[_copy(key)] = _copy(value)</span><br/><span class="line">        <span class="keyword">end</span></span><br/><span class="line">        <span class="keyword">return</span> <span class="built_in">setmetatable</span>(new_table, <span class="built_in">getmetatable</span>(object))</span><br/><span class="line">    <span class="keyword">end</span></span><br/><span class="line">    <span class="keyword">return</span> _copy(object)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">---判定是否是指定类或者继承至该类</span></span><br/><span class="line"><span class="comment">---@param self Class@类实例对象或者类</span></span><br/><span class="line"><span class="comment">---@param cname string | Class@类名或者类定义table</span></span><br/><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">IsClass</span><span class="params">(self, cname)</span></span></span><br/><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(self) ~= <span class="string">&#34;table&#34;</span> <span class="keyword">then</span></span><br/><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br/><span class="line">    <span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(cname) == <span class="string">&#34;table&#34;</span> <span class="keyword">then</span></span><br/><span class="line">        <span class="keyword">if</span> self.class == cname <span class="keyword">then</span></span><br/><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br/><span class="line">        <span class="keyword">elseif</span> self.super <span class="keyword">then</span></span><br/><span class="line">            <span class="keyword">return</span> self.super.IsClass(self.super, cname);</span><br/><span class="line">        <span class="keyword">end</span></span><br/><span class="line">    <span class="keyword">elseif</span> <span class="built_in">type</span>(cname) == <span class="string">&#34;string&#34;</span> <span class="keyword">then</span></span><br/><span class="line">        <span class="keyword">if</span> self.class.className == cname <span class="keyword">then</span></span><br/><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br/><span class="line">        <span class="keyword">elseif</span> self.super <span class="keyword">then</span></span><br/><span class="line">            <span class="keyword">return</span> self.super.IsClass(self.super, cname);</span><br/><span class="line">        <span class="keyword">end</span></span><br/><span class="line">    <span class="keyword">end</span></span><br/><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">--- 提供Lua的OOP实现，快速定义一个Class(不支持多重继承)</span></span><br/><span class="line"><span class="comment">--- 模拟Class封装，继承，多态，类型信息，构造函数等</span></span><br/><span class="line"><span class="comment">--- 模拟一个基础的Class需要的信息</span></span><br/><span class="line"><span class="comment">---@param clsname string@类名</span></span><br/><span class="line"><span class="comment">---@param super super@父类</span></span><br/><span class="line"><span class="comment">---@return Class@含Class所需基本信息的Class table</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Class</span><span class="params">(clsname, super)</span></span></span><br/><span class="line">    <span class="keyword">local</span> classtable = {}</span><br/><span class="line">    <span class="comment">-- ctor模拟构造函数</span></span><br/><span class="line">    classtable.Ctor = <span class="keyword">false</span></span><br/><span class="line">    <span class="comment">-- className模拟类型信息，负责存储类名</span></span><br/><span class="line">    classtable.className = clsname</span><br/><span class="line">    <span class="comment">-- super模拟父类</span></span><br/><span class="line">    <span class="comment">-- Note: 外部逻辑层不允许直接._super访问父类</span></span><br/><span class="line">    classtable._super = super</span><br/><span class="line">    <span class="comment">-- 自身class类table</span></span><br/><span class="line">    classtable.class = classtable;</span><br/><span class="line">    <span class="comment">-- 指定索引元方法__index为自身,模拟类访问</span></span><br/><span class="line">    <span class="comment">-- 后面实例化对象时会将classtable作为元表，从而实现访问类封装的数据</span></span><br/><span class="line">    classtable.__index = classtable</span><br/><span class="line">    <span class="comment">-- 是否是指定类或者继承至某类的方法接口</span></span><br/><span class="line">    classtable.IsClass = IsClass;</span><br/><span class="line">    <span class="comment">-- 如果指定了父类，通过设置Class的元表为父类模拟继承</span></span><br/><span class="line">    <span class="keyword">if</span> super <span class="keyword">then</span></span><br/><span class="line">        <span class="built_in">setmetatable</span>(classtable, super)</span><br/><span class="line">    <span class="keyword">else</span></span><br/><span class="line">        <span class="comment">--print(&#34;如果定义的不是最基类，请确认是否require了父类!&#34;)</span></span><br/><span class="line">    <span class="keyword">end</span></span><br/><span class="line">    <span class="keyword">return</span> classtable</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">--- 提供实例化对象的方法接口</span></span><br/><span class="line"><span class="comment">--- 模拟构造函数的递归调用，从最上层父类构造开始调用</span></span><br/><span class="line"><span class="comment">---@param cls cls@类定义</span></span><br/><span class="line"><span class="comment">---@param ... ...@构造函数变长参数</span></span><br/><span class="line"><span class="comment">---@return cls@cls类的实例对象table</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">New</span><span class="params">(cls, ...)</span></span></span><br/><span class="line">    <span class="comment">-- 实例对象表</span></span><br/><span class="line">    <span class="keyword">local</span> instance = {}</span><br/><span class="line">    <span class="comment">-- 设置实例对象元表为cls类模拟类的封装访问</span></span><br/><span class="line">    <span class="built_in">setmetatable</span>(instance, cls)</span><br/><span class="line">    <span class="comment">-- create模拟面向对象里构造函数的递归调用(从父类开始构造)</span></span><br/><span class="line">    <span class="keyword">local</span> create</span><br/><span class="line">    create = <span class="function"><span class="keyword">function</span><span class="params">(cls, ...)</span></span></span><br/><span class="line">        <span class="keyword">if</span> cls._super <span class="keyword">then</span></span><br/><span class="line">            create(cls._super, ...)</span><br/><span class="line">        <span class="keyword">end</span></span><br/><span class="line">        <span class="keyword">if</span> cls.Ctor <span class="keyword">then</span></span><br/><span class="line">            cls.Ctor(instance, ...)</span><br/><span class="line">        <span class="keyword">end</span></span><br/><span class="line">    <span class="keyword">end</span></span><br/><span class="line">    create(cls, ...)</span><br/><span class="line">    <span class="keyword">return</span> instance</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">---静态类</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span>  <span class="title">StaticClass</span><span class="params">(clsname)</span></span></span><br/><span class="line">    <span class="keyword">return</span> {}</span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure>
<p>上面的代码注释已经很清楚了，就不一一解释了。</p>
<p>理解上面Lua实现OOP的关键在于通过table模拟Class的抽象以及数据封装，通过metatable模拟继承特性。</p>
<h3 id="Class定义">Class定义</h3><p>定义一个类的方式如下：<br/></p><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/></pre></td><td class="code"><pre><span class="line">类名 = Class(<span class="string">&#34;类名&#34;</span>)</span><br/><span class="line"></span><br/><span class="line"><span class="comment">--构造函数</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> 类名:<span class="title">Ctor</span><span class="params">()</span></span></span><br/><span class="line">    <span class="comment">--成员变量定义</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">--方法定义</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> 类名:方法名<span class="params">()</span></span></span><br/><span class="line"></span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure><p></p>
<h3 id="Class继承">Class继承</h3><p>继承一个类的方式如下：<br/></p><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/></pre></td><td class="code"><pre><span class="line">子类名 = Class(<span class="string">&#34;子类名&#34;</span>, 父类名)</span><br/><span class="line"></span><br/><span class="line"><span class="comment">--构造函数</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> 子类名:<span class="title">Ctor</span><span class="params">()</span></span></span><br/><span class="line">    <span class="comment">--成员变量定义</span></span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="comment">--方法定义</span></span><br/><span class="line"><span class="function"><span class="keyword">function</span> 子类名:方法名<span class="params">()</span></span></span><br/><span class="line"></span><br/><span class="line"><span class="keyword">end</span></span><br/></pre></td></tr></tbody></table></figure><p></p>
<h3 id="Class对象实例化">Class对象实例化</h3><p>Lua OOP对象实例化方式如下：<br/></p><figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> 变量名 = New(类名)</span><br/><span class="line">变量名.成员变量</span><br/><span class="line">变量名:成员方法()</span><br/><span class="line">变量名.静态方法()</span><br/></pre></td></tr></tbody></table></figure><p></p>
<h2 id="Lua小知识">Lua小知识</h2><ol>
<li><p>Lua里没有Class只有通过Table模拟的Class<br/> 参考前面的Lua OOP实现</p>
</li>
<li><p>Lua里没有this的概念，self不等价于this，函数调用传的是谁谁就是self。Lua里.定义和:定义相对于self的用法来说相当于静态和成员定义。<br/> Lua里通过.调用的话是不会默认传递自身作为self的，不主动传的话self为空<br/> Lua里通过:调用的话默认第一个参数就是调用者，既self</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/></pre></td><td class="code"><pre><span class="line">tab = {}</span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tab.dotFunc</span><span class="params">(param)</span></span></span><br/><span class="line">    <span class="built_in">print</span>(<span class="string">&#34;self = &#34;</span>, self)</span><br/><span class="line">    <span class="built_in">print</span>(param)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tab:colonFunc</span><span class="params">(param)</span></span></span><br/><span class="line">    <span class="built_in">print</span>(<span class="string">&#34;self = &#34;</span>, self)</span><br/><span class="line">    <span class="built_in">print</span>(param)</span><br/><span class="line"><span class="keyword">end</span></span><br/><span class="line"></span><br/><span class="line">tab.dotFunc(<span class="number">1</span>)</span><br/><span class="line">tab:colonFunc(<span class="number">1</span>)</span><br/></pre></td></tr></tbody></table></figure>
<p> <img src="https://TonyTang1990.github.io//img/Lua/LuaDotAndColon.png" alt="LuaDotAndColon"/><br/> Note:<br/> :只是起了省略第一个参数self的作用，该self指向调用者本身，并没有其他特殊的地方。</p>
</li>
<li><p>Lua中的函数是带有词法定界（lexical scoping）的第一类值（first-class values）(在Lua中函数和其他值（数值、字符串）一样，函数可以被存放在变量中，也可以存放在表中，可以作为函数的参数，还可以作为函数的返回值)</p>
 <figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/></pre></td><td class="code"><pre><span class="li</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://lua.ren">糖果AIGC实验室 备案:辽ICP备16003836号-5</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://lua.ren/zl/2016-01-01-677_Unity%E4%B8%AD%E7%9A%84Lua/">https://lua.ren/zl/2016-01-01-677_Unity%E4%B8%AD%E7%9A%84Lua/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="null" target="_blank">null</a> 许可协议。转载请注明来自 <a href="https://lua.ren" target="_blank">糖果AIGC实验室-LUA</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/lua%E6%96%87%E7%AB%A0/">lua文章</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/zl/2016-01-01-676_Lua%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%20%5B%20%E5%A5%94%E8%B7%91%E7%9A%84%E8%9C%97%E7%89%9B%20%5D/" title="Lua垃圾回收"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Lua垃圾回收</div></div></a></div><div class="next-post pull-right"><a href="/zl/2016-01-01-675_17.Lazy%20evaluation/" title="17.Lazy evaluation"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">17.Lazy evaluation</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/zl/2016-01-01-2_AutoToolboxPopluate/" title="AutoToolboxPopluate"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-03</div><div class="title">AutoToolboxPopluate</div></div></a></div><div><a href="/zl/2016-01-01-1001_Lua%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" title="Lua正则表达式"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-03</div><div class="title">Lua正则表达式</div></div></a></div><div><a href="/zl/2016-01-01-1003_lua%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" title="lua快速入门"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-03</div><div class="title">lua快速入门</div></div></a></div><div><a href="/zl/2016-01-01-1004_C#%20%E4%BD%BF%E7%94%A8%20Lua%20%E5%8F%96%E5%BE%97%20Redis%20%E8%87%AA%E8%A8%82%E8%A4%87%E9%9B%9C%E5%9E%8B%E5%88%A5/" title="C# 使用 Lua 取得 Redis 自訂複雜型別"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-03</div><div class="title">C# 使用 Lua 取得 Redis 自訂複雜型別</div></div></a></div><div><a href="/zl/2016-01-01-1005_Lua%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89/" title="Lua语言学习（二）"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-03</div><div class="title">Lua语言学习（二）</div></div></a></div><div><a href="/zl/2016-01-01-1002_Lua%20%E5%AD%A6%E4%B9%A0%20chapter7%20/" title="Lua 学习 chapter7"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-03</div><div class="title">Lua 学习 chapter7</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">糖果AIGC实验室 备案:辽ICP备16003836号-5</div><div class="author-info__description">AIGC</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">1769</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">195</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">96</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">公众号：糖果的实验室 <img src="https://gitee.com/shengnoah/picture/raw/master/20231027182204.png"></img></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Lua_Study"><span class="toc-number">1.</span> <span class="toc-text">Lua Study</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Weak_Tables_And_Finalizers"><span class="toc-number">1.1.</span> <span class="toc-text">Weak Tables And Finalizers</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lua%E9%87%8C%E7%9A%84OOP"><span class="toc-number">1.2.</span> <span class="toc-text">Lua里的OOP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Class%E6%8A%BD%E8%B1%A1"><span class="toc-number">1.2.1.</span> <span class="toc-text">Class抽象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Class%E5%AE%9A%E4%B9%89"><span class="toc-number">1.2.2.</span> <span class="toc-text">Class定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Class%E7%BB%A7%E6%89%BF"><span class="toc-number">1.2.3.</span> <span class="toc-text">Class继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Class%E5%AF%B9%E8%B1%A1%E5%AE%9E%E4%BE%8B%E5%8C%96"><span class="toc-number">1.2.4.</span> <span class="toc-text">Class对象实例化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lua%E5%B0%8F%E7%9F%A5%E8%AF%86"><span class="toc-number">1.3.</span> <span class="toc-text">Lua小知识</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/zl/2016-01-01-99_%E6%B7%B1%E5%85%A5%20Lua%20Garbage%20Collector(%E4%B8%89)/" title="深入 Lua Garbage Collector(三)"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="深入 Lua Garbage Collector(三)"/></a><div class="content"><a class="title" href="/zl/2016-01-01-99_%E6%B7%B1%E5%85%A5%20Lua%20Garbage%20Collector(%E4%B8%89)/" title="深入 Lua Garbage Collector(三)">深入 Lua Garbage Collector(三)</a><time datetime="2024-04-03T03:47:36.244Z" title="发表于 2024-04-03 11:47:36">2024-04-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/zl/2016-01-01-9_Evaluating%20Polynomials/" title="Evaluating Polynomials"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Evaluating Polynomials"/></a><div class="content"><a class="title" href="/zl/2016-01-01-9_Evaluating%20Polynomials/" title="Evaluating Polynomials">Evaluating Polynomials</a><time datetime="2024-04-03T03:47:36.244Z" title="发表于 2024-04-03 11:47:36">2024-04-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/zl/2016-01-01-999_%E6%B7%B1%E5%85%A5Lua%20/" title="深入Lua"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="深入Lua"/></a><div class="content"><a class="title" href="/zl/2016-01-01-999_%E6%B7%B1%E5%85%A5Lua%20/" title="深入Lua">深入Lua</a><time datetime="2024-04-03T03:47:36.244Z" title="发表于 2024-04-03 11:47:36">2024-04-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/zl/2016-01-01-996_evaluation%20and%20selection%20%C2%B7%20ngc7293's%20blog/" title="evaluation and selection · ngc7293's blog"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="evaluation and selection · ngc7293's blog"/></a><div class="content"><a class="title" href="/zl/2016-01-01-996_evaluation%20and%20selection%20%C2%B7%20ngc7293's%20blog/" title="evaluation and selection · ngc7293's blog">evaluation and selection · ngc7293's blog</a><time datetime="2024-04-03T03:47:36.243Z" title="发表于 2024-04-03 11:47:36">2024-04-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/zl/2016-01-01-998_lua%20%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" title="lua 基础数据类型"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="lua 基础数据类型"/></a><div class="content"><a class="title" href="/zl/2016-01-01-998_lua%20%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" title="lua 基础数据类型">lua 基础数据类型</a><time datetime="2024-04-03T03:47:36.243Z" title="发表于 2024-04-03 11:47:36">2024-04-03</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 糖果AIGC实验室 备案:辽ICP备16003836号-5</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><script>(function () {
  var meta = document.createElement('meta');
  meta.content = 'no-referrer';
  meta.name = 'referrer';
  document.getElementsByTagName('head')[0].appendChild(meta);
})();</script></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script></div></body></html>