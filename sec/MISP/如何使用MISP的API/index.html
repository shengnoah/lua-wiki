<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>如何使用MISP的API | 糖果AIGC实验室-LUA</title><meta name="author" content="糖果AIGC实验室 备案:辽ICP备16003836号-5"><meta name="copyright" content="糖果AIGC实验室 备案:辽ICP备16003836号-5"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="如何使用MISP的API Welcome back to this series on using MISP for threat intelligence! MISP (Malware Information Sharing Platform and Threat Sharing) is an open-source threat intelligence platform that allo">
<meta property="og:type" content="article">
<meta property="og:title" content="如何使用MISP的API">
<meta property="og:url" content="https://lua.ren/sec/MISP/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8MISP%E7%9A%84API/index.html">
<meta property="og:site_name" content="糖果AIGC实验室-LUA">
<meta property="og:description" content="如何使用MISP的API Welcome back to this series on using MISP for threat intelligence! MISP (Malware Information Sharing Platform and Threat Sharing) is an open-source threat intelligence platform that allo">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg">
<meta property="article:published_time" content="2024-03-14T07:45:09.047Z">
<meta property="article:modified_time" content="2024-03-14T07:45:09.048Z">
<meta property="article:author" content="糖果AIGC实验室 备案:辽ICP备16003836号-5">
<meta property="article:tag" content="MISP">
<meta property="article:tag" content="API">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://lua.ren/sec/MISP/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8MISP%E7%9A%84API/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?14cc93bf3f08d31c458639d309dde522";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();



</script><script>(function () {
  var meta = document.createElement('meta');
  meta.content = 'no-referrer';
  meta.name = 'referrer';
  document.getElementsByTagName('head')[0].appendChild(meta);
})();</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"OCGZTJTHCQ","apiKey":"4dede33603574dcaed0e9d4641849158","indexName":"jianpan.vip","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '如何使用MISP的API',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-03-14 15:45:09'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">1769</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">195</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">96</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清單</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="糖果AIGC实验室-LUA"><span class="site-name">糖果AIGC实验室-LUA</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清單</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">如何使用MISP的API</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-03-14T07:45:09.047Z" title="发表于 2024-03-14 15:45:09">2024-03-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-03-14T07:45:09.048Z" title="更新于 2024-03-14 15:45:09">2024-03-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AE%89%E5%85%A8/">安全</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="如何使用MISP的API"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><h1 id="如何使用misp的api"><a class="markdownIt-Anchor" href="#如何使用misp的api"></a> 如何使用MISP的API</h1>
<p>Welcome back to this series on using MISP for threat intelligence!</p>
<p><a target="_blank" rel="noopener" href="https://www.misp-project.org/">MISP</a> (Malware Information Sharing Platform and Threat Sharing) is an open-source threat intelligence platform that allows you to share, collate, analyze, and distribute threat intelligence. It is used across industries and governments worldwide to share and analyze information about the latest threats. This series aims to give you the knowledge you need to get up and running with MISP as quickly as possible.</p>
<p>If you have followed this series, you will now have events and attributes (IOCs) in your MISP instance and know how to search through them. However, this can be clunky using the MISP web interface. Thankfully, MISP exposes an API we can use to perform any action we can do in the web interface in code!</p>
<p>Today, you learn to use this API to make the most of your MISP instance. You will see how to get statistics about your MISP instance, search for attributes and events, and visualize data you’ve added to your instance.</p>
<p>Let’s jump in and start using the API!</p>
<h2 id="what-is-an-api"><a class="markdownIt-Anchor" href="#what-is-an-api"></a> What is an API?</h2>
<p>Before looking at MISP’s API, let’s have a quick refresher on what an API is and what it is used for.</p>
<p>An Application Programming Interface (API) is a set of protocols, routines, and tools for building software applications. It defines a set of rules that allow software applications to interact with each other to exchange data and services. They are a bridge between two applications that allows them to communicate with each other in a standard way.</p>
<p>APIs allow developers to access specific functionality or data from a service or application without requiring access to the underlying code. This makes it possible to integrate different software applications, databases, and services and build new applications on top of existing ones.</p>
<p>The most common APIs you are likely to interact with are web APIs, which allow you to interact with a web-based application in a programmable manner. APIs can be public (which anyone can use) or private (which are only accessible by authorized parties). Again, most of the time, you will use APIs requiring some form of authorization (username and password, token, etc.), which is the case with MISP’s API.</p>
<h2 id="the-basics-of-the-misp-api"><a class="markdownIt-Anchor" href="#the-basics-of-the-misp-api"></a> The Basics of the MISP API</h2>
<p>MISP comes with a <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/REST">RESTful API</a>, which you can use to query your MISP instance for data about itself (e.g., statistics) or data about the intelligence it holds (e.g., events and attributes) using <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/GET">HTTP GET requests</a>. This data is returned to you in either JSON or XML format so you can easily parse it into the form you want to work with. You can also use HTTP POST, PUT, and DELETE requests to add, edit, or remove data from your MISP instance programmatically.</p>
<p>Interacting with your MISP instance through its API saves you from going through MISP’s web interface to retrieve this data and increases the efficiency of your operations through the power of code and automation.</p>
<h3 id="interacting-with-the-misp-api"><a class="markdownIt-Anchor" href="#interacting-with-the-misp-api"></a> Interacting with the MISP API</h3>
<p>To interact with the MISP API, you must add an authentication key to authenticate your application with your MISP instance. You can do this by going to <em>Administration</em> in the top menu and selecting the <em>List Auth Keys</em> dropdown option.</p>
<p><img src="https://kravensecurity.com/wp-content/uploads/2023/11/list-auth-keys-menu.jpg" alt="MISP List Auth Keys Button" /></p>
<p>You may not see this option if you do not have the appropriate privileges. To circumvent this, log in as the default admin user.</p>
<p>This will bring you to the Authentication Key Index, where you can click the <em>Add authentication key</em> button to create a new API key.</p>
<p><img src="https://kravensecurity.com/wp-content/uploads/2023/11/add-authentication-key-button.jpg" alt="Add Authentication Key Button" /></p>
<p>Clicking this button will bring up a popup window for you to fill out the details of the authentication key you are adding. Here, you can select the user account associated with the key, add a comment about what this key is used for, allowlist only specific IP addresses, and add an expiration date. All of these are optional. Click <em>Submit</em> when done.</p>
<p><img src="https://kravensecurity.com/wp-content/uploads/2023/11/creating-auth-key.jpg" alt="Creating API Authentication Key" /></p>
<p>Make sure to save your authentication key in your password manager so you can use it later. This is very important. You won’t be able to see this key again in MISP, and you will have to generate a new one if you forget it. Click the <em>I have noted down my key, take me back now</em> button when done.</p>
<p><img src="https://kravensecurity.com/wp-content/uploads/2023/11/auth-key-confirmation-screen.jpg" alt="Auth Key Created Confirmation" /></p>
<p>You will now see your authentication key appear on the Authentication Key Index page, and you can begin using it!</p>
<p><img src="https://kravensecurity.com/wp-content/uploads/2023/11/auth-key-in-authentication-key-index.jpg" alt="API Auth Key in Authentication Key Index" /></p>
<h2 id="the-best-way-to-use-the-misp-api"><a class="markdownIt-Anchor" href="#the-best-way-to-use-the-misp-api"></a> The Best Way to Use the MISP API</h2>
<p>You can interact with the MISP API through direct web requests to the MISP API endpoint. For instance, making a GET request to <code>https://&lt;misp_ip&gt;/events</code> to retrieve information about an event or a POST request to <code>https://&lt;misp_ip&gt;/events/add</code> to add an event. However, if you know a little bit of Python, there is an easier way.</p>
<p><a target="_blank" rel="noopener" href="https://www.circl.lu/doc/misp/pymisp/">PyMISP</a> is a Python library you can use to access MISP, make API requests, and automatically parse data returned into Python objects so you can manipulate them using standard Python methods and functions. You can install PyMISP using the <a target="_blank" rel="noopener" href="https://pip.pypa.io/">Python package manager pip</a> with the command <code>pip3 install pymisp</code> or use another installation method detailed on the <a target="_blank" rel="noopener" href="https://github.com/MISP/PyMISP/tree/main">PyMISP GitHub page</a>.</p>
<p>Once installed, you can use PyMISP to create a Python script that acts as a wrapper for all your MISP API queries, allowing you to perform complex data analysis tasks easily. That said, skip the script. The best way to perform data analysis (and prototyping) is using a <a target="_blank" rel="noopener" href="https://jupyter.org">Jupyter Notebook</a>.</p>
<p>A Jupyter Notebook can serve two main purposes:</p>
<ol>
<li class="lvl-3">
<p>Creating a mix of code and Markdown content that serves as “interactive documentation.” A user reads the Markdown content and executes the code as they work their way through the Notebook.</p>
</li>
<li class="lvl-3">
<p>For prototyping code that you are building into a larger and more complex tool.</p>
</li>
</ol>
<p>You can use Jupyter Notebooks for prototyping as you interact with the MISP API through Python code. To follow along, see <a target="_blank" rel="noopener" href="https://kravensecurity.com/python-threat-hunting-tools-jupyter-notebooks/">Python Threat Hunting Tools: Part 10 — The Power of Jupyter Notebooks</a> to learn how to create a Jupyter Notebook. Then, use the code examples shown below in your Jupyter Notebook, replacing the variables I use with those of your MISP instance. Add documentation so you remember what each code example does using Markdown cells.</p>
<h2 id="authentication"><a class="markdownIt-Anchor" href="#authentication"></a> Authentication</h2>
<p>You must first authenticate to send API requests to your MISP instance. You need two things to do this:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>An authentication key to authenticate to the API (as discussed above).</p>
</li>
<li class="lvl-2">
<p>The IP address or URL of your MISP instance.</p>
</li>
</ul>
<p>With these in hand, you can use the code below to authenticate to the MISP API using Python:</p>
<p>Python</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># import PyMISP object from pymisp Python library</span>
<span class="token keyword">from</span> pymisp <span class="token keyword">import</span> PyMISP
<span class="token comment"># url or IP address of MISP instance</span>
MISP_URL <span class="token operator">=</span> <span class="token string">'&lt;misp_url>'</span>
<span class="token comment"># your API authentication key, generated using your MISP instance</span>
MISP_KEY <span class="token operator">=</span> <span class="token string">'&lt;api_key>'</span>
<span class="token comment"># create MISP instance to interact with using Python methods</span>
misp <span class="token operator">=</span> PyMISP<span class="token punctuation">(</span>MISP_URL<span class="token punctuation">,</span> MISP_KEY<span class="token punctuation">,</span> ssl<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>You are now ready to begin interacting with the MISP API using Python. Let’s see how to retrieve statistics, search for attributes and events, and visualize data!</p>
<p>The <code>ssl</code> and <code>debug</code> options have been set to false to avoid unnecessary error messages when prototyping.</p>
<h2 id="retrieving-statistics"><a class="markdownIt-Anchor" href="#retrieving-statistics"></a> Retrieving Statistics</h2>
<p>You can get data from the MISP API about general statistics, tags, and attributes related to your MISP instance.</p>
<h3 id="general-statistics"><a class="markdownIt-Anchor" href="#general-statistics"></a> General Statistics</h3>
<p>To retrieve general statistics, you can use the <code>user_statistics()</code> method associated with the <code>misp</code> object you created when authenticating.</p>
<p>Python</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">response <span class="token operator">=</span> misp<span class="token punctuation">.</span>user_statistics<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>This returns a Python dictionary, which you can query for information like total users, events, and attributes.</p>
<p>Python</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">general_stats</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  res <span class="token operator">=</span> misp<span class="token punctuation">.</span>user_statistics<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Total users: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>res<span class="token punctuation">[</span><span class="token string">'stats'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'user_count'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Total events: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>res<span class="token punctuation">[</span><span class="token string">'stats'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'event_count'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Total attributes: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>res<span class="token punctuation">[</span><span class="token string">'stats'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'attribute_count'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

general_stats<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="tag-statistics"><a class="markdownIt-Anchor" href="#tag-statistics"></a> Tag Statistics</h3>
<p>To retrieve tag statistics, you can use the <code>tag_statistics()</code> method associated with the <code>misp</code> object you created.</p>
<p>Python</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">response <span class="token operator">=</span> misp<span class="token punctuation">.</span>tag_statistics<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>This returns a Python dictionary which you can query for information based on specific tags.</p>
<p>Python</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">tag_stats</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  res <span class="token operator">=</span> misp<span class="token punctuation">.</span>tag_statistics<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Total reports: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>res<span class="token punctuation">[</span><span class="token string">'tags'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'cssa:origin=report'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Total investigations: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>res<span class="token punctuation">[</span><span class="token string">'tags'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'cssa:origin=manual_investigation'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Total purple team exercises: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>res<span class="token punctuation">[</span><span class="token string">'tags'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'custom:purple-team-exercise'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

general_stats<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="attribute-statistics"><a class="markdownIt-Anchor" href="#attribute-statistics"></a> Attribute Statistics</h3>
<p>To retrieve statistics about attributes, you can use the <code>attribute_statistics()</code> method associated with the <code>misp</code> object you created.</p>
<p>Python</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">response <span class="token operator">=</span> misp<span class="token punctuation">.</span>attribute_statistics<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>This returns a Python dictionary, which you can query for information about specific attributes.</p>
<p>Python</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">attribute_stats</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  res <span class="token operator">=</span> misp<span class="token punctuation">.</span>attributes_statistics<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Total MD5 hashes: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>res<span class="token punctuation">[</span><span class="token string">'md5'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Total domains: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>res<span class="token punctuation">[</span><span class="token string">'domains'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Total IP addresses: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>res<span class="token punctuation">[</span><span class="token string">'ip-dst'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Total URLs: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>res<span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Total email addresses: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>res<span class="token punctuation">[</span><span class="token string">'email-src'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
  
general_stats<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="searching-for-attributes-and-events"><a class="markdownIt-Anchor" href="#searching-for-attributes-and-events"></a> Searching for Attributes and Events</h2>
<p>You can use the MISP API to search for Indicators of Compromise (IOCs) you uploaded to your MISP instance as attributes. Searching for them will return the MISP event they are associated with.</p>
<p>To learn more about attributes and events in MISP, read <a target="_blank" rel="noopener" href="https://kravensecurity.com/threat-intelligence-with-misp-part-3-creating-events/">Threat Intelligence with MISP: Part 3 — Creating Events</a>.</p>
<p>The code below searches for an <code>IOC</code> and uses the <code>misp</code> object’s <code>search()</code> method to query the MISP API for this IOC. MISP will search all the attributes it has stored in its database and return the event an attribute is associated with. The Python code saves the response returned by the API in a dictionary data structure and checks to see if it contains data using an <code>if</code> statement. If it does, this data is parsed using dictionary bracket notation to return key event information that is printed using <a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/formatted-string-literals-f-strings-python/">Python f strings</a>.</p>
<p>Python</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">IOC <span class="token operator">=</span> <span class="token string">"oxcdntech.com"</span>
response <span class="token operator">=</span> misp<span class="token punctuation">.</span>search<span class="token punctuation">(</span>value<span class="token operator">=</span>IOC<span class="token punctuation">)</span>

<span class="token keyword">if</span> response<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"--- Matching Event ---"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Event ID: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>response<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Event'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Event Info: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>response<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Event'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'info'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Date Added: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>response<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Event'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Tags: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>response<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Event'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> tag <span class="token keyword">in</span> response<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Event'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Tag'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"- </span><span class="token interpolation"><span class="token punctuation">&#123;</span>tag<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"-"</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span>

<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"The IOC </span><span class="token interpolation"><span class="token punctuation">&#123;</span>IOC<span class="token punctuation">&#125;</span></span><span class="token string"> is not in MISP"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>The IOC in this example code is a domain name (<code>oxcdntech.com</code>). However, you can change this for any MISP attribute type, such as IP addresses, file hashes, hostnames, email addresses, etc.</p>
<p>The MISP API provides a quick and easy way to <a target="_blank" rel="noopener" href="https://kravensecurity.com/threat-intelligence-with-misp-part-5-searching-and-filtering/" title="search your MISP instance">search your MISP instance</a> for an IOC without going through the web interface. These searches can also be scripted, automated, and integrated into larger workflows. For instance, you can write a script to check an IOC against your MISP instance, VirusTotal, GreyNoise, and any other threat intelligence source that exposes an API for you to use, allowing you to produce a more complete picture.</p>
<h2 id="visualizing-data"><a class="markdownIt-Anchor" href="#visualizing-data"></a> Visualizing Data</h2>
<p>The examples so far, returning statistics and searching for IOCs, have been basic. Let’s now look at a more complex example of using the MISP API to visualize the most common techniques, tactics, and procedures (TTPs) within your threat intelligence data.</p>
<p>Whenever you upload a new threat intelligence report, incident, or piece of research to MISP, you can include additional context by adding a galaxy cluster on the <em>View Event</em> page. This additional context allows you to use shared threat intelligence frameworks or standardized lingo to describe your event, helping others understand and use it.</p>
<p>Read <a target="_blank" rel="noopener" href="https://kravensecurity.com/threat-intelligence-with-misp-part-3-creating-events/">Threat Intelligence with MISP: Part 3 — Creating Events</a> to learn about galaxy clusters.</p>
<p>Using the <em>Attacker Pattern</em> galaxy (under the <em>mitre-attack</em>), you can add data about the TTPs associated with an event. This is useful because it helps you track how threat actors attack systems and, by extension, how to defend against them.</p>
<p><img src="https://kravensecurity.com/wp-content/uploads/2023/11/view-event-galaxy-information.jpg" alt="MISP View Event Galaxy Information" /></p>
<p>However, as defenders, our time and resources are usually limited, so we need to prioritize which TTPs we want to focus on defending against. A good starting point is finding what TTPs are most commonly used by threat actors targeting your organization and prioritizing those. You can use the MISP API to automate this by aggregating common TTPs and then visualizing the most common using the <a target="_blank" rel="noopener" href="https://pandas.pydata.org/">pandas Python data analysis library</a>.</p>
<p>This approach is discussed in-depth in <a target="_blank" rel="noopener" href="https://kravensecurity.com/threat-profiling-how-to-understand-hackers-and-their-ttps/">Threat Profiling: How to Understand Hackers and Their TTPs</a>, where you can see how to perform common TTP aggregation and visualization manually using a spreadsheet.</p>
<p>The Python code below does the following:</p>
<ol>
<li class="lvl-3">
<p>Returns all events in your MISP.</p>
</li>
<li class="lvl-3">
<p>Creates a Python dictionary containing MITRE ATT&amp;CK TTPs mapped to a count (redacted for brevity).</p>
</li>
<li class="lvl-3">
<p>Loops through all events and increases the count of the TTP in the dictionary. It uses dictionary bracket notation to parse galaxy cluster information.</p>
</li>
<li class="lvl-3">
<p>Transforms the Python dictionary into a pandas series object.</p>
</li>
<li class="lvl-3">
<p>Plots the series object using a horizontal bar graph so you can visualize the data. This code only plots TTPs that have a count greater than 9.</p>
</li>
</ol>
<p>Python</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># (1) get all events in MISP instance</span>
<span class="token builtin">all</span> <span class="token operator">=</span> misp<span class="token punctuation">.</span>search<span class="token punctuation">(</span>controller<span class="token operator">=</span><span class="token string">"events"</span><span class="token punctuation">)</span>
<span class="token comment"># (2) create dictionary containing MITRE ATT&amp;CK TTPs mapped to a count</span>
ttps <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token string">"T1548"</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token string">"T1220"</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>

<span class="token comment"># (3) loop through all events and increase count of a TTP in dictionary if an event has that TTP</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">all</span><span class="token punctuation">:</span>
    galaxies <span class="token operator">=</span> i<span class="token punctuation">[</span><span class="token string">'Event'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Galaxy'</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> galaxies<span class="token punctuation">:</span>
        <span class="token keyword">if</span> j<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'mitre-attack-pattern'</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> k <span class="token keyword">in</span> j<span class="token punctuation">[</span><span class="token string">'GalaxyCluster'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                ttp <span class="token operator">=</span> k<span class="token punctuation">[</span><span class="token string">'meta'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'external_id'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                <span class="token keyword">if</span> ttp <span class="token keyword">in</span> ttps<span class="token punctuation">:</span>
                    ttps<span class="token punctuation">[</span>ttp<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>

<span class="token comment"># (4) creating a pandas series object</span>
ttps_data <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>data<span class="token operator">=</span>ttps<span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span>ttps<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># (5) plotting the data in a horizontal bar graph</span>
<span class="token punctuation">(</span>ttps_data
    <span class="token punctuation">[</span><span class="token keyword">lambda</span> s<span class="token punctuation">:</span> s<span class="token operator">></span><span class="token number">9</span><span class="token punctuation">]</span>
    <span class="token punctuation">.</span>plot<span class="token punctuation">.</span>barh<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Once executed, you should see a nicely formatted horizontal bar graph in your Jupyter Notebook. This shows you the most common TTPs and, unlike a spreadsheet, will dynamically change when you add more events to your MISP instance.</p>
<p><img src="https://kravensecurity.com/wp-content/uploads/2023/11/visualizing-common-ttps-graph.jpg" alt="Visualizing Common TTPs Bar Graph" /></p>
<p>Going a step further, you can also limit your collection of TTPs to specific MISP events. MISP allows you to add tags to events that allow you to classify and categorize your events. For instance, you could have a tag for external threat intelligence reports, a tag for incidents your organization has faced in the past, or a tag for research you’re performing.</p>
<p>The code below limits the TTPs it aggregates and visualizes to those with the tag “software-research.” I created this custom tag to add data to MISP about threat actors and malware I was researching, including the TTPs they use. The code lets me see the common TTPs in this research data.</p>
<p>Python</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">TAG <span class="token operator">=</span> <span class="token string">"software-research"</span>
<span class="token comment"># get all events in MISP instance</span>
<span class="token builtin">all</span> <span class="token operator">=</span> misp<span class="token punctuation">.</span>search<span class="token punctuation">(</span>controller<span class="token operator">=</span><span class="token string">"events"</span><span class="token punctuation">)</span>
<span class="token comment"># create dictionary containing MITRE ATT&amp;CK TTPs mapped to a count</span>
ttps <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token string">"T1548"</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token string">"T1220"</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>

<span class="token comment"># loop through all events and increase count of a TTP in dictionary if an event has that TTP</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">all</span><span class="token punctuation">:</span>
    <span class="token comment"># check for a specific TAG</span>
    <span class="token keyword">for</span> tag <span class="token keyword">in</span> i<span class="token punctuation">[</span><span class="token string">'Event'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Tag'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> tag<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">==</span> TAG<span class="token punctuation">:</span>
            galaxies <span class="token operator">=</span> i<span class="token punctuation">[</span><span class="token string">'Event'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Galaxy'</span><span class="token punctuation">]</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> galaxies<span class="token punctuation">:</span>
            <span class="token keyword">if</span> j<span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'mitre-attack-pattern'</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> k <span class="token keyword">in</span> j<span class="token punctuation">[</span><span class="token string">'GalaxyCluster'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    ttp <span class="token operator">=</span> k<span class="token punctuation">[</span><span class="token string">'meta'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'external_id'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                    <span class="token keyword">if</span> ttp <span class="token keyword">in</span> ttps<span class="token punctuation">:</span>
                        ttps<span class="token punctuation">[</span>ttp<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>

<span class="token comment"># plotting data</span>
ttps_data <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>data<span class="token operator">=</span>ttps<span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span>ttps<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span>ttps_data
    <span class="token punctuation">[</span><span class="token keyword">lambda</span> s<span class="token punctuation">:</span> s<span class="token operator">></span><span class="token number">11</span><span class="token punctuation">]</span>
    <span class="token punctuation">.</span>plot<span class="token punctuation">.</span>barh<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="summary"><a class="markdownIt-Anchor" href="#summary"></a> Summary</h2>
<p>Congrats! You now know the basics of the MISP API and how to leverage it to get statistics about your MISP instance, search for attributes and events, and visualize the threat intelligence you’ve added to it. The MISP API is an incredibly powerful tool that you should invest time into learning by building your own simple Python scripts and automations.</p>
<p>If you were unable to follow along, don’t worry. I will add all these code examples to a Jupyter Notebook you can use. You can find it on my GitHub page, and I will write up how to use it in <a target="_blank" rel="noopener" href="https://kravensecurity.com/python-threat-hunting-tools-jupyter-notebook-for-misp/" title="Python Threat Hunting Tools: Part 11 — A Jupyter Notebook for MISP">Python Threat Hunting Tools: Part 11 — A Jupyter Notebook for MISP</a>.</p>
<p>The next installment in this series explores how to export attributes from your MISP instance as IOCs to use with your security solutions to detect and block the latest threats. You will see how to do this through the web interface and the MISP API. Stay tuned!</p>
<p>Discover more in the <a target="_blank" rel="noopener" href="https://kravensecurity.com/tag/threat-intelligence-with-misp/">Threat Intelligence with MISP series</a>!</p>
<p>![Back to top arrow](data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCA5NiA0ODAgMjgzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im00MyAzNzktNDMtNDMgMjQwLTI0MCAyNDAgMjQwLTQzIDQzLTE5Ny0xOTd6IiBmaWxsPSIjZmZmIi8+PC9zdmc+Cg==)</p>
<p>Stay up-to-date whenever we release articles, tips, and guided tutorials. Don’t miss a thing and signup to get notified of new content.</p>
<h2 id="interesting-in-learning-more"><a class="markdownIt-Anchor" href="#interesting-in-learning-more"></a> Interesting in Learning More?</h2>
<p><img src="https://kravensecurity.com/wp-content/uploads/2023/11/zero-point-security-logo-1.webp" alt="" /></p>
<h3 id="learn-the-dark-arts-of-red-teaming"><a class="markdownIt-Anchor" href="#learn-the-dark-arts-of-red-teaming"></a> Learn the dark arts of red teaming</h3>
<p><a target="_blank" rel="noopener" href="https://training.zeropointsecurity.co.uk/?ref=3e1b79">Check out these courses offered by Zero-Point Security</a>. They will teach you all things red teaming from creating exploits, writing your own C2 framework, and emulating real-world threat actors.</p>
<p>If you want more of a challenge, take on one of their certification exams and land your next job in cyber:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://training.zeropointsecurity.co.uk/courses/red-team-ops?ref=3e1b79">Red Team Ops</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://training.zeropointsecurity.co.uk/courses/red-team-ops-ii?ref=3e1b79">Red Team Ops II</a></p>
</li>
</ul>
<p><img src="https://kravensecurity.com/wp-content/uploads/2023/11/TCM-academy-logo-1.webp" alt="" /></p>
<h3 id="learn-more-cyber-security-skills"><a class="markdownIt-Anchor" href="#learn-more-cyber-security-skills"></a> Learn more cyber security skills</h3>
<p>Check out <a target="_blank" rel="noopener" href="https://academy.tcm-sec.com/p/the-all-access-pass?affcode=770707_annz0hoj">The All-Access Membership Pass by TCM Academy</a>. for courses on hacking/pentesting, malware analysis, digital forensics, programming/scripting, GRC, and more!</p>
<p>If you’re looking to level up your skills even more, have a go at one of their certifications:</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://academy.tcm-sec.com/a/aff_28fg418j/external?affcode=770707_annz0hoj">Practical Network Penetration Tester</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://academy.tcm-sec.com/a/aff_l0mcpyff/external?affcode=770707_annz0hoj">Practical Junior Malware Researcher</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://academy.tcm-sec.com/a/aff_98zlvk7y/external?affcode=770707_annz0hoj">Practical Career-Ready Professional</a><a target="_blank" rel="noopener" href="https://medium.com/tag/threat-intelligence?source=post_page-----be857bba8e7---------------threat_intelligence-----------------"></a></p>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://lua.ren">糖果AIGC实验室 备案:辽ICP备16003836号-5</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://lua.ren/sec/MISP/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8MISP%E7%9A%84API/">https://lua.ren/sec/MISP/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8MISP%E7%9A%84API/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="null" target="_blank">null</a> 许可协议。转载请注明来自 <a href="https://lua.ren" target="_blank">糖果AIGC实验室-LUA</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MISP/">MISP</a><a class="post-meta__tags" href="/tags/API/">API</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/sec/MISP/MISP%E5%85%81%E8%AE%B8%E7%9A%84%E6%93%8D%E4%BD%9C%E5%8D%8F%E8%AE%AE/" title="MISP允许的操作协议"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MISP允许的操作协议</div></div></a></div><div class="next-post pull-right"><a href="/sec/MISP/%E5%BC%80%E6%BA%90%E5%A8%81%E8%83%81%E6%83%85%E6%8A%A5%E5%85%B1%E4%BA%AB%E5%B9%B3%E5%8F%B0MISP%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/" title="开源威胁情报共享平台MISP的安装与配置"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">开源威胁情报共享平台MISP的安装与配置</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/sec/MISP/MISP-%E5%BC%80%E6%BA%90%E5%A8%81%E8%83%81%E6%83%85%E6%8A%A5%E5%85%B1%E4%BA%AB%E5%B9%B3%E5%8F%B0/" title="MISP-开源威胁情报共享平台"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-14</div><div class="title">MISP-开源威胁情报共享平台</div></div></a></div><div><a href="/sec/MISP/MISP%E5%85%81%E8%AE%B8%E7%9A%84%E6%93%8D%E4%BD%9C%E5%8D%8F%E8%AE%AE/" title="MISP允许的操作协议"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-14</div><div class="title">MISP允许的操作协议</div></div></a></div><div><a href="/sec/MISP/%E5%B0%86MISP%E5%A8%81%E8%83%81%E4%BA%8B%E4%BB%B6%E5%AF%BC%E5%87%BA%E6%88%90Suricata%E8%A7%84%E5%88%99%E6%96%87%E4%BB%B6/" title="将MISP威胁事件导出成Suricata规则文件"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-14</div><div class="title">将MISP威胁事件导出成Suricata规则文件</div></div></a></div><div><a href="/sec/MISP/%E5%BC%80%E6%BA%90%E5%A8%81%E8%83%81%E6%83%85%E6%8A%A5%E5%85%B1%E4%BA%AB%E5%B9%B3%E5%8F%B0MISP%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/" title="开源威胁情报共享平台MISP的安装与配置"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-14</div><div class="title">开源威胁情报共享平台MISP的安装与配置</div></div></a></div><div><a href="/sec/MISP/%E6%81%B6%E6%84%8F%E8%BD%AF%E4%BB%B6%E4%BF%A1%E6%81%AF%E5%85%B1%E4%BA%AB%E5%B9%B3%E5%8F%B0%EF%BC%88MISP%EF%BC%89/" title="恶意软件信息共享平台（MISP）"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-14</div><div class="title">恶意软件信息共享平台（MISP）</div></div></a></div><div><a href="/sec/TheHive/TheHive%E4%B8%8ECortex%E5%92%8CMISP%E7%BB%93%E5%90%88%E4%BD%BF%E7%94%A8/" title="TheHive与Cortex和MISP结合使用"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-14</div><div class="title">TheHive与Cortex和MISP结合使用</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">糖果AIGC实验室 备案:辽ICP备16003836号-5</div><div class="author-info__description">AIGC</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">1769</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">195</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">96</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">公众号：糖果的实验室 <img src="https://gitee.com/shengnoah/picture/raw/master/20231027182204.png"></img></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8misp%E7%9A%84api"><span class="toc-number">1.</span> <span class="toc-text"> 如何使用MISP的API</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#what-is-an-api"><span class="toc-number">1.1.</span> <span class="toc-text"> What is an API?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#the-basics-of-the-misp-api"><span class="toc-number">1.2.</span> <span class="toc-text"> The Basics of the MISP API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#interacting-with-the-misp-api"><span class="toc-number">1.2.1.</span> <span class="toc-text"> Interacting with the MISP API</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#the-best-way-to-use-the-misp-api"><span class="toc-number">1.3.</span> <span class="toc-text"> The Best Way to Use the MISP API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#authentication"><span class="toc-number">1.4.</span> <span class="toc-text"> Authentication</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#retrieving-statistics"><span class="toc-number">1.5.</span> <span class="toc-text"> Retrieving Statistics</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#general-statistics"><span class="toc-number">1.5.1.</span> <span class="toc-text"> General Statistics</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tag-statistics"><span class="toc-number">1.5.2.</span> <span class="toc-text"> Tag Statistics</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#attribute-statistics"><span class="toc-number">1.5.3.</span> <span class="toc-text"> Attribute Statistics</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#searching-for-attributes-and-events"><span class="toc-number">1.6.</span> <span class="toc-text"> Searching for Attributes and Events</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#visualizing-data"><span class="toc-number">1.7.</span> <span class="toc-text"> Visualizing Data</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#summary"><span class="toc-number">1.8.</span> <span class="toc-text"> Summary</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#interesting-in-learning-more"><span class="toc-number">1.9.</span> <span class="toc-text"> Interesting in Learning More?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#learn-the-dark-arts-of-red-teaming"><span class="toc-number">1.9.1.</span> <span class="toc-text"> Learn the dark arts of red teaming</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#learn-more-cyber-security-skills"><span class="toc-number">1.9.2.</span> <span class="toc-text"> Learn more cyber security skills</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/zl/2016-01-01-99_%E6%B7%B1%E5%85%A5%20Lua%20Garbage%20Collector(%E4%B8%89)/" title="深入 Lua Garbage Collector(三)"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="深入 Lua Garbage Collector(三)"/></a><div class="content"><a class="title" href="/zl/2016-01-01-99_%E6%B7%B1%E5%85%A5%20Lua%20Garbage%20Collector(%E4%B8%89)/" title="深入 Lua Garbage Collector(三)">深入 Lua Garbage Collector(三)</a><time datetime="2024-04-03T03:47:36.244Z" title="发表于 2024-04-03 11:47:36">2024-04-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/zl/2016-01-01-9_Evaluating%20Polynomials/" title="Evaluating Polynomials"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Evaluating Polynomials"/></a><div class="content"><a class="title" href="/zl/2016-01-01-9_Evaluating%20Polynomials/" title="Evaluating Polynomials">Evaluating Polynomials</a><time datetime="2024-04-03T03:47:36.244Z" title="发表于 2024-04-03 11:47:36">2024-04-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/zl/2016-01-01-999_%E6%B7%B1%E5%85%A5Lua%20/" title="深入Lua"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="深入Lua"/></a><div class="content"><a class="title" href="/zl/2016-01-01-999_%E6%B7%B1%E5%85%A5Lua%20/" title="深入Lua">深入Lua</a><time datetime="2024-04-03T03:47:36.244Z" title="发表于 2024-04-03 11:47:36">2024-04-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/zl/2016-01-01-996_evaluation%20and%20selection%20%C2%B7%20ngc7293's%20blog/" title="evaluation and selection · ngc7293's blog"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="evaluation and selection · ngc7293's blog"/></a><div class="content"><a class="title" href="/zl/2016-01-01-996_evaluation%20and%20selection%20%C2%B7%20ngc7293's%20blog/" title="evaluation and selection · ngc7293's blog">evaluation and selection · ngc7293's blog</a><time datetime="2024-04-03T03:47:36.243Z" title="发表于 2024-04-03 11:47:36">2024-04-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/zl/2016-01-01-998_lua%20%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" title="lua 基础数据类型"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="lua 基础数据类型"/></a><div class="content"><a class="title" href="/zl/2016-01-01-998_lua%20%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" title="lua 基础数据类型">lua 基础数据类型</a><time datetime="2024-04-03T03:47:36.243Z" title="发表于 2024-04-03 11:47:36">2024-04-03</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 糖果AIGC实验室 备案:辽ICP备16003836号-5</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><script>(function () {
  var meta = document.createElement('meta');
  meta.content = 'no-referrer';
  meta.name = 'referrer';
  document.getElementsByTagName('head')[0].appendChild(meta);
})();</script></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script></div></body></html>