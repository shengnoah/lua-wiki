{"title":"Moonscript与HTML模板","uid":"ea8283997977848c6827a1a83f28911d","slug":"old_topic/2016-09-17-253","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.225Z","comments":true,"path":"api/articles/old_topic/2016-09-17-253.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":null,"content":"<p>作者：糖果</p>\n<p>Moonscript与HTML模板</p>\n<p>Lapis框架可以用Moonscript直接编程，Moonscript可以将需要模板系统对于的网页输出，一揽子的都在Moonscript中用代码实现，<a href=\"http://xn--leaof-ok2h341apk7e.net/lapis%E4%B8%8B%E6%9C%80%E5%85%B8%E5%9E%8B%E7%9A%84%E5%AE%98%E6%96%B9%E4%BE%8B%E5%AD%90%EF%BC%8C%E5%85%B6%E5%AE%9EDB%E7%9A%84%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%9C%A8moonscript%E4%B8%AD%E9%83%BD%E5%AE%8C%E6%88%90%E4%BA%86%EF%BC%8C%E5%AF%B9%E4%BA%8E%E6%9F%90%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%93%8D%E4%BD%9C%E6%9D%A5%E7%9C%8B%EF%BC%8C%E8%BF%99%E6%98%AF%E5%BE%88%E9%85%B7%E7%9A%84%E3%80%82\">可以看leaof.net/lapis下最典型的官方例子，其实DB的相关操作也可以在moonscript中都完成了，对于某种类型的操作来看，这是很酷的。</a></p>\n<p>我们先来看一下模板的例子：</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import Widget from <span class=\"built_in\">require</span> <span class=\"string\">&quot;lapis.html&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">class Index extends Widget</span><br><span class=\"line\">  content: =&gt;</span><br><span class=\"line\">    h1 class: <span class=\"string\">&quot;header&quot;</span>, <span class=\"string\">&quot;Hello&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    @user_panel!</span><br><span class=\"line\">    div class: <span class=\"string\">&quot;body&quot;</span>, -&gt;</span><br><span class=\"line\">      text <span class=\"string\">&quot;Welcome to my site!&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  user_panel: =&gt;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> unless @current_user</span><br><span class=\"line\">    div class: <span class=\"string\">&quot;user_panel&quot;</span>, <span class=\"string\">&quot;Welcome back &quot;</span> .. @current_user.name</span><br></pre></td></tr></table></figure>\n<p>这段mooncript代码会被翻译成下面的HTML</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h1</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;header&quot;</span>&gt;</span>&lt;%= &quot;Hello&quot; %&gt;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">&lt;% if current_user then %&gt;</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;user_panel&quot;</span>&gt;</span></span><br><span class=\"line\">    Welcome back &lt;%= current_user.name %&gt;</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">&lt;% end %&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;body&quot;</span>&gt;</span></span><br><span class=\"line\">  Welcome to my site</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>在实际leafo之前的应用代码中，利用的最明显的是下面这段：</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import Widget from <span class=\"built_in\">require</span> <span class=\"string\">&quot;lapis.html&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">class PostLayout extends Widget</span><br><span class=\"line\">  content: =&gt;</span><br><span class=\"line\">    @page.template_stack\\push <span class=\"string\">&quot;web&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    div class: <span class=\"string\">&quot;post&quot;</span>, -&gt;</span><br><span class=\"line\">      div class: <span class=\"string\">&quot;sidebar&quot;</span>, -&gt;</span><br><span class=\"line\">        text @root</span><br><span class=\"line\"></span><br><span class=\"line\">      div class: <span class=\"string\">&quot;main_column&quot;</span>, -&gt;</span><br><span class=\"line\">        raw @body</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>下面这句话出现了问题：</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">div class: <span class=\"string\">&quot;sidebar&quot;</span>, -&gt;</span><br><span class=\"line\">  text @root</span><br></pre></td></tr></table></figure>\n<p>@root在某些情况下晃是一个”…“, 这个会造成左边栏的导航栏消失了。</p>\n<p>这里核心的库就是这个lapis.html</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import Widget from require &quot;lapis.html&quot;</span><br></pre></td></tr></table></figure>\n<p>代码太长，就贴个连接过来<br>\n<a href=\"https://github.com/leafo/lapis/blob/master/lapis/html.moon\">lapis.html.moon</a><br>\n,Moonscript如果用来做个人项目还是挺酷的。如何用Moonscript生成Html看下面的连接：<a href=\"http://leafo.net/lapis/reference/html_generation.html\">HTML Generation</a>,<br>\nMoonscript生成大量的前端可以维护起来可能有些难度，但做为生成模板描述，还是方便快速有优势。</p>\n<p>上面的模板定义代中，使用了一个助手函数raw：</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">raw @body</span><br></pre></td></tr></table></figure>\n<p>还使用了另外的一个助手函数：</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">text @root</span><br></pre></td></tr></table></figure>\n<h4 id=\"raw-str\">raw(str)</h4>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>引用文本： — outputs the argument, a string, directly to the buffer without escaping.</p></blockquote>\n<p>raw是直接将字符串写入到buffer，并且不经过转意。</p>\n<h4 id=\"text-args\">text(args)</h4>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>引用文本： — outputs the argument to the buffer, escaping it if it’s a string. If it’s a function, it executes the function in HTML builder environment. If it’s a table, it writes each item in the table</p></blockquote>\n<p>这个函数区别于raws，如果是字符串就转义。是函数就执行。如果是表，把每个元素都写入表。</p>\n<p>上面提到的@root是sitegen的内建变量。</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>引用文本： $root — a relative path prefix that points back to the top level directory of your site. For example, if the current page is wwww/hello/world.html, the $root would be …/. This make it easy to built URLs to other pages without being concerned about where your page is being rendered to.</p></blockquote>\n<p>一般的情况下,@root值就取&quot;.“、”…&quot; 比较常见。不过，此处这种输出会导致左导航栏消失。sitgen, jekyll,还有这个saepy-log，这三个系统，前二者是静态转换Markdown,saepy-log是从Mysql里，读取Markdown（最开始不是，改成了直接支持Markdown。）三个工具分别用三种语言实现。moonscript(lua), ruby, python(tornado)，设计风格也不一样。对SEO支持比较好的是SAEPY_LOG，最酷的还是sitegen。</p>\n","text":"作者：糖果 Moonscript与HTML模板 Lapis框架可以用Moonscript直接编程，Moonscript可以将需要模板系统对于的网页输出，一揽子的都在Moonscript中用代码实现，可以看leaof.net/lapis下最典型的官方例子，其实DB的相关操作也可以在...","link":"","photos":[],"count_time":{"symbolsCount":"2.6k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#raw-str\"><span class=\"toc-text\">raw(str)</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#text-args\"><span class=\"toc-text\">text(args)</span></a></li></ol>","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Octopress评论方本框的样式问题","uid":"f47eb985f6ae8a0bdc7e70fa6ba8170e","slug":"old_topic/2016-09-17-252","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.218Z","comments":true,"path":"api/articles/old_topic/2016-09-17-252.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":null,"text":"作者：糖果 前几天改octopress的样式，发现评论框的样式没了，变成了普通的表单。然后，想用vimdiff在vps上比较一下，发现新版的css就行一行，没有经过格式化，再小伙伴们的支持下，用chrome把css格式化了，然后在老版的css找到了评论文本框的样式，添加到新的cs...","link":"","photos":[],"count_time":{"symbolsCount":"1.9k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Octopress的Figcaption的CSS样式差异","uid":"d97242e82975d5be79f8c9c982dae804","slug":"old_topic/2016-09-17-254","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.166Z","comments":true,"path":"api/articles/old_topic/2016-09-17-254.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":null,"text":"作者、编辑：糖果 新版的Octopress与旧版的的Figcaption的CSS样式差异，以下的CSS是被格式化之后的： 旧版的 12345678910111213141516171819202122232425262728293031.code-title,html .gist...","link":"","photos":[],"count_time":{"symbolsCount":"2.7k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}