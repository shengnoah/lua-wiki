{"title":"稀疏数组","uid":"6e867546fc7beccba02bf189db02a81f","slug":"old_topic/2016-09-17-329","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.204Z","comments":true,"path":"api/articles/old_topic/2016-09-17-329.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","content":"<h1 id=\"稀疏数组\"><a class=\"markdownIt-Anchor\" href=\"#稀疏数组\"></a> 稀疏数组</h1>\n<p>请看示例代码（注意data的数组下标）：</p>\n<pre class=\"line-numbers language-lua\" data-language=\"lua\"><code class=\"language-lua\"><span class=\"token comment\">-- http://www.kyne.com.au/~mark/software/lua-cjson.php</span>\n<span class=\"token comment\">-- version: 2.1 devel</span>\n\n<span class=\"token keyword\">local</span> json <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cjson\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">local</span> data <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">&#125;</span>\ndata<span class=\"token punctuation\">[</span><span class=\"token number\">1000</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">99</span>\n\n<span class=\"token comment\">-- ... do the other things</span>\nngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span>json<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>运行日志报错结果：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">2015&#x2F;06&#x2F;27 00:23:13 [error] 2714#0: *40 lua entry thread aborted: runtime error: ...ork&#x2F;git&#x2F;github.com&#x2F;lua-resty-memcached-server&#x2F;t&#x2F;test.lua:13: Cannot serialise table: excessively sparse array\nstack traceback:\ncoroutine 0:\n    [C]: in function &#39;encode&#39;\n    ...ork&#x2F;git&#x2F;github.com&#x2F;lua-resty-memcached-server&#x2F;t&#x2F;test.lua:13: in function &lt;...ork&#x2F;git&#x2F;github.com&#x2F;lua-resty-memcached-server&#x2F;t&#x2F;test.lua:1&gt;, client: 127.0.0.1, server: localhost, request: &quot;GET &#x2F;test HTTP&#x2F;1.1&quot;, host: &quot;127.0.0.1:8001&quot;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>如果把data的数组下标修改成5，那么这个json.encode就会是成功的。<br />\n结果是：[1,2,null,null,99]</p>\n<p>为什么下标是1000就失败呢？实际上这么做是cjson想保护你的内存资源。她担心这个下标过大直接撑爆内存（贴心小棉袄啊）。如果我们一定要让这种情况下可以encode，就要尝试encode_sparse_array api了。有兴趣的同学可以自己试一试。我相信你看过有关cjson的代码后，就知道cjson的一个简单危险防范应该是怎样完成的。</p>\n","text":" 稀疏数组 请看示例代码（注意data的数组下标）： -- http://www.kyne.com.au/~mark/software/lua-cjson.php -- version: 2.1 devel local json = require(\"cjson\") local ...","link":"","photos":[],"count_time":{"symbolsCount":"1.1k","symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%A8%80%E7%96%8F%E6%95%B0%E7%BB%84\"><span class=\"toc-text\"> 稀疏数组</span></a></li></ol>","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Crontab在SAE中的应用。","uid":"9c523cb4f2eea401eabec06d4f595a71","slug":"old_topic/2016-09-17-33","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.198Z","comments":true,"path":"api/articles/old_topic/2016-09-17-33.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"例行性工作（crontab) 【闲话】 现在是在用蓝牙和手机无限键盘在写这篇博客，测试一下，发现用系统默认的输入法比较痛苦，不知道为什么，光标焦点在手机屏幕上飞来飞去，根本就没有办法正常的进行编辑，换了一个输入法以后，此问题基本上不发生了。 ［问题］什么事crontab? 如果简...","link":"","photos":[],"count_time":{"symbolsCount":394,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua","slug":"lua","count":124,"path":"api/tags/lua.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Jekyll快速生成文件头命令","uid":"28809696492fdd0430c0dee1a4d49fd3","slug":"old_topic/2016-09-17-330","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.161Z","comments":true,"path":"api/articles/old_topic/2016-09-17-330.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"作者：糖果 需要快速生成Markdown的文件头，命令行方式，是相对比较快的： python md-cli.py publish -t LOR -g [getting_started] -k announcements -d &quot;July 3, 2016&quot; -s...","link":"","photos":[],"count_time":{"symbolsCount":742,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}