{"title":"CSRFæ”»å‡»é¢„é˜²çš„Tokenç”ŸæˆåŸç†","uid":"2caace3339612aabd4a60ee7889dcc5d","slug":"old_topic/2016-09-17-155","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.221Z","comments":true,"path":"api/articles/old_topic/2016-09-17-155.json","keywords":"AIGC,LLM,ç³–æœAIGCå®éªŒå®¤","cover":null,"content":"<p>ä½œè€…ï¼šç³–æœ</p>\n<p>ä»¥å¾€æˆ‘ä»¬è®²åˆ°CSRFï¼Œè°ˆåŠéƒ½æ˜¯CSRFçš„æ”»å‡»åŸç†ï¼Œè¿™æ¬¡è®²ä¸€ä¸‹é¢„é˜²CSRFï¼Œç”ŸæˆTokenèƒŒåçš„åŠ å¯†åŸç†å’Œå…·ä½“å®ç°ä¾‹ç¤ºã€‚</p>\n<p>1.Tokenæ„æˆã€‚</p>\n<p>ä»éœ€æ±‚åŠŸèƒ½ä¸Šæ¥è®²ï¼Œä¸ºäº†é˜²æ­¢CSRFå·¥å…·ï¼Œtokenéœ€è¦å…·æœ‰ä¸é‡å¤ï¼Œå¦å¤–ï¼Œè¿˜å«æœ‰ç‰¹å®šçš„åŠŸèƒ½ä¿¡æ¯ï¼Œæ¯”å¦‚è¿‡æœŸæ—¶é—´æˆ³ã€‚</p>\n<p>ä¸‹é¢çš„å›¾æè¿°äº†ä¸€ä¸ªtokençš„æ•°æ®æ„æˆï¼š</p>\n<p>Tokençš„æ•°æ®ç»“æ„ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\">|             msg                  |        separator       |           signature                    |</span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\">|     key     |   timestamp  |              .               |    Base64(sha256(msg))        |</span><br><span class=\"line\">-----------------------------------------------------------------------------</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>tokenç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼ša).msg b). separator c).signatureã€‚</p>\n<p>a). msgéƒ¨åˆ†ï¼šè€Œmsgæœ¬èº«ä¹Ÿæœ‰ä¸¤éƒ¨åˆ†ç»„æˆï¼šä¸€éƒ¨åˆ†ï¼Œéšæœºå­—ç¬¦çš„ä¸»ä½“ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯è¿‡æœŸæ—¶é—´æˆ³ã€‚</p>\n<p>b). åˆ†éš”ç¬¦å·ï¼šç”¨ç¬¦å·åˆ†éš”msgéƒ¨åˆ†ï¼Œå’ŒåŠ å¯†åç”Ÿæˆçš„signatureç­¾åéƒ¨åˆ†ï¼Œè¿™é‡Œç”¨çš„æ˜¯â€.â€œ</p>\n<p>c). ç­¾åsignatureã€‚<br>\nsignatureç­¾åï¼Œæ˜¯å¯¹ä¸Šé¢æåˆ°çš„msgï¼ŒæŒ‰ç…§msgä¸­æåˆ°çš„msgçš„ä¿¡æ¯éƒ¨åˆ†ï¼ŒæŒ‰ç…§ç‰¹å®šçš„ç§˜é”è¿›è¡ŒåŠ å¯†ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">token = base64(msg)æ ¼å¼åŒ–..base64(sha256(&quot;ç§˜é”&quot;, msg))</span><br></pre></td></tr></table></figure>\n<p>2.Tokençš„åŠ å¯†ã€‚é¦–å…ˆï¼Œæ˜¯æŒ‰ç…§åˆé€‚å¾—åŠ å¯†æ–¹æ³•å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚è¿™é‡Œæˆ‘ä»¬é€šç”¨çš„å°±ä½¿ç”¨äº†sha256æ•£åˆ—ç®—æ³•ï¼Œç„¶åè¿›è¡ŒBASE64çš„æ ¼å¼è½¬æ¢ã€‚ç„¶åï¼Œæˆ‘ä»¬éœ€è¦åœ¨tokenä¸²ä¸­éšå«è¿‡æœŸæ—¶é—´çš„è®¾å®šï¼Œä»éœ€æ±‚ä¸Šè®²ï¼Œæ¯æ¡ä¸æœåŠ¡å™¨äº¤äº’çš„tokenæœ‰æ˜¯æœ‰è¿‡æœŸæ—¶é—´çš„ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´èŒƒå›´ï¼Œå°±æ— æ•ˆäº†ï¼Œéœ€è¦é‡æ–°ä»æœåŠ¡å™¨ä¸­å–å¾—ã€‚</p>\n<p>3.Tokençš„éªŒè¯ã€‚</p>\n<p>å½“ç”¨æˆ·ä»å®¢æˆ·ç«¯ï¼Œå¾—åˆ°äº†token,å†æ¬¡æäº¤ç»™æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨éœ€è¦åˆ¤æ–­tokençš„æœ‰æ•ˆæ€§ï¼Œå¦åˆ™ä¸åŠ åˆ¤æ–­ç›´æ¥å¤„ç†æ•°æ®ï¼Œtokençš„ç”Ÿæˆå°±æ— æ„ä¹‰äº†ã€‚</p>\n<p>éªŒè¯çš„è¿‡ç¨‹æ˜¯:</p>\n<p>a). tokenè§£åŒ…ã€‚</p>\n<p>å…ˆæŠŠæ¥å—åˆ°çš„tokenï¼Œè¿›è¡Œåˆ†è§£ã€‚â€œ.â€ä¸ºåˆ†éš”ç¬¦ï¼Œåˆ†ä¸ºmsgéƒ¨åˆ†+signatureç­¾åéƒ¨åˆ†ã€‚</p>\n<p>b). æ¯”å¯¹ç­¾åã€‚</p>\n<p>å¯¹msgéƒ¨åˆ†è¿›è¡Œbase64è§£ç , decode_base64(msg)ç„¶ååœ¨å¯¹è§£ç åçš„msgæ˜æ–‡ï¼Œè¿›è¡ŒåŒæ ·çš„encode_base64(sha256(msg))åŠ å¯†ã€‚ç§˜é”ç›¸åŒï¼Œç„¶åï¼Œåˆ¤æ–­åŠ å¯†åçš„æ•°æ®å’Œå®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„token.signatureçš„éƒ¨åˆ†æ˜¯å¦ä¸€è‡´ã€‚å¦‚æœä¸€è‡´ï¼Œè¯´æ˜è¿™ä¸ªtokenæ˜¯æœ‰æ•ˆçš„ã€‚</p>\n<p>c). åˆ¤æ–­æ—¶é—´è¿‡æœŸã€‚å¦‚æœæ˜¯æœ‰æ•ˆçš„,å–å‡ºmsg.timestampï¼Œå’Œå½“å‰ç³»ç»Ÿæ—¶é—´è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœè¿‡æœŸæ—¶é—´å°äºå½“å‰æ—¶é—´ï¼Œé‚£è¿™ä¸ªtokenæ˜¯è¿‡æœŸçš„ï¼Œéœ€è¦é‡æ–°çš„å–å¾—tokenã€‚</p>\n<p>åŸç†éƒ½é€šç”¨ï¼Œæ­¤å¤„ä½¿ç”¨luaå¯¹ä¸Šå¤„ç†è¿‡ç¨‹è¿›è¡Œæè¿°ã€‚</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">local</span> gen_token = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(key, expires)</span></span></span><br><span class=\"line\">    <span class=\"comment\">--åšæˆä¸€ä¸ªè¿‡æœŸæ—¶é—´æˆ³ã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> expires == <span class=\"literal\">nil</span> <span class=\"keyword\">then</span></span><br><span class=\"line\">     expires = <span class=\"built_in\">os</span>.<span class=\"built_in\">time</span>() + <span class=\"number\">60</span> + <span class=\"number\">60</span> * <span class=\"number\">8</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">   </span><br><span class=\"line\">    <span class=\"comment\">--å¯¹msgéƒ¨åˆ†è¿›è¡Œbase64ç¼–ç ã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">local</span> msg = encode_base64(</span><br><span class=\"line\">     json.encode(&#123;</span><br><span class=\"line\">         key = key,</span><br><span class=\"line\">         expires = expires</span><br><span class=\"line\">     &#125;))</span><br><span class=\"line\">     </span><br><span class=\"line\">   <span class=\"comment\">--è¿›è¡Œsha256å“ˆå¸Œã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">local</span> signature = encode_base64(hmac_sha256(<span class=\"string\">&#x27;testkey&#x27;</span>, msg))</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">--æ‹¼æ¥æˆä¸€æ¡tokenã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> msg .. <span class=\"string\">&quot;.&quot;</span> ..signature</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">local</span>  val_token = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(key,token)</span></span></span><br><span class=\"line\">    <span class=\"comment\">--å¯¹è¾“å…¥æ•°æ®çš„åˆ¤ç©ºæ“ä½œ</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> (token) <span class=\"keyword\">then</span></span><br><span class=\"line\">     <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, <span class=\"string\">&#x27;mssing csrf token&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">--å¯¹tokençš„msgéƒ¨åˆ†ï¼Œsignatureç­¾åéƒ¨åˆ†è¿›è¡Œæ‹†åˆ†ã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">local</span> msg, sig = token:<span class=\"built_in\">match</span>(<span class=\"string\">&quot;^(.*)%.(.*)$&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> (msg) <span class=\"keyword\">then</span></span><br><span class=\"line\">         <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, <span class=\"string\">&quot;malformed csrf token&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    sig = encoding.decode_base64(sig)</span><br><span class=\"line\">    <span class=\"comment\">--å¯¹è§£åŒ…åmsgï¼ŒæŒ‰ç…§ç›¸åŒçš„åŠ å¯†key:&quot;testkey&quot;ï¼Œé‡æ–°è¿›è¡Œsha256å“ˆå¸Œï¼Œæ¯”å¯¹signatureï¼Œ</span></span><br><span class=\"line\">    <span class=\"comment\">--å¦‚æœä¸ä¸€è‡´ï¼Œè¯´æ˜è¿™ä¸ªtokenä¸­çš„æ•°æ®æœ‰é—®é¢˜ï¼Œæ— æ•ˆçš„tokenã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> (sig == hmac_sha256(<span class=\"string\">&#x27;testkey&#x27;</span>, msg)) <span class=\"keyword\">then</span></span><br><span class=\"line\">         <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, <span class=\"string\">&quot;invalid csrf token(bad sig)&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">--å¯¹msgè¿›è¡Œbase64è§£ç ï¼Œåˆ¤æ–­å…¶ä¸­çš„keyå’Œä¼ å…¥çš„keyæ˜¯å¦ä¸€è‡´ã€‚</span></span><br><span class=\"line\">    <span class=\"comment\">--å¦‚æœä¸ä¸€è‡´è¯´æ˜tokenä¹Ÿæ˜¯æ— æ•ˆçš„ã€‚</span></span><br><span class=\"line\">    msg =json.decode(decode_base64(msg))</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> (msg.key == key) <span class=\"keyword\">then</span></span><br><span class=\"line\">     <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, <span class=\"string\">&quot;invalid csrf token (bad key)&quot;</span>    </span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">--å–å‡ºmsgéƒ¨åˆ†çš„æ—¶é—´æˆ³ï¼Œåˆ¤æ–­æ˜¯å¦å¤§äºå½“å‰æ—¶é—´ï¼Œå¦‚æœå¤§äºï¼Œè¯´æ˜tokenè¿‡æœŸæ— æ•ˆäº†ã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> (<span class=\"keyword\">not</span> msg.expires <span class=\"keyword\">or</span> msg.expires &gt; <span class=\"built_in\">os</span>.<span class=\"built_in\">time</span>()) <span class=\"keyword\">then</span></span><br><span class=\"line\">         <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, <span class=\"string\">&quot;csrf token expired&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>ä¸‹é¢æ˜¯å…³äºLuaè¯­è¨€åŠ å¯†åº“ï¼Œluaè¯­è¨€æœ‰åˆ«äºå…¶ä»–è¯­è¨€ï¼Œæ²¡æœ‰åŒæ„çš„å®˜æ–¹æŒ‡å®šåŠ å¯†åº“ï¼Œä¸ºäº†ä¾¿äºè¯»è€…ï¼Œçœ‹åå®è·µï¼Œä¸‹é¢å¯¹luaçš„åŠ å¯†åº“è¿›è¡Œäº†è¡¥å……æè¿°ã€‚luaè¯­è¨€æ˜¯ä¸€ç§å¼±ç±»å‹çš„è¯­è¨€ï¼Œç®€å•æ˜äº†ï¼Œå¯¹äºæè¿°æŸäº›è¯¾é¢˜ï¼Œä¾¿äºè¡¨è¿°ï¼Œç±»ä¼¼äºä¼ªè¯­è¨€ï¼Œæ“ä½œèµ·æ¥ä¹Ÿå¾ˆè½»ä¾¿ï¼Œä¾¿äºå®è·µæ¨æ•²ç®—æ³•ã€‚å³ä½¿ä¹‹åä¸é€‚ç”¨luaï¼Œä¹Ÿå¯ä»¥å¾ˆæ–¹é¢çš„è¿ç§»åˆ°å…¶ä»–è¯­è¨€ã€‚</p>\n<p>æˆ‘ä»¬åœ¨å¼€å‘çš„å·¥ä½œä¸­ï¼Œéš¾å…è¦å¯¹ä¸€äº›æ•°æ®è¿›è¡ŒåŠ å¯†å¤„ç†ï¼Œè€ŒåŠ å¯†æ¨¡å—çš„ä½¿ç”¨æœ‰æ˜¯å°±å¿…ä¸å¯å°‘ã€‚åœ¨luaå®˜æ–¹çš„WIKIåˆ—è¡¨ä¸­å°±åˆ—å‡ºäº†ï¼Œå¾ˆå¤šluaç¨‹åºå†™çš„åŠ å¯†åº“ï¼Œè¿™å†™åŠ å¯†åº“æœ‰çš„æ˜¯ç”¨çº¯luaå†™çš„ï¼Œä¹Ÿæœ‰ç”¨luaè°ƒç”¨Cçš„ç¨‹åºå®ç°åŠ å¯†ã€‚ä¸è¿‡æœ‰äº›æ—¶å€™ç”„é€‰è¿™äº›åº“è¿˜æ˜¯éœ€è¦èŠ±ä¸€äº›æ—¶é—´ç²¾åŠ›ï¼Œåªæ˜¯éœ€è¦æµ‹è¯•ä¸€ä¸‹è¿™æ˜¯åŠ å¯†ç®—æ˜¯å¦æ˜¯å¥½ç”¨çš„ã€‚è¿™æ˜¯luaç»„ç»‡åˆ—å‡ºçš„ä¸€è§ˆåˆ—è¡¨ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://lua-users.org/wiki/CryptographyStuff</span><br></pre></td></tr></table></figure>\n<p>è¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆè¦åŠ å¯†ï¼Œæˆ‘ä»¬é¢ä¸´çš„ä»»åŠ¡æ˜¯ä»€ä¹ˆï¼æˆ‘ä»¬ç°åœ¨é¢ä¸´çš„ä»»åŠ¡æ˜¯ï¼Œè¦å¯¹ä¸€æ®µå­—ç¬¦ä¸²è¿›è¡Œsha256ç®—æ³•åŠ å¯†ã€‚æˆ‘ä»¬ä»åˆ—è¡¨ä¸­é€‰å‡ºäº†å‡ ä¸ªæ”¯æŒsha256åŠ å¯†çš„åŒ…ï¼Œå¹¶è¯´æ˜ä¸€ä¸‹è¿™å‡ ä¸ªå·¥å…·åŒ…ã€‚</p>\n<h3>1.SecureHashAlgorithmå’ŒSecureHashAlgorithmBW</h3> \nè¿™ä¸ªå·¥å…·åŒ…æ˜¯æ”¯æŒsha256åŠ å¯†çš„ï¼Œè€Œä¸”æ˜¯çº¯luaæ–¹æ³•çš„å®ç°ï¼Œé—®é¢˜æ˜¯ï¼Œè¿™ä¸¤ä¸ªåŒ…åˆ†åˆ«ä¾èµ–lua5.2å’Œlua5.3ã€‚\nè€Œæˆ‘ä»¬ç³»ç»Ÿçš„è¿è¡Œç¯å¢ƒæ˜¯lua5.1ï¼Œå› ä¸ºå¤§éƒ¨åˆ†çš„ç”Ÿäº§ç¯å¢ƒéƒ½æ˜¯lua5.1ï¼Œå› ä¸ºå†å²åŸå› æš‚æ—¶æ²¡æ³•æ”¹å˜ã€‚å¦‚æœè¦æŠŠ5.2çš„ç¨‹åºç§»æ¤åˆ°5.1ä¸‹è¿è¡Œï¼Œè¿˜éœ€è¦ç§»æ¤ä¸€ä¸ªlua5.2æ‰ç‹¬æœ‰çš„åŒ…ï¼Œè¿™æ˜¯lua5.2å‡çº§ä¹‹åæ‰æœ‰çš„éƒ¨ä»¶ï¼šbit32,è€Œåœ¨lua5.3ä¸­åˆå°†è¿™ä¸ªéƒ¨ä»¶å»æ‰äº†,ç§»æ¤çš„åŠ¨åŠ›ä¸å¤§ï¼Œæš‚æ—¶ä¸ä½¿ç”¨è¿™ä¸ªåŒ…ã€‚\n<h3>2.Lcrypt</h3> \nè¿™ä¸ªåŒ…ä¸æ˜¯çº¯luaçš„å®ç°ï¼Œåº•å±‚åŠ å¯†ç”¨çš„æ˜¯Cè¯­è¨€ï¼Œè€Œä¸”é¢å¤–è¿˜æœ‰ä¾èµ–å¦å¤–å¦ä¸ªå·¥å…·åŒ… libTomCryptå’ŒlibTomMathï¼Œè¿™ä¸¤ä¸ªåŒ…çš„å®˜ç½‘å·²ç»è¢«å’Œè°äº†ï¼Œgithubä¸Šæœ‰æºç ï¼Œæ‰€ä»¥è¦æƒ³è®©è¿™ä¸ªåŒ…æ­£å¸¸è¿è¡Œéœ€è¦æ‰‹åŠ¨makeå®‰è£…3ä¸ªæºç å·¥ç¨‹ï¼Œè¿˜æ˜¯ç®—äº†ï¼Œæœ‰æ—¶é—´çš„æ—¶å€™å†è£…å¥½æµ‹è¯•ä¸€ä¸‹ï¼Œå…ˆæš‚æ—¶ä¸ç”¨ã€‚\n<p>ç½‘ç«™ï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://www.eder.us/projects/lcrypt/</span><br></pre></td></tr></table></figure>\n<h3>3.LuaCrypto</h3> \nè¿™ä¸ªåŒ…çš„å®‰è£…ç”¨çš„æ˜¯luarocksï¼Œå°±æ¯”è¾ƒç®€å•äº† \n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">luarocks install luacrypto </span><br></pre></td></tr></table></figure>\n<p>æˆ‘ä»¬é€‰ç”¨è¿™ä¸ªåŒ…è¿›è¡ŒåŠ å¯†å¤„ç†ã€‚<br>\nLuaCryptoå…¶å®æ˜¯opensslåº“çš„å‰ç«¯luaè°ƒç”¨ï¼Œä¾èµ–opensslï¼Œopensslåº“æ˜¾ç„¶ä¼šæ”¯æŒsha256åŠ å¯†ï¼Œç›¸å¯¹ä¹Ÿæ¯”ä¸€èˆ¬çš„ç¬¬ä¸‰æ–¹å®ç°æ›´å¯é ã€‚å†™ä¸€ä¸ªç®€å•çš„åŠ å¯†ç¨‹åºï¼š</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">local</span> crypto = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;crypto&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">local</span> hmac = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;crypto.hmac&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">local</span> ret = hmac.digest(<span class=\"string\">&quot;sha256&quot;</span>, <span class=\"string\">&quot;abcdefg&quot;</span>, <span class=\"string\">&quot;hmackey&quot;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(ret)</span><br></pre></td></tr></table></figure>\n<p>retçš„è¿”å›ç»“æœæ˜¯ï¼Œå¦‚ä¸‹è¿™ä¸ªå­—ç¬¦ä¸²ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">704d25d116a700656bfa5a6a7b0f462efdc7df828cdbafa6fbf8b39a12e83f24</span><br></pre></td></tr></table></figure>\n<p>æˆ‘ä»¬éœ€è¦æ”¹é€ ä¸€ä¸‹ä»£ç ï¼Œåœ¨è°ƒç”¨digestçš„æ—¶å€™æŒ‡å®šè¾“å‡ºçš„å½¢å¼æ˜¯rawäºŒè¿›åˆ¶æ•°æ®å½¢å¼ï¼Œç„¶ååœ¨ç¼–ç æˆbase64çš„æ•°æ®å½¢å¼ã€‚</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">local</span> ret = hmac.digest(<span class=\"string\">&quot;sha256&quot;</span>, <span class=\"string\">&quot;abcdefg&quot;</span>, <span class=\"string\">&quot;hmackey&quot;</span>,<span class=\"built_in\">rawequal</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(ret)</span><br></pre></td></tr></table></figure>\n<p>è¿™æ—¶å€™çš„è¾“å‡ºç»“æœæ˜¯ï¼š</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cE0l0RanAGVr+lpqew9GLv3H34KM26+m+/izmhLoPyQ=</span><br><span class=\"line\">lua-base64</span><br></pre></td></tr></table></figure>\n<p>ä½¿ç”¨çš„æ˜¯ä¸‹é¢çš„åº“ï¼Œluaåº“å°±æ˜¯è¿™æ ·ï¼Œæœ‰å¾ˆå¤šåŠŸèƒ½ç¨‹åºæœ‰å¾ˆå¤šçš„å®ç°ï¼Œå¹¶ä¸”å¾ˆå¤šéå®˜æ–¹çš„ç¬¬ä¸‰æ–¹å®ç°ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://github.com/toastdriven/lua-base64</span><br></pre></td></tr></table></figure>\n<p>ä½œè€…ï¼šç³–æœ<br>\nPS:è½¬è½½åˆ°å…¶å®ƒå¹³å°è¯·æ³¨æ˜ä½œè€…å§“ååŠåŸæ–‡é“¾æ¥ï¼Œè¯·å‹¿ç”¨äºå•†ä¸šç”¨é€”ã€‚</p>\n<p><a href=\"http://www.lua.ren/topic/133/lua-faq\" target=\"_blank\">ç‚¹å‡»æŸ¥çœ‹Lua FAQ</a></p>\n","text":"ä½œè€…ï¼šç³–æœ ä»¥å¾€æˆ‘ä»¬è®²åˆ°CSRFï¼Œè°ˆåŠéƒ½æ˜¯CSRFçš„æ”»å‡»åŸç†ï¼Œè¿™æ¬¡è®²ä¸€ä¸‹é¢„é˜²CSRFï¼Œç”ŸæˆTokenèƒŒåçš„åŠ å¯†åŸç†å’Œå…·ä½“å®ç°ä¾‹ç¤ºã€‚ 1.Tokenæ„æˆã€‚ ä»éœ€æ±‚åŠŸèƒ½ä¸Šæ¥è®²ï¼Œä¸ºäº†é˜²æ­¢CSRFå·¥å…·ï¼Œtokenéœ€è¦å…·æœ‰ä¸é‡å¤ï¼Œå¦å¤–ï¼Œè¿˜å«æœ‰ç‰¹å®šçš„åŠŸèƒ½ä¿¡æ¯ï¼Œæ¯”å¦‚è¿‡æœŸæ—¶é—´æˆ³ã€‚ ä¸‹é¢çš„å›¾æè¿°äº†...","link":"","photos":[],"count_time":{"symbolsCount":"4.7k","symbolsTime":"4 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\"><span class=\"toc-text\">1.SecureHashAlgorithmå’ŒSecureHashAlgorithmBW</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\"><span class=\"toc-text\">2.Lcrypt</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\"><span class=\"toc-text\">3.LuaCrypto</span></a></li></ol>","author":{"name":"å®‰å…¨ä¹¦","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"ã€Šå¢¨å®ˆä¹‹é“-WebæœåŠ¡å®‰å…¨æ¶æ„ä¸å®è·µã€‹","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Luaç›¸å…³èµ„æºçš„ä¸‹è½½","uid":"5b530fb1728124affce356d72e211113","slug":"old_topic/2016-09-17-168","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.190Z","comments":true,"path":"api/articles/old_topic/2016-09-17-168.json","keywords":"AIGC,LLM,ç³–æœAIGCå®éªŒå®¤","cover":null,"text":"ä¸€ä¸ªWEBæ¡†æ¶ https://github.com/appwilldev/moochine å‹åŠ›æµ‹è¯•å·¥å…· loadrunner æ·˜å®ä½¿ç”¨çš„å‹æµ‹å·¥å…· tsung å‹æµ‹å·¥å…· tcpcopy cosbenchåˆ†å¸ƒå¼å‹åŠ›æµ‹åº¦å·¥å…· http://reins.se.sjtu.edu.cn/...","link":"","photos":[],"count_time":{"symbolsCount":470,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"å®‰å…¨ä¹¦","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"ã€Šå¢¨å®ˆä¹‹é“-WebæœåŠ¡å®‰å…¨æ¶æ„ä¸å®è·µã€‹","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"LUA FAQæé—®åŒº","uid":"a746a11133e39b0cf464a04ba5004aa9","slug":"old_topic/2016-09-17-169","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.183Z","comments":true,"path":"api/articles/old_topic/2016-09-17-169.json","keywords":"AIGC,LLM,ç³–æœAIGCå®éªŒå®¤","cover":null,"text":"å¦‚æœæ‚¨å¸Œæœ›Lua FAQå‡ºç°ä¸€äº›æ‚¨æ„Ÿå…´è¶£çš„è¯¾é¢˜ï¼Œè¯·åœ¨è¯„è®ºä¸‹ç•™è¨€!ğŸ˜ƒ ","link":"","photos":[],"count_time":{"symbolsCount":35,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"å®‰å…¨ä¹¦","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"ã€Šå¢¨å®ˆä¹‹é“-WebæœåŠ¡å®‰å…¨æ¶æ„ä¸å®è·µã€‹","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}