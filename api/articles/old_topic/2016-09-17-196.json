{"title":"LUA中实现面向对象","uid":"340b5f6f2b7fa198ce66c515bcec1223","slug":"old_topic/2016-09-17-196","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T06:15:59.739Z","comments":true,"path":"api/articles/old_topic/2016-09-17-196.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":null,"content":"<p>我们引用云风大哥的代码：</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">local</span> _class=&#123;&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">class</span><span class=\"params\">(super)</span></span></span><br><span class=\"line\">\t<span class=\"keyword\">local</span> class_type=&#123;&#125;</span><br><span class=\"line\">\tclass_type.ctor=<span class=\"literal\">false</span></span><br><span class=\"line\">\tclass_type.super=super</span><br><span class=\"line\">\tclass_type.new=<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(...)</span></span> </span><br><span class=\"line\">\t\t\t<span class=\"keyword\">local</span> obj=&#123;&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">do</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">local</span> <span class=\"built_in\">create</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">create</span> = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(c,...)</span></span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> c.super <span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"built_in\">create</span>(c.super,...)</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">end</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> c.ctor <span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\t\t\t\tc.ctor(obj,...)</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">end</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">end</span></span><br><span class=\"line\"> </span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">create</span>(class_type,...)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">end</span></span><br><span class=\"line\">\t\t\t<span class=\"built_in\">setmetatable</span>(obj,&#123; <span class=\"built_in\">__index</span>=_class[class_type] &#125;)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> obj</span><br><span class=\"line\">\t\t<span class=\"keyword\">end</span></span><br><span class=\"line\">\t<span class=\"keyword\">local</span> vtbl=&#123;&#125;</span><br><span class=\"line\">\t_class[class_type]=vtbl</span><br><span class=\"line\"> </span><br><span class=\"line\">\t<span class=\"built_in\">setmetatable</span>(class_type,&#123;<span class=\"built_in\">__newindex</span>=</span><br><span class=\"line\">\t\t<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(t,k,v)</span></span></span><br><span class=\"line\">\t\t\tvtbl[k]=v</span><br><span class=\"line\">\t\t<span class=\"keyword\">end</span></span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\"> </span><br><span class=\"line\">\t<span class=\"keyword\">if</span> super <span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">setmetatable</span>(vtbl,&#123;<span class=\"built_in\">__index</span>=</span><br><span class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(t,k)</span></span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">local</span> ret=_class[super][k]</span><br><span class=\"line\">\t\t\t\tvtbl[k]=ret</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> ret</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">end</span></span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t<span class=\"keyword\">end</span></span><br><span class=\"line\"> </span><br><span class=\"line\">\t<span class=\"keyword\">return</span> class_type</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>调用</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">base_type=class()\t\t<span class=\"comment\">-- 定义一个基类 base_type</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">base_type:ctor</span><span class=\"params\">(x)</span></span>\t<span class=\"comment\">-- 定义 base_type 的构造函数</span></span><br><span class=\"line\">\t<span class=\"built_in\">print</span>(<span class=\"string\">&quot;base_type ctor&quot;</span>)</span><br><span class=\"line\">\t<span class=\"built_in\">self</span>.x=x</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">base_type:print_x</span><span class=\"params\">()</span></span>\t<span class=\"comment\">-- 定义一个成员函数 base_type:print_x</span></span><br><span class=\"line\">\t<span class=\"built_in\">print</span>(<span class=\"built_in\">self</span>.x)</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">base_type:hello</span><span class=\"params\">()</span></span>\t<span class=\"comment\">-- 定义另一个成员函数 base_type:hello</span></span><br><span class=\"line\">\t<span class=\"built_in\">print</span>(<span class=\"string\">&quot;hello base_type&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>类继承</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test=class(base_type)\t<span class=\"comment\">-- 定义一个类 test 继承于 base_type</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test:ctor</span><span class=\"params\">()</span></span>\t<span class=\"comment\">-- 定义 test 的构造函数</span></span><br><span class=\"line\">\t<span class=\"built_in\">print</span>(<span class=\"string\">&quot;test ctor&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test:hello</span><span class=\"params\">()</span></span>\t<span class=\"comment\">-- 重载 base_type:hello 为 test:hello</span></span><br><span class=\"line\">\t<span class=\"built_in\">print</span>(<span class=\"string\">&quot;hello test&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n\n<p>再次调用</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a=test.new(<span class=\"number\">1</span>)\t<span class=\"comment\">-- 输出两行，base_type ctor 和 test ctor 。这个对象被正确的构造了。</span></span><br><span class=\"line\">a:print_x()\t<span class=\"comment\">-- 输出 1 ，这个是基类 base_type 中的成员函数。</span></span><br><span class=\"line\">a:hello()\t<span class=\"comment\">-- 输出 hello test ，这个函数被重载了。 </span></span><br></pre></td></tr></table></figure>\n\n<p><a href=\"http://blog.codingnow.com/cloud/LuaOO\">http://blog.codingnow.com/cloud/LuaOO</a></p>\n","text":"我们引用云风大哥的代码： 12345678910111213141516171819202122232425262728293031323334353637383940414243444546local _class=&#123;&#125; function class(sup...","link":"","photos":[],"count_time":{"symbolsCount":"1.6k","symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"toc":"","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"如何定制Nginx的Log输出格式","uid":"047b86aef4992c639f275b13c69e96b7","slug":"old_topic/2016-09-17-194","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T06:15:59.739Z","comments":true,"path":"api/articles/old_topic/2016-09-17-194.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":[],"text":"123456set $currentDate &#x27;day&#x27;; access_by_lua &#x27; ngx.var.currentDate = os.date(&quot;%Y-%m-%d&quot;) &#x27;; access_log /logs/ap...","link":"","photos":[],"count_time":{"symbolsCount":328,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Lapis读取中文Mysql数据的问题","uid":"1f4f3b0cdc7ac1495b8bbbf5b8327672","slug":"old_topic/2016-09-17-203","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T06:15:59.739Z","comments":true,"path":"api/articles/old_topic/2016-09-17-203.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":null,"text":"作者：糖果 在阿里云的VPS上，准备用lapis克隆一版blog程序，就是现在这个发文章的Blog。 Mysql移植的过程中发现的了问题，Lapis读取mysql数据库数据出现乱码。 查看结果集合 1SHOW VARIABLES LIKE &#x27;character%&#x2...","link":"","photos":[],"count_time":{"symbolsCount":"1.9k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}