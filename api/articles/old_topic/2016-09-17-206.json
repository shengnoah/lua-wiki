{"title":"Lapis的layout模板","uid":"b5599f0c4982724e820f3ee1c077e29a","slug":"old_topic/2016-09-17-206","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T06:15:59.740Z","comments":true,"path":"api/articles/old_topic/2016-09-17-206.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":null,"content":"<p>作者：糖果</p>\n<p>在Lapis框架的源码当中的views文件夹有一个layout.lua文件。</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html = <span class=\"built_in\">require</span> <span class=\"string\">&quot;lapis.html&quot;</span></span><br><span class=\"line\">class Default extends html.Widget</span><br><span class=\"line\">  content: =&gt;</span><br><span class=\"line\">    html_5 -&gt;</span><br><span class=\"line\">      head -&gt; title @title <span class=\"keyword\">or</span> <span class=\"string\">&quot;Lapis Page&quot;</span></span><br><span class=\"line\">      body -&gt; @content_for <span class=\"string\">&quot;inner&quot;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>moonscript的代码很简单。提起这个事是因为， 如果不注意这段代码， 在用lapis的render渲染模板时，这个模板生成的”Lapis Page”的Hmtl title标签会覆盖你的etlua中的title标签。 {render = “index”} </p>\n<p>这段程序会自动生成下面下的代码</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">HTML</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Lapis Page<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n\n<p>下面是moonscript翻译后的lua代码</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">content = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(self)</span></span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> html_5(<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span></span><br><span class=\"line\">    head(<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> title(<span class=\"built_in\">self</span>.title <span class=\"keyword\">or</span> <span class=\"string\">&quot;Lapis Page&quot;</span>)</span><br><span class=\"line\">      <span class=\"comment\">--return &quot;&quot; </span></span><br><span class=\"line\">    <span class=\"keyword\">end</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> body(<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">self</span>:content_for(<span class=\"string\">&quot;inner&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">end</span>)</span><br><span class=\"line\">  <span class=\"keyword\">end</span>)</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n\n<p>需要在你的APP里设置self.title=”XXXXXXXX”</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app:get(<span class=\"string\">&quot;/&quot;</span>,</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(self)</span></span></span><br><span class=\"line\">    <span class=\"built_in\">self</span>.title=<span class=\"string\">&quot;smartisan.black&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123; render = <span class=\"string\">&quot;index&quot;</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n\n<p>这样title会被设置成samrtisan.black,但是上面自动生成代码其实还是多余的，最暴力的方法是把layout.lua代码改了。</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">head(<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span></span><br><span class=\"line\">  <span class=\"comment\">--return title(self.title or &quot;Lapis Page&quot;)</span></span><br><span class=\"line\">  eturn <span class=\"string\">&quot;&quot;</span> </span><br><span class=\"line\"><span class=\"keyword\">end</span>)</span><br></pre></td></tr></table></figure>\n\n<p>直接return “”空回去, 这样etlua中的title暂时不会被覆盖了。</p>\n","text":"作者：糖果 在Lapis框架的源码当中的views文件夹有一个layout.lua文件。 1234567html = require &quot;lapis.html&quot;class Default extends html.Widget content: =&gt; ht...","link":"","photos":[],"count_time":{"symbolsCount":"1.2k","symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"toc":"","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Simple HTTP","uid":"cb65b6a08ddc1a4fe7638bb1bb5bebfa","slug":"old_topic/2016-09-17-202","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T06:15:59.739Z","comments":true,"path":"api/articles/old_topic/2016-09-17-202.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":null,"text":"下面是代码： 1234567891011121314151617181920212223242526local http = require(&quot;lapis.nginx.http&quot;)local app = lapis.Application()app:get(&...","link":"","photos":[],"count_time":{"symbolsCount":784,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Linux内存管理","uid":"c3417f1fb400de72f3ba30cadd868e18","slug":"old_topic/2016-09-17-207","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T06:15:59.740Z","comments":true,"path":"api/articles/old_topic/2016-09-17-207.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":null,"text":"","link":"","photos":[],"count_time":{"symbolsCount":0,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}