{"title":"Lapis框架的基本库模板","uid":"35d8b592c5b982bc1f18037d6c818306","slug":"old_topic/2016-09-17-352","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.223Z","comments":true,"path":"api/articles/old_topic/2016-09-17-352.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","content":"<p>作者：糖果</p>\n<h3 id=\"moonscript库模板代码\"><a class=\"markdownIt-Anchor\" href=\"#moonscript库模板代码\"></a> MoonScript库模板代码：</h3>\n<pre class=\"line-numbers language-lua\" data-language=\"lua\"><code class=\"language-lua\"><span class=\"token keyword\">local</span> <span class=\"token operator\">*</span>\n\nconfigs <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span>\n\nconfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>env<span class=\"token punctuation\">,</span> fn<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n  <span class=\"token function\">print</span><span class=\"token punctuation\">(</span>env<span class=\"token punctuation\">,</span> fn<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> <span class=\"token number\">1</span>\n\n\n<span class=\"token function\">setmetatable</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token punctuation\">:</span>config\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span>\n    __call<span class=\"token punctuation\">:</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">...</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> config <span class=\"token punctuation\">...</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"lua库模板代码\"><a class=\"markdownIt-Anchor\" href=\"#lua库模板代码\"></a> Lua库模板代码：</h3>\n<pre class=\"line-numbers language-lua\" data-language=\"lua\"><code class=\"language-lua\"><span class=\"token keyword\">local</span> configs<span class=\"token punctuation\">,</span> config\nconfigs <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">&#125;</span>\nconfig <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>env<span class=\"token punctuation\">,</span> fn<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> <span class=\"token number\">1</span>\n<span class=\"token keyword\">end</span>\n<span class=\"token keyword\">return</span> <span class=\"token function\">setmetatable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>\n  config <span class=\"token operator\">=</span> config\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span>\n  __call <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">...</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">...</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"moonscript如何引用库\"><a class=\"markdownIt-Anchor\" href=\"#moonscript如何引用库\"></a> MoonScript如何引用库</h3>\n<pre class=\"line-numbers language-lua\" data-language=\"lua\"><code class=\"language-lua\">config <span class=\"token operator\">=</span> require <span class=\"token string\">\"lib\"</span>\n\n<span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token function\">type</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">for</span> k<span class=\"token punctuation\">,</span>v <span class=\"token keyword\">in</span> <span class=\"token function\">pairs</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span>\n    <span class=\"token function\">print</span><span class=\"token punctuation\">(</span>k<span class=\"token punctuation\">,</span>v<span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pa'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'pb'</span><span class=\"token punctuation\">)</span>\nconfig<span class=\"token punctuation\">:</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pa'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'pb'</span><span class=\"token punctuation\">)</span>\nconfig<span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pa'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'pb'</span><span class=\"token punctuation\">)</span>\nconfig\\<span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pa'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'pb'</span><span class=\"token punctuation\">)</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"lua如何引用库\"><a class=\"markdownIt-Anchor\" href=\"#lua如何引用库\"></a> Lua如何引用库</h3>\n<pre class=\"line-numbers language-lua\" data-language=\"lua\"><code class=\"language-lua\"><span class=\"token keyword\">local</span> config <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"lib\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token function\">type</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> k<span class=\"token punctuation\">,</span> v <span class=\"token keyword\">in</span> <span class=\"token function\">pairs</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span>\n  <span class=\"token function\">print</span><span class=\"token punctuation\">(</span>k<span class=\"token punctuation\">,</span> v<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span>\n<span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pa'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'pb'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">local</span> _ <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n  config <span class=\"token operator\">=</span> <span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pa'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'pb'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span>\nconfig<span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pa'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'pb'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">return</span> config<span class=\"token punctuation\">:</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pa'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'pb'</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"返回结果\"><a class=\"markdownIt-Anchor\" href=\"#返回结果\"></a> 返回结果</h3>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">table\nconfig  function: 0x11204b0\npa      pb\npa      pb\npa      pb\ntable: 0x10005c0        pa<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>注意一下“.”、“：”这两种调用的区别，“：”调用时会将自己作为第一个参数传给被<br />\n调用函数第一个形参。</p>\n<p>上文提到的例子还是把函数作为元素包在table变量返回，而MoonScript本身是支持类的，所<br />\n以直接用class形式声明的库。</p>\n<h3 id=\"moonscript类库模板代码\"><a class=\"markdownIt-Anchor\" href=\"#moonscript类库模板代码\"></a> MoonScript类库模板代码：</h3>\n<pre class=\"line-numbers language-lua\" data-language=\"lua\"><code class=\"language-lua\">class log\n    @output<span class=\"token punctuation\">:</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span>\n        <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"log\"</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"lua类库模板代码\"><a class=\"markdownIt-Anchor\" href=\"#lua类库模板代码\"></a> Lua类库模板代码：</h3>\n<pre class=\"line-numbers language-lua\" data-language=\"lua\"><code class=\"language-lua\"><span class=\"token keyword\">local</span> log\n<span class=\"token keyword\">do</span>\n  <span class=\"token keyword\">local</span> _class_0\n  <span class=\"token keyword\">local</span> _base_0 <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n    output <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">return</span> <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"log\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token punctuation\">&#125;</span>\n  _base_0<span class=\"token punctuation\">.</span>__index <span class=\"token operator\">=</span> _base_0\n  _class_0 <span class=\"token operator\">=</span> <span class=\"token function\">setmetatable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>\n    __init <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">end</span><span class=\"token punctuation\">,</span>\n    __base <span class=\"token operator\">=</span> _base_0<span class=\"token punctuation\">,</span>\n    __name <span class=\"token operator\">=</span> <span class=\"token string\">\"log\"</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span>\n    __index <span class=\"token operator\">=</span> _base_0<span class=\"token punctuation\">,</span>\n    __call <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>cls<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">...</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">local</span> _self_0 <span class=\"token operator\">=</span> <span class=\"token function\">setmetatable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> _base_0<span class=\"token punctuation\">)</span>\n      cls<span class=\"token punctuation\">.</span><span class=\"token function\">__init</span><span class=\"token punctuation\">(</span>_self_0<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">...</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">return</span> _self_0\n    <span class=\"token keyword\">end</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n  _base_0<span class=\"token punctuation\">.</span>__class <span class=\"token operator\">=</span> _class_0\n  log <span class=\"token operator\">=</span> _class_0\n  <span class=\"token keyword\">return</span> _class_0\n<span class=\"token keyword\">end</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"调用库\"><a class=\"markdownIt-Anchor\" href=\"#调用库\"></a> 调用库</h3>\n<pre class=\"line-numbers language-lua\" data-language=\"lua\"><code class=\"language-lua\">log <span class=\"token operator\">=</span> require <span class=\"token string\">\"1lib\"</span>\n<span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token function\">type</span><span class=\"token punctuation\">(</span>log<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> k<span class=\"token punctuation\">,</span>v <span class=\"token keyword\">in</span> <span class=\"token function\">pairs</span><span class=\"token punctuation\">(</span>log<span class=\"token punctuation\">)</span> \n    <span class=\"token function\">print</span><span class=\"token punctuation\">(</span>k<span class=\"token punctuation\">,</span>v<span class=\"token punctuation\">)</span>\nlog\\<span class=\"token function\">output</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"调用结果\"><a class=\"markdownIt-Anchor\" href=\"#调用结果\"></a> 调用结果</h3>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">table\n__name  log\n__init  function: 0x110a250\noutput  function: 0x110a0a0\n__base  table: 0x10aa5b0\nlog<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>有了class关键字后，后发现require返回的变量依然是table，但多了几个变量，__name,<br />\n__init初始化函数，__base基类表，自定义函数output。</p>\n<p>对于没有继承关系库用table方式封装库直接，需要类依赖的库用class相对方便一些，不过最终<br />\n一切类都是table转化形式。</p>\n<p>本文请不要用于商业目地，非商业转载请署名原作者与原文链接。<br />\n<a href=\"https://www.moonscript.cn/lapis%E6%A1%86%E6%9E%B6/lapis-lib/\">https://www.moonscript.cn/lapis%E6%A1%86%E6%9E%B6/lapis-lib/</a></p>\n","text":"作者：糖果 MoonScript库模板代码： local * configs = &#123;&#125; config = (env, fn) -> print(env, fn) return 1 setmetatable &#123; :config &#125;, &#12...","link":"","photos":[],"count_time":{"symbolsCount":"2.1k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#moonscript%E5%BA%93%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\"> MoonScript库模板代码：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#lua%E5%BA%93%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\"> Lua库模板代码：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#moonscript%E5%A6%82%E4%BD%95%E5%BC%95%E7%94%A8%E5%BA%93\"><span class=\"toc-text\"> MoonScript如何引用库</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#lua%E5%A6%82%E4%BD%95%E5%BC%95%E7%94%A8%E5%BA%93\"><span class=\"toc-text\"> Lua如何引用库</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C\"><span class=\"toc-text\"> 返回结果</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#moonscript%E7%B1%BB%E5%BA%93%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\"> MoonScript类库模板代码：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#lua%E7%B1%BB%E5%BA%93%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\"> Lua类库模板代码：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%B0%83%E7%94%A8%E5%BA%93\"><span class=\"toc-text\"> 调用库</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%B0%83%E7%94%A8%E7%BB%93%E6%9E%9C\"><span class=\"toc-text\"> 调用结果</span></a></li></ol>","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Lapis框架的常用处理方法","uid":"193d30d1b1f932871a7703a692d3a8f9","slug":"old_topic/2016-09-17-351","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.152Z","comments":true,"path":"api/articles/old_topic/2016-09-17-351.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"作者：糖果 在Lapis中处理GET、POST、PUT。 import respond_to from require \"lapis.application\" class App extends lapis.Application @enable \"etlua\" \"/login\"...","link":"","photos":[],"count_time":{"symbolsCount":"1.1k","symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Lua 5.1 リファレンスマニュアル","uid":"f203242dc5cc75b60df934903f73a39e","slug":"old_topic/2016-09-17-349","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.198Z","comments":true,"path":"api/articles/old_topic/2016-09-17-349.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"以下是引用原文： 程序员改Bug的时候 ​​​​ Lua Lua 5.1 リファレンスマニュアル Copyright © 2006 Lua.org, PUC-Rio. All rights reserved. 目次 索引 Top 0 - 日本語訳について 1 - 概要 2 - 言...","link":"","photos":[],"count_time":{"symbolsCount":"106k","symbolsTime":"1:36"},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}