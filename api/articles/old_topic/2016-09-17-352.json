{"title":"Lapis框架的基本库模板","uid":"35d8b592c5b982bc1f18037d6c818306","slug":"old_topic/2016-09-17-352","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T06:15:59.751Z","comments":true,"path":"api/articles/old_topic/2016-09-17-352.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":null,"content":"<p>作者：糖果</p>\n<h3 id=\"MoonScript库模板代码：\"><a href=\"#MoonScript库模板代码：\" class=\"headerlink\" title=\"MoonScript库模板代码：\"></a>MoonScript库模板代码：</h3><figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">local</span> *</span><br><span class=\"line\"></span><br><span class=\"line\">configs = &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">config</span> = (env, fn) -&gt;</span><br><span class=\"line\">  <span class=\"built_in\">print</span>(env, fn)</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">setmetatable</span> &#123;</span><br><span class=\"line\">    :<span class=\"built_in\">config</span></span><br><span class=\"line\">&#125;, &#123;</span><br><span class=\"line\">    <span class=\"built_in\">__call</span>:(...) =&gt; <span class=\"built_in\">config</span> ...</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"Lua库模板代码：\"><a href=\"#Lua库模板代码：\" class=\"headerlink\" title=\"Lua库模板代码：\"></a>Lua库模板代码：</h3><figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">local</span> configs, <span class=\"built_in\">config</span></span><br><span class=\"line\">configs = &#123; &#125;</span><br><span class=\"line\"><span class=\"built_in\">config</span> = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(env, fn)</span></span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">return</span> <span class=\"built_in\">setmetatable</span>(&#123;</span><br><span class=\"line\">  <span class=\"built_in\">config</span> = <span class=\"built_in\">config</span></span><br><span class=\"line\">&#125;, &#123;</span><br><span class=\"line\">  <span class=\"built_in\">__call</span> = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(self, ...)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">config</span>(...)</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"MoonScript如何引用库\"><a href=\"#MoonScript如何引用库\" class=\"headerlink\" title=\"MoonScript如何引用库\"></a>MoonScript如何引用库</h3><figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">config</span> = <span class=\"built_in\">require</span> <span class=\"string\">&quot;lib&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(<span class=\"built_in\">config</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> k,v <span class=\"keyword\">in</span> <span class=\"built_in\">pairs</span>(<span class=\"built_in\">config</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(k,v)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">config</span>(<span class=\"string\">&#x27;pa&#x27;</span>, <span class=\"string\">&#x27;pb&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">config</span>:<span class=\"built_in\">config</span>(<span class=\"string\">&#x27;pa&#x27;</span>, <span class=\"string\">&#x27;pb&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">config</span>.<span class=\"built_in\">config</span>(<span class=\"string\">&#x27;pa&#x27;</span>, <span class=\"string\">&#x27;pb&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">config</span>\\<span class=\"built_in\">config</span>(<span class=\"string\">&#x27;pa&#x27;</span>, <span class=\"string\">&#x27;pb&#x27;</span>)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Lua如何引用库\"><a href=\"#Lua如何引用库\" class=\"headerlink\" title=\"Lua如何引用库\"></a>Lua如何引用库</h3><figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">local</span> <span class=\"built_in\">config</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;lib&quot;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(<span class=\"built_in\">config</span>))</span><br><span class=\"line\"><span class=\"keyword\">for</span> k, v <span class=\"keyword\">in</span> <span class=\"built_in\">pairs</span>(<span class=\"built_in\">config</span>) <span class=\"keyword\">do</span></span><br><span class=\"line\">  <span class=\"built_in\">print</span>(k, v)</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"built_in\">config</span>(<span class=\"string\">&#x27;pa&#x27;</span>, <span class=\"string\">&#x27;pb&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">local</span> _ = &#123;</span><br><span class=\"line\">  <span class=\"built_in\">config</span> = <span class=\"built_in\">config</span>(<span class=\"string\">&#x27;pa&#x27;</span>, <span class=\"string\">&#x27;pb&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">config</span>.<span class=\"built_in\">config</span>(<span class=\"string\">&#x27;pa&#x27;</span>, <span class=\"string\">&#x27;pb&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">return</span> <span class=\"built_in\">config</span>:<span class=\"built_in\">config</span>(<span class=\"string\">&#x27;pa&#x27;</span>, <span class=\"string\">&#x27;pb&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"返回结果\"><a href=\"#返回结果\" class=\"headerlink\" title=\"返回结果\"></a>返回结果</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">table</span><br><span class=\"line\">config  function: 0x11204b0</span><br><span class=\"line\">pa      pb</span><br><span class=\"line\">pa      pb</span><br><span class=\"line\">pa      pb</span><br><span class=\"line\">table: 0x10005c0        pa</span><br></pre></td></tr></table></figure>\n\n<p>注意一下“.”、“：”这两种调用的区别，“：”调用时会将自己作为第一个参数传给被<br>调用函数第一个形参。</p>\n<p>上文提到的例子还是把函数作为元素包在table变量返回，而MoonScript本身是支持类的，所<br>以直接用class形式声明的库。</p>\n<h3 id=\"MoonScript类库模板代码：\"><a href=\"#MoonScript类库模板代码：\" class=\"headerlink\" title=\"MoonScript类库模板代码：\"></a>MoonScript类库模板代码：</h3><figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class <span class=\"built_in\">log</span></span><br><span class=\"line\">    @<span class=\"built_in\">output</span>: =&gt;</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;log&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Lua类库模板代码：\"><a href=\"#Lua类库模板代码：\" class=\"headerlink\" title=\"Lua类库模板代码：\"></a>Lua类库模板代码：</h3><figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">local</span> <span class=\"built_in\">log</span></span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">  <span class=\"keyword\">local</span> _class_0</span><br><span class=\"line\">  <span class=\"keyword\">local</span> _base_0 = &#123;</span><br><span class=\"line\">    <span class=\"built_in\">output</span> = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(self)</span></span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">print</span>(<span class=\"string\">&quot;log&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  _base_0.<span class=\"built_in\">__index</span> = _base_0</span><br><span class=\"line\">  _class_0 = <span class=\"built_in\">setmetatable</span>(&#123;</span><br><span class=\"line\">    __init = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span> <span class=\"keyword\">end</span>,</span><br><span class=\"line\">    __base = _base_0,</span><br><span class=\"line\">    __name = <span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">  &#125;, &#123;</span><br><span class=\"line\">    <span class=\"built_in\">__index</span> = _base_0,</span><br><span class=\"line\">    <span class=\"built_in\">__call</span> = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(cls, ...)</span></span></span><br><span class=\"line\">      <span class=\"keyword\">local</span> _self_0 = <span class=\"built_in\">setmetatable</span>(&#123;&#125;, _base_0)</span><br><span class=\"line\">      cls.__init(_self_0, ...)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> _self_0</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  _base_0.__class = _class_0</span><br><span class=\"line\">  <span class=\"built_in\">log</span> = _class_0</span><br><span class=\"line\">  <span class=\"keyword\">return</span> _class_0</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"调用库\"><a href=\"#调用库\" class=\"headerlink\" title=\"调用库\"></a>调用库</h3><figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">log</span> = <span class=\"built_in\">require</span> <span class=\"string\">&quot;1lib&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(<span class=\"built_in\">log</span>))</span><br><span class=\"line\"><span class=\"keyword\">for</span> k,v <span class=\"keyword\">in</span> <span class=\"built_in\">pairs</span>(<span class=\"built_in\">log</span>) </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(k,v)</span><br><span class=\"line\"><span class=\"built_in\">log</span>\\<span class=\"built_in\">output</span>()</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"调用结果\"><a href=\"#调用结果\" class=\"headerlink\" title=\"调用结果\"></a>调用结果</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">table</span><br><span class=\"line\">__name  log</span><br><span class=\"line\">__init  function: 0x110a250</span><br><span class=\"line\">output  function: 0x110a0a0</span><br><span class=\"line\">__base  table: 0x10aa5b0</span><br><span class=\"line\">log</span><br></pre></td></tr></table></figure>\n\n<p>有了class关键字后，后发现require返回的变量依然是table，但多了几个变量，__name,<br>__init初始化函数，__base基类表，自定义函数output。</p>\n<p>对于没有继承关系库用table方式封装库直接，需要类依赖的库用class相对方便一些，不过最终<br>一切类都是table转化形式。</p>\n<p>本文请不要用于商业目地，非商业转载请署名原作者与原文链接。<br><a href=\"https://www.moonscript.cn/lapis%E6%A1%86%E6%9E%B6/lapis-lib/\">https://www.moonscript.cn/lapis%E6%A1%86%E6%9E%B6/lapis-lib/</a></p>\n","text":"作者：糖果 MoonScript库模板代码：1234567891011121314local *configs = &#123;&#125;config = (env, fn) -&gt; print(env, fn) return 1setmetatable &#123; :c...","link":"","photos":[],"count_time":{"symbolsCount":"2.4k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#MoonScript%E5%BA%93%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81%EF%BC%9A\"><span class=\"toc-text\">MoonScript库模板代码：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Lua%E5%BA%93%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81%EF%BC%9A\"><span class=\"toc-text\">Lua库模板代码：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#MoonScript%E5%A6%82%E4%BD%95%E5%BC%95%E7%94%A8%E5%BA%93\"><span class=\"toc-text\">MoonScript如何引用库</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Lua%E5%A6%82%E4%BD%95%E5%BC%95%E7%94%A8%E5%BA%93\"><span class=\"toc-text\">Lua如何引用库</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C\"><span class=\"toc-text\">返回结果</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#MoonScript%E7%B1%BB%E5%BA%93%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81%EF%BC%9A\"><span class=\"toc-text\">MoonScript类库模板代码：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Lua%E7%B1%BB%E5%BA%93%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81%EF%BC%9A\"><span class=\"toc-text\">Lua类库模板代码：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%B0%83%E7%94%A8%E5%BA%93\"><span class=\"toc-text\">调用库</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%B0%83%E7%94%A8%E7%BB%93%E6%9E%9C\"><span class=\"toc-text\">调用结果</span></a></li></ol>","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Lapis框架的常用处理方法","uid":"193d30d1b1f932871a7703a692d3a8f9","slug":"old_topic/2016-09-17-351","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T06:15:59.751Z","comments":true,"path":"api/articles/old_topic/2016-09-17-351.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":null,"text":"作者：糖果 在Lapis中处理GET、POST、PUT。1234567891011import respond_to from require &quot;lapis.application&quot;class App extends lapis.Application @en...","link":"","photos":[],"count_time":{"symbolsCount":"1.3k","symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"MoonScript实现选择排序","uid":"bde2d986b961652c5b4dbeefb6342f0a","slug":"old_topic/2016-09-17-354","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T06:15:59.752Z","comments":true,"path":"api/articles/old_topic/2016-09-17-354.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":null,"text":"作者：糖果 LUA代码：1234567891011121314list = &#123;1,5,3,2,9,3,6&#125;len=#listfor i=1,len max = list[i] for j=i+1, len do if list[j]&gt;max then t...","link":"","photos":[],"count_time":{"symbolsCount":638,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}