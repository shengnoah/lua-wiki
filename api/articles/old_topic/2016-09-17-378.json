{"title":"Blues框架如何取得请求者的Rquest信息","uid":"5eeea6ebd87d9454a6342cbab6e0f1fc","slug":"old_topic/2016-09-17-378","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.205Z","comments":true,"path":"api/articles/old_topic/2016-09-17-378.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","content":"<p>Blues框架如何取得请求者的Rquest信息</p>\n<p>在request.lua下引用nginx.lua这个lazytable库。</p>\n<pre class=\"line-numbers language-lua\" data-language=\"lua\"><code class=\"language-lua\"><span class=\"token keyword\">local</span> params <span class=\"token operator\">=</span> require <span class=\"token string\">\"nginx\"</span>\n\n<span class=\"token keyword\">function</span> Request<span class=\"token punctuation\">:</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">local</span> name <span class=\"token operator\">=</span> <span class=\"token string\">\"request\"</span>\n        <span class=\"token keyword\">local</span> instance <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span> \n                        url<span class=\"token operator\">=</span><span class=\"token string\">\"/request\"</span><span class=\"token punctuation\">,</span>\n                        getName <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                                <span class=\"token function\">lp</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"CRequest!\"</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token keyword\">end</span> \n                        <span class=\"token punctuation\">&#125;</span>   \n\n        instance<span class=\"token punctuation\">.</span>uri <span class=\"token operator\">=</span> <span class=\"token string\">\"candy lab\"</span>\n        instance<span class=\"token punctuation\">.</span>params <span class=\"token operator\">=</span> params\n        <span class=\"token function\">setmetatable</span><span class=\"token punctuation\">(</span>instance<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span> __index <span class=\"token operator\">=</span> self<span class=\"token punctuation\">,</span>\n                                 __call <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                                                <span class=\"token function\">lp</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Initial Instance\"</span><span class=\"token punctuation\">)</span>\n                                        <span class=\"token keyword\">end</span> \n                                 <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>  \n        <span class=\"token keyword\">return</span> instance\n<span class=\"token keyword\">end</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>app.lua</p>\n<pre class=\"line-numbers language-lua\" data-language=\"lua\"><code class=\"language-lua\">app<span class=\"token punctuation\">:</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/blues\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span>id<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> k<span class=\"token punctuation\">,</span>v <span class=\"token keyword\">in</span> <span class=\"token function\">pairs</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span>\n        ngx<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span>k<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">end</span> \n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">&#123;</span>k<span class=\"token operator\">=</span><span class=\"token string\">'key'</span><span class=\"token punctuation\">,</span> v<span class=\"token operator\">=</span><span class=\"token string\">'value'</span><span class=\"token punctuation\">&#125;</span>\n<span class=\"token keyword\">end</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>","text":"Blues框架如何取得请求者的Rquest信息 在request.lua下引用nginx.lua这个lazytable库。 local params = require \"nginx\" function Request:getInstance() local name = \"re...","link":"","photos":[],"count_time":{"symbolsCount":910,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua","slug":"lua","count":124,"path":"api/tags/lua.json"}],"toc":"","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Moonscript的Map声明差异","uid":"6565f98206b7c6f49f5b3e935831f11b","slug":"old_topic/2016-09-17-375","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.158Z","comments":true,"path":"api/articles/old_topic/2016-09-17-375.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"Moonscript的Map声明差异 在Moonscript中，第一种table map的声明，对变量的赋值使用的是：“=”，，而第二种使用的方式是：“：”，可以通过下面moonc生成的代码，看出差异在那里： 使用：“=” stats= &#123; buffer_size_li...","link":"","photos":[],"count_time":{"symbolsCount":923,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua","slug":"lua","count":124,"path":"api/tags/lua.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Nginx+Lua返回JSON类型数据","uid":"054f428f76705613481e9cfa45f6bed2","slug":"old_topic/2016-09-17-377","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.219Z","comments":true,"path":"api/articles/old_topic/2016-09-17-377.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"作者：糖果 Nginx返回JSON数据，一种是直接在配置文件里设置，一种是通过Lua代码封装完成，讲Nginx中执行Lua返回JSON的关键，一个用API函数ngx.say，同时配合json.encode对JSON格式的字符串进行编码，然后设定响应头信息的类型。 Nginx Co...","link":"","photos":[],"count_time":{"symbolsCount":"2.6k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua","slug":"lua","count":124,"path":"api/tags/lua.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}