{"title":"graylog的sidercar与nxlog部署","uid":"88310665d32cdba1d5ff1f6f71acda67","slug":"old_topic/2016-09-17-390","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T06:15:59.755Z","comments":true,"path":"api/articles/old_topic/2016-09-17-390.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":null,"content":"<p>graylog的sidercar与nxlog部署</p>\n<p>1.去github上下载sidercar.</p>\n<p>2.配置sidercar的配置文件。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server_url: http://192.168.0.3:9100/api </span><br><span class=\"line\">update_interval: 10</span><br><span class=\"line\">tls_skip_verify: false</span><br><span class=\"line\">send_status: true</span><br><span class=\"line\">list_log_files:</span><br><span class=\"line\">node_id: graylog-collector-sidecar</span><br><span class=\"line\">collector_id: file:C:\\Program Files\\graylog\\collector-sidecar\\collector-id</span><br><span class=\"line\">cache_path: C:\\Program Files\\graylog\\collector-sidecar\\cache</span><br><span class=\"line\">log_path: C:\\Program Files\\graylog\\collector-sidecar\\logs</span><br><span class=\"line\">log_rotation_time: 86400</span><br><span class=\"line\">log_max_age: 604800</span><br><span class=\"line\">tags: [windows, iis]</span><br><span class=\"line\">backends:</span><br><span class=\"line\">    - name: nxlog</span><br><span class=\"line\">      enabled: false</span><br><span class=\"line\">      binary_path: C:\\Program Files (x86)\\nxlog\\nxlog.exe</span><br><span class=\"line\">      configuration_path: C:\\Program Files\\graylog\\collector-sidecar\\generated\\nxlog.conf</span><br></pre></td></tr></table></figure>\n\n\n<p>3.安装后，设置服务并启动。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ &quot;C:\\Program Files\\graylog\\collector-sidecar\\graylog-collector-sidecar.exe&quot; -service install</span><br><span class=\"line\">$ &quot;C:\\Program Files\\graylog\\collector-sidecar\\graylog-collector-sidecar.exe&quot; -service start</span><br></pre></td></tr></table></figure>\n\n\n<p>4.安装nxlog。</p>\n<p>5.配置nxlog.conf文件。</p>\n<p>nxlog的配置文件存在一种配对关系，定义Input节、Output节、Route节<br>，下面的配置文件只定义了一个Input,Output的路由对应关系，nxlog是模块化的设计，我们在in这个Input节中，用了im_file这个模块，告诉nxlog去那里读取本地日志文件，我们这定义日志文件放到c:\\rlog\\下的所有.log文件。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;Extension _syslog&gt;</span><br><span class=\"line\">    Module      xm_syslog</span><br><span class=\"line\">&lt;/Extension&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;Input in&gt;</span><br><span class=\"line\">    Module    im_file </span><br><span class=\"line\">    file    &#x27;C:\\\\rlog\\\\*.log&#x27;</span><br><span class=\"line\">    SavePos    TRUE</span><br><span class=\"line\">&lt;/Input&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;Output out&gt;</span><br><span class=\"line\">    Module      om_udp</span><br><span class=\"line\">    Host        192.168.1.3</span><br><span class=\"line\">    Port        521</span><br><span class=\"line\">    Exec parse_syslog(); </span><br><span class=\"line\">&lt;/Output&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&lt;Route 1&gt;</span><br><span class=\"line\">    Path        in =&gt; out</span><br><span class=\"line\">&lt;/Route&gt;</span><br></pre></td></tr></table></figure>\n<p>名out的Output节定义的是输出才用什么协议，并解析成什么形式，使用om_udp模块，将本的日志文件以udp传输协议，输出成syslog形式，到指定的服务器,syslog服务器或是graylog的数据接收端口。</p>\n<p>安装服务</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nxlog -i</span><br></pre></td></tr></table></figure>\n\n<p>停止一下nxlog，如果启动了。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nxlog -s</span><br></pre></td></tr></table></figure>\n\n<p>在后端启动nxlog监听服务</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nxlog -f</span><br></pre></td></tr></table></figure>\n\n\n<p>看一下默认的位置nxlog的启动log。</p>\n<p>文件位置：C:\\Program Files (x86)\\nxlog\\data</p>\n<p>正常启动nxlog会显示下面的字样：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2017-08-16 17:02:15 INFO nxlog-ce-2.9.1716 started</span><br></pre></td></tr></table></figure>\n\n<p>如果出现这样的字段就OK了，如有其它警告和提示，可能是配置文件写错了。</p>\n","text":"graylog的sidercar与nxlog部署 1.去github上下载sidercar. 2.配置sidercar的配置文件。 1234567891011121314151617server_url: http://192.168.0.3:9100/api update_in...","link":"","photos":[],"count_time":{"symbolsCount":"1.9k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[{"name":"lua","slug":"lua","count":153,"path":"api/tags/lua.json"}],"toc":"","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"使用windump监控流量","uid":"2eb9778cfe15235d511c05b2278c1e5d","slug":"old_topic/2016-09-17-389","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T06:15:59.754Z","comments":true,"path":"api/articles/old_topic/2016-09-17-389.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":null,"text":"windump相关于linux和mac上的tcpdump，有些场景在windows平台上使用windump要比wireshark方便一些,wireshark是GUI形式的，还支持lua插件，有机会我们介绍wireshark的lua插件，windump是一个分析tcp/udp/ic...","link":"","photos":[],"count_time":{"symbolsCount":802,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[{"name":"lua","slug":"lua","count":153,"path":"api/tags/lua.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"TMUX最常用操作命令","uid":"65ce57f5fdb9c6ca938fd44776fc3ed9","slug":"old_topic/2016-09-17-386","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T06:15:59.754Z","comments":true,"path":"api/articles/old_topic/2016-09-17-386.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":null,"text":"作者：糖果 一般情况下，当你用SSH链接VPS，然后关掉terminal的操作窗口时，所有的当前操作都结束了。而如果用TMUX,当前正在运行的非后台操作会话还会存在，下面是TMUX最常用的操作了。 1.创建新会话tmux new -s candylab 2.选择新会话tmux a...","link":"","photos":[],"count_time":{"symbolsCount":385,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[{"name":"lua","slug":"lua","count":153,"path":"api/tags/lua.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}