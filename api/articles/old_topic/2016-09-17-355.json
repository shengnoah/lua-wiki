{"title":"MoonScript调用LUA-CJSON","uid":"76c3bd62c0bfebefa8d37c47bf8fd902","slug":"old_topic/2016-09-17-355","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.159Z","comments":true,"path":"api/articles/old_topic/2016-09-17-355.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":null,"content":"<p>作者：糖果</p>\n<p>Lapis的util库有对cjson封装，而我们想更直接的调用CJSON的方法，而不想依赖的封装。</p>\n<p>我们首先实现一个MoonScript写文件的代码：</p>\n<h3 id=\"写文件：\">写文件：</h3>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">write_data = (var, rule)-&gt;</span><br><span class=\"line\">    <span class=\"built_in\">path</span> = <span class=\"string\">&quot;/home/xxx&quot;</span>  </span><br><span class=\"line\">    file = <span class=\"built_in\">io</span>.<span class=\"built_in\">open</span>(<span class=\"built_in\">path</span>,<span class=\"string\">&quot;aw&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> file==<span class=\"literal\">nil</span> <span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\"></span><br><span class=\"line\">    ret = file\\<span class=\"built_in\">write</span>(rule)</span><br><span class=\"line\">    file\\<span class=\"built_in\">close</span>()</span><br><span class=\"line\">    <span class=\"keyword\">return</span>(t)</span><br></pre></td></tr></table></figure>\n<h3 id=\"访问接口：\">访问接口：</h3>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">restyhttp = <span class=\"built_in\">require</span> <span class=\"string\">&quot;resty.http&quot;</span></span><br><span class=\"line\">httpc = restyhttp.new()</span><br><span class=\"line\">res, err = httpc\\request_uri(<span class=\"string\">&quot;http://0.0.0.0/getjson&quot;</span>)</span><br><span class=\"line\">jsonbody = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> res.<span class=\"built_in\">status</span> == ngx.HTTP_OK </span><br><span class=\"line\">  jsonbody = res.body</span><br><span class=\"line\"><span class=\"keyword\">else</span> </span><br><span class=\"line\">  jsonbody = <span class=\"literal\">nil</span> </span><br></pre></td></tr></table></figure>\n<h3 id=\"对JSON数据DECODE\">对JSON数据DECODE:</h3>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">write_data(<span class=\"number\">0</span>, jsonbody)</span><br><span class=\"line\">t = json.decode(jsonbody)</span><br><span class=\"line\">tjson = json.decode(t[<span class=\"string\">&#x27;message&#x27;</span>])</span><br><span class=\"line\">ngx.say(util.serialise_value(tjson))</span><br><span class=\"line\"><span class=\"string\">&quot;&quot;</span></span><br></pre></td></tr></table></figure>","text":"作者：糖果 Lapis的util库有对cjson封装，而我们想更直接的调用CJSON的方法，而不想依赖的封装。 我们首先实现一个MoonScript写文件的代码： 写文件： 12345678910write_data = (var, rule)-&gt; path = &quot...","link":"","photos":[],"count_time":{"symbolsCount":689,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%86%99%E6%96%87%E4%BB%B6%EF%BC%9A\"><span class=\"toc-text\">写文件：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%AE%BF%E9%97%AE%E6%8E%A5%E5%8F%A3%EF%BC%9A\"><span class=\"toc-text\">访问接口：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AF%B9JSON%E6%95%B0%E6%8D%AEDECODE\"><span class=\"toc-text\">对JSON数据DECODE:</span></a></li></ol>","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"MoonScript实现选择排序","uid":"bde2d986b961652c5b4dbeefb6342f0a","slug":"old_topic/2016-09-17-354","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.167Z","comments":true,"path":"api/articles/old_topic/2016-09-17-354.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":null,"text":"作者：糖果 LUA代码： 1234567891011121314list = &#123;1,5,3,2,9,3,6&#125;len=#listfor i=1,len max = list[i] for j=i+1, len do if list[j]&gt;max then ...","link":"","photos":[],"count_time":{"symbolsCount":638,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"MoonScript实现Map按值排序","uid":"8df307659316a77ab2a33659c2147085","slug":"old_topic/2016-09-17-353","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.217Z","comments":true,"path":"api/articles/old_topic/2016-09-17-353.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":null,"text":"作者：糖果 MoonScript代码： 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051board = &#123; [&#x27;0.0.0...","link":"","photos":[],"count_time":{"symbolsCount":"2k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}