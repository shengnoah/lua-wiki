{"title":"Lapis读取中文Mysql数据的问题","uid":"1f4f3b0cdc7ac1495b8bbbf5b8327672","slug":"old_topic/2016-09-17-203","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T06:15:59.739Z","comments":true,"path":"api/articles/old_topic/2016-09-17-203.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":null,"content":"<p>作者：糖果</p>\n<p>在阿里云的VPS上，准备用lapis克隆一版blog程序，就是现在这个发文章的Blog。</p>\n<p>Mysql移植的过程中发现的了问题，Lapis读取mysql数据库数据出现乱码。</p>\n<p>查看结果集合</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SHOW VARIABLES LIKE &#x27;character%&#x27;;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; SET character_set_client = utf8 ;  </span><br><span class=\"line\">mysql&gt; SET character_set_connection = utf8 ;   </span><br><span class=\"line\">mysql&gt; SET character_set_database = utf8 ;   </span><br><span class=\"line\">mysql&gt; SET character_set_results = utf8 ;    </span><br><span class=\"line\">mysql&gt; SET character_set_server = utf8 ;   </span><br><span class=\"line\"> </span><br><span class=\"line\">mysql&gt; SET collation_connection = utf8 ;  </span><br><span class=\"line\">mysql&gt; SET collation_database = utf8 ;   </span><br><span class=\"line\">mysql&gt; SET collation_server = utf8 ; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">SET NAMES &#x27;utf8&#x27;;  </span><br><span class=\"line\"></span><br><span class=\"line\">SET character_set_client = utf8;  </span><br><span class=\"line\">SET character_set_results = utf8;   </span><br><span class=\"line\">SET character_set_connection = utf8; </span><br></pre></td></tr></table></figure>\n\n\n<p>上面这些在运行修改参数的方式，phpmyadmin修改有限的字符的方式都失灵。</p>\n<h3><strong>注意，下面才是好用的方法：</strong></h3>  \n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysqld --character-set-server=utf8</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; SHOW VARIABLES LIKE &#x27;character%&#x27;;</span><br><span class=\"line\">+--------------------------+----------------------------+</span><br><span class=\"line\">| Variable_name            | Value                      |</span><br><span class=\"line\">+--------------------------+----------------------------+</span><br><span class=\"line\">| character_set_client     | utf8                       |</span><br><span class=\"line\">| character_set_connection | utf8                       |</span><br><span class=\"line\">| character_set_database   | utf8                       |</span><br><span class=\"line\">| character_set_filesystem | binary                     |</span><br><span class=\"line\">| character_set_results    | utf8                       |</span><br><span class=\"line\">| character_set_server     | utf8                       |</span><br><span class=\"line\">| character_set_system     | utf8                       |</span><br><span class=\"line\">| character_sets_dir       | /usr/share/mysql/charsets/ |</span><br><span class=\"line\">+--------------------------+----------------------------+</span><br><span class=\"line\">8 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysqld --character-set-server=latin1 \\</span><br><span class=\"line\">           --collation-server=latin1_swedish_ci</span><br></pre></td></tr></table></figure>\n\n<p>另外，collation-server可以在phpmyadmin和mysql-workbench修改，就是GUI有些罗嗦。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./configure --with-charset=latin1 \\</span><br><span class=\"line\">           --with-collation=latin1_german1_ci</span><br></pre></td></tr></table></figure>\n\n<p>这种编译时指定，个人很少用，没试过。</p>\n<p>Lapis目前最大的问题是Moonscript翻译过来的lua代码，人类不易看懂。</p>\n<p>这个问题是不是，lapis以来resty mysql引起呢，因为resty mysql connect数据库的时候，不能指定字符集，不能很肯定，没看源码。</p>\n<p><a href=\"https://github.com/openresty/lua-resty-mysql/issues/20\">下面这个连接是春哥对这个问的回答，供参考：</a></p>\n","text":"作者：糖果 在阿里云的VPS上，准备用lapis克隆一版blog程序，就是现在这个发文章的Blog。 Mysql移植的过程中发现的了问题，Lapis读取mysql数据库数据出现乱码。 查看结果集合 1SHOW VARIABLES LIKE &#x27;character%&#x2...","link":"","photos":[],"count_time":{"symbolsCount":"1.9k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\"><span class=\"toc-text\">注意，下面才是好用的方法：</span></a></li></ol>","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"LUA中实现面向对象","uid":"340b5f6f2b7fa198ce66c515bcec1223","slug":"old_topic/2016-09-17-196","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T06:15:59.739Z","comments":true,"path":"api/articles/old_topic/2016-09-17-196.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":null,"text":"我们引用云风大哥的代码： 12345678910111213141516171819202122232425262728293031323334353637383940414243444546local _class=&#123;&#125; function class(sup...","link":"","photos":[],"count_time":{"symbolsCount":"1.6k","symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"误删Unity导致Ubuntu桌面左边栏消失","uid":"9e3528aaa8fffc1f32ba95ca160d9152","slug":"old_topic/2016-09-17-201","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T06:15:59.739Z","comments":true,"path":"api/articles/old_topic/2016-09-17-201.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":null,"text":"昨天安装老的版本的Django,删除Python，误删除了Unity．结果发现桌面的左边栏和Terminal的标题栏都没了． 恢复安装一下就好了． 12sudo apt-get install unitysudo apt-get install gnome-terminal 这样...","link":"","photos":[],"count_time":{"symbolsCount":150,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}