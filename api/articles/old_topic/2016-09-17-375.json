{"title":"Moonscript的Map声明差异","uid":"6565f98206b7c6f49f5b3e935831f11b","slug":"old_topic/2016-09-17-375","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.158Z","comments":true,"path":"api/articles/old_topic/2016-09-17-375.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","content":"<p>Moonscript的Map声明差异</p>\n<p>在Moonscript中，第一种table map的声明，对变量的赋值使用的是：“=”，，而第二种使用的方式是：“：”，可以通过下面moonc生成的代码，看出差异在那里：</p>\n<p>使用：“=”</p>\n<pre class=\"line-numbers language-lua\" data-language=\"lua\"><code class=\"language-lua\">stats<span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n    buffer_size_limit<span class=\"token punctuation\">:</span> t<span class=\"token punctuation\">[</span><span class=\"token string\">'journal_size_limit'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    buffer_size<span class=\"token punctuation\">:</span> t<span class=\"token punctuation\">[</span><span class=\"token string\">'journal_size'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">&#125;</span>\n\n\n  <span class=\"token keyword\">local</span> stats <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n    buffer_size_limit <span class=\"token operator\">=</span> t<span class=\"token punctuation\">[</span><span class=\"token string\">'journal_size_limit'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    buffer_size <span class=\"token operator\">=</span> t<span class=\"token punctuation\">[</span><span class=\"token string\">'journal_size'</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>使用：“：”</p>\n<pre class=\"line-numbers language-lua\" data-language=\"lua\"><code class=\"language-lua\">stats<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span>\n    buffer_size_limit<span class=\"token punctuation\">:</span> t<span class=\"token punctuation\">[</span><span class=\"token string\">'journal_size_limit'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    buffer_size<span class=\"token punctuation\">:</span> t<span class=\"token punctuation\">[</span><span class=\"token string\">'journal_size'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">&#125;</span>\n\n  <span class=\"token keyword\">local</span> _ <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n    stats <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n      buffer_size_limit <span class=\"token operator\">=</span> t<span class=\"token punctuation\">[</span><span class=\"token string\">'journal_size_limit'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      buffer_size <span class=\"token operator\">=</span> t<span class=\"token punctuation\">[</span><span class=\"token string\">'journal_size'</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">&#125;</span>\n  <span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>而上述这种差异，会在什么地方起作用呢？</p>\n<pre class=\"line-numbers language-lua\" data-language=\"lua\"><code class=\"language-lua\">json <span class=\"token operator\">=</span> require <span class=\"token string\">\"cjson\"</span>\nutil <span class=\"token operator\">=</span> require <span class=\"token string\">\"cjson.util\"</span>\n\nstats<span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n    buffer_size_limit<span class=\"token punctuation\">:</span> t<span class=\"token punctuation\">[</span><span class=\"token string\">'journal_size_limit'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    buffer_size<span class=\"token punctuation\">:</span> t<span class=\"token punctuation\">[</span><span class=\"token string\">'journal_size'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">&#125;</span>\n\njson<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span>\n   success<span class=\"token punctuation\">:</span> <span class=\"token keyword\">true</span>\n   message<span class=\"token punctuation\">:</span> json<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>stats<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">&#125;</span>     <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>在Cjson的encode时，如果选用的表变量是&quot;:&quot;声明，基本是无法编码成json出来的，不出意外，返回的就是一个’null’。</p>\n","text":"Moonscript的Map声明差异 在Moonscript中，第一种table map的声明，对变量的赋值使用的是：“=”，，而第二种使用的方式是：“：”，可以通过下面moonc生成的代码，看出差异在那里： 使用：“=” stats= &#123; buffer_size_li...","link":"","photos":[],"count_time":{"symbolsCount":923,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua","slug":"lua","count":124,"path":"api/tags/lua.json"}],"toc":"","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Openresty OOM 臭虫","uid":"90f8068c136a1c725371f517843fe478","slug":"old_topic/2016-09-17-376","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.226Z","comments":true,"path":"api/articles/old_topic/2016-09-17-376.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":" Openresty OOM 臭虫 最近我在线上改变了一个的 Nginx 配置，导致 OOM（Out of Memory） killer 在 Nginx 加载新配置的过程中 杀死了 Nginx 进程。这是添加到配置中的行： lua_ssl_trusted_certificate ...","link":"","photos":[],"count_time":{"symbolsCount":"22k","symbolsTime":"20 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua","slug":"lua","count":124,"path":"api/tags/lua.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Blues框架如何取得请求者的Rquest信息","uid":"5eeea6ebd87d9454a6342cbab6e0f1fc","slug":"old_topic/2016-09-17-378","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.205Z","comments":true,"path":"api/articles/old_topic/2016-09-17-378.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"Blues框架如何取得请求者的Rquest信息 在request.lua下引用nginx.lua这个lazytable库。 local params = require \"nginx\" function Request:getInstance() local name = \"re...","link":"","photos":[],"count_time":{"symbolsCount":910,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua","slug":"lua","count":124,"path":"api/tags/lua.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}