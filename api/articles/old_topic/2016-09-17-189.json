{"title":"Moonscript的Busted单体测试","uid":"43450fb948daac9a77b252ddeba99506","slug":"old_topic/2016-09-17-189","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.199Z","comments":true,"path":"api/articles/old_topic/2016-09-17-189.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","content":"<p>作者：糖果</p>\n<p>Busted是Lua的单体测试工具。<br />\n去官网Github看一下，也支持Moonscript的单体测试。</p>\n<p>moonunit.moon</p>\n<pre class=\"line-numbers language-lua\" data-language=\"lua\"><code class=\"language-lua\">describe <span class=\"token string\">'moonscript tests'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n  it <span class=\"token string\">'works'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n    assert<span class=\"token punctuation\">.</span>are<span class=\"token punctuation\">.</span>equal <span class=\"token keyword\">true</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">true</span>\n    <span class=\"token keyword\">return</span>\n  <span class=\"token keyword\">return</span>\n<span class=\"token keyword\">return</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>Describe关键字：描述了一组单元测试。<br />\nIt关键字： 是对一个Case的描述。</p>\n<p>把Moonscript脚本，翻译成Lua脚本。<br />\nmoonc  moonunit.moon</p>\n<pre class=\"line-numbers language-lua\" data-language=\"lua\"><code class=\"language-lua\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'moonscript tests'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'works'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    assert<span class=\"token punctuation\">.</span>are<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">true</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">true</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">end</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>其实，不用有这个翻译过程，因为busted直接可以解析.moon脚本。</p>\n<p>因为这个脚本只有一个Case，所有显示结果如下：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\"> busted moonunit.moon \n●\n1 success &#x2F; 0 failures &#x2F; 0 errors &#x2F; 0 pending : 0.000782 seconds<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>下面我们估计，把Case的表达结果，改成NG。</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">describe &#39;moonscript tests&#39;, -&gt;\n  it &#39;works&#39;, -&gt;\n    assert.are.equal true, false\n    return                \n  return\nreturn<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">busted moonunit.moon \n◼\n0 successes &#x2F; 1 failure &#x2F; 0 errors &#x2F; 0 pending : 0.000996 seconds\n\nFailure → moonunit.moon @ 2\nmoonscript tests works\nmoonunit.moon:3: Expected objects to be equal.\nPassed in:\n(boolean) false\nExpected:\n(boolean) true<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>如预期一样，出现了NG报告。</p>\n<p>在另一篇中，我们用Vanilla框架的Simple Route做例子，写单体测试CASE。</p>\n","text":"作者：糖果 Busted是Lua的单体测试工具。 去官网Github看一下，也支持Moonscript的单体测试。 moonunit.moon describe 'moonscript tests', -> it 'works', -> assert.are.equal true...","link":"","photos":[],"count_time":{"symbolsCount":"1k","symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[],"toc":"","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Moonscript的循环结构","uid":"b8a0477ffed33bd6d0efdb938e9ec4db","slug":"old_topic/2016-09-17-187","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.229Z","comments":true,"path":"api/articles/old_topic/2016-09-17-187.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"除了使用迭代器，某些应用场合，我们还需要使用固定次数的循环结构，Moonscript提供While风格 的固定循环控制。 Moonscript class extends lapis.Application [loop: \"/loop\"]:=> @html -> i = 10 w...","link":"","photos":[],"count_time":{"symbolsCount":607,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"给Vanilla框架的路由模块加入单体测试","uid":"2ae7e20708abb11b61241dea5050fc63","slug":"old_topic/2016-09-17-188","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.195Z","comments":true,"path":"api/articles/old_topic/2016-09-17-188.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"作者：糖果 下面是单体测试的代码： -- perf local error = error local sgmatch = string.gmatch -- init Simple and set routes local Simple = &#123;&#125; functi...","link":"","photos":[],"count_time":{"symbolsCount":871,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}