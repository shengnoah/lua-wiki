{"title":"如何在Lapis中给前端JS传送JSON数据对象","uid":"210155a39a8b6625ee1b84d14c0c7978","slug":"old_topic/2016-09-17-199","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.201Z","comments":true,"path":"api/articles/old_topic/2016-09-17-199.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","content":"<p>在Lua编写WEB程序的过程中， 有一种应用场景，是从KVDB,或是DB中取出JSON数据，或是直接定义JSON数据传给前端，用于显示展示，或是其它之用。</p>\n<p>为了减化说明，我们直接用一个不是从DB取得，而是自定义一个JSON数据， 返回给前端的模板。</p>\n<p>Lapis lua代码：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">app:get(&quot;&#x2F;return_json&quot;, function(self)\n        --自定义一个最简单的JSON结构\n        tmp_json&#x3D; &#123;test&#x3D;&quot;abc&quot;&#125;\n        --对JSON进行编码\n        self.tmp_json &#x3D; json.encode(tmp_json)\n        --渲染模板\n        return &#123; render &#x3D; &quot;json_template&quot; &#125;\nend)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>Javascript代码：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;\n\n    &#x2F;&#x2F;这个函数是对文本中含有的特殊符号进行转换处理\n    function htmlspecialchars_decode(text) &#123;\n        var replacements &#x3D; Array(&quot;&amp;&quot;, &quot;&lt;&quot;, &quot;&gt;&quot;, &#39;&quot;&#39;, &quot;&#39;&quot;);\n        var chars &#x3D; Array(&quot;&amp;&quot;, &quot;&lt;&quot;, &quot;&gt;&quot;, &quot;&quot;&quot;, &quot;&#39;&quot;);\n        for (var i &#x3D; 0; i &lt; chars.length; i++) &#123;\n            var re &#x3D; new RegExp(chars[i], &quot;gi&quot;);\n            if (re.test(text)) &#123;\n                text &#x3D; text.replace(re, replacements[i]);\n            &#125;\n        &#125;\n        return text;\n    &#125;\n\n    &#x2F;&#x2F; 从etlua模板中，取出lapis传递的值。\n    var tmp_json &#x3D; &quot;&lt;%&#x3D; tmp_json %&gt;&quot;\n    &#x2F;&#x2F; 转换特殊符号\n    var html_tmp_json &#x3D; htmlspecialchars_decode(tmp_json)\n\n    &#x2F;&#x2F;  这是将一个普通的字符串，转换成Javascript的JSON对象\n    var js_json &#x3D; eval(html_tmp_json);\n&lt;&#x2F;script&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>整个JSON从Lua到JS对象过程是：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">lua table-&gt; lua json-&gt; js string-&gt;js object<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>中间特殊符号的处理，只是改变了内容，而没改变数据型态。</p>\n<p>这个例子是返回JSON数据，同时我们也可以传JSON数据给Lapis， 之后我们可能会简单介绍一下Lapis如何解释JSON参数。</p>\n","text":"在Lua编写WEB程序的过程中， 有一种应用场景，是从KVDB,或是DB中取出JSON数据，或是直接定义JSON数据传给前端，用于显示展示，或是其它之用。 为了减化说明，我们直接用一个不是从DB取得，而是自定义一个JSON数据， 返回给前端的模板。 Lapis lua代码： ap...","link":"","photos":[],"count_time":{"symbolsCount":"1.6k","symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[],"toc":"","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"来至英国朋友的消息","uid":"8b705c23d4a474e218260c1eafaf275e","slug":"old_topic/2016-09-17-197","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.233Z","comments":true,"path":"api/articles/old_topic/2016-09-17-197.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"[Alert] Importance message for British nationals in Beijing The British Embassy Beijing has received information of possible threats against...","link":"","photos":[],"count_time":{"symbolsCount":610,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Python的PIP应用Fetch不到下载文件","uid":"f7046ce417542dc934d2749b052430d6","slug":"old_topic/2016-09-17-200","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.179Z","comments":true,"path":"api/articles/old_topic/2016-09-17-200.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"如果出现，以下的消息，或者是在Python源码里，直接抛出异常，类似Connect Error的信息，可以肯定的是链接pypi的安装数据源出现问题了． Cannot fetch index base URL https:&#x2F;&#x2F;pypi.python.org&#x...","link":"","photos":[],"count_time":{"symbolsCount":703,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}