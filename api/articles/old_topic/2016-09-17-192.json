{"title":"LUACURL使用笔记","uid":"2f345e8c1c99108bbbdc1391c900b270","slug":"old_topic/2016-09-17-192","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.218Z","comments":true,"path":"api/articles/old_topic/2016-09-17-192.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","content":"<p>CURL是 URL命令行工具， 即 command URL， 可以通过命令行模拟各种应用协议的发包， 包括FTP HTTP HTTPS，</p>\n<p>官方网站</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">http:&#x2F;&#x2F;curl.haxx.se&#x2F;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>luacurl<br />\nlua curl是基于curl的库libcurl</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">http:&#x2F;&#x2F;curl.haxx.se&#x2F;libcurl&#x2F;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>针对libcurl开放的API</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">http:&#x2F;&#x2F;curl.haxx.se&#x2F;libcurl&#x2F;c&#x2F;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>, 定义lua API对curl基本功能进行封装。</p>\n<p>luauser中列出来3中绑定libcurl的lua封装库</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">http:&#x2F;&#x2F;lua-users.org&#x2F;wiki&#x2F;LuaCurl<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>其中freepops-luacurl</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">http:&#x2F;&#x2F;www.freepops.org&#x2F;en&#x2F;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>实现了libcurl所有的easy 接口</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">http:&#x2F;&#x2F;curl.haxx.se&#x2F;libcurl&#x2F;c&#x2F;libcurl-easy.html<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>luaforge上提供一个 windows 上可运行luacurl的压缩包</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">http:&#x2F;&#x2F;files.luaforge.net&#x2F;releases&#x2F;luacurl&#x2F;freepops-luacurl&#x2F;0.3.0<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">freepops-lua-curl-binary-win32-openssl<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>本文示例就采用这个windows可运行包。</p>\n<p>解压后， cmd命令行cd到解压目录，使用 luaxx.exe yy.lua 接口运行示例脚本。</p>\n<p>示例<br />\n例子，实现https方式，登录网站，访问某个网页，修改其中参数的功能。其中xx应用时候需要修改。</p>\n<pre class=\"line-numbers language-lua\" data-language=\"lua\"><code class=\"language-lua\"><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"curl\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">local</span> ipList <span class=\"token operator\">=</span> \n<span class=\"token punctuation\">&#123;</span>\n    <span class=\"token string\">\"192.168.1.1\"</span><span class=\"token punctuation\">,</span>\n　　<span class=\"token string\">\"192.168.1.1\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token comment\">--登陆</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">loginWeb</span><span class=\"token punctuation\">(</span>ip<span class=\"token punctuation\">)</span> \n　　c <span class=\"token operator\">=</span> curl<span class=\"token punctuation\">.</span><span class=\"token function\">easy_init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> \n　　c<span class=\"token punctuation\">:</span><span class=\"token function\">setopt</span><span class=\"token punctuation\">(</span>curl<span class=\"token punctuation\">.</span>OPT_SSL_VERIFYHOST<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n　　c<span class=\"token punctuation\">:</span><span class=\"token function\">setopt</span><span class=\"token punctuation\">(</span>curl<span class=\"token punctuation\">.</span>OPT_SSL_VERIFYPEER<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n　　c<span class=\"token punctuation\">:</span><span class=\"token function\">setopt</span><span class=\"token punctuation\">(</span>curl<span class=\"token punctuation\">.</span>OPT_URL<span class=\"token punctuation\">,</span> <span class=\"token string\">\"https://\"</span><span class=\"token operator\">..</span>ip<span class=\"token operator\">..</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span> \n   c<span class=\"token punctuation\">:</span><span class=\"token function\">setopt</span><span class=\"token punctuation\">(</span>curl<span class=\"token punctuation\">.</span>OPT_POSTFIELDS<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Username=admin&amp;Password=admin&amp;Frm_Logintoken=&amp;action=login\"</span><span class=\"token punctuation\">)</span>\n\n　　c<span class=\"token punctuation\">:</span><span class=\"token function\">setopt</span><span class=\"token punctuation\">(</span>curl<span class=\"token punctuation\">.</span>OPT_WRITEFUNCTION<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span>\n　　　　<span class=\"token comment\">--print(buffer)</span>\n 　 　　<span class=\"token comment\">--print(\"\\r\\n---------------------------\\r\\n\");</span>\n　　　　<span class=\"token keyword\">return</span> <span class=\"token operator\">#</span>buffer\n　　<span class=\"token keyword\">end</span><span class=\"token punctuation\">)</span>\n\n   c<span class=\"token punctuation\">:</span><span class=\"token function\">perform</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token comment\">--访问页面</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">accessPage</span><span class=\"token punctuation\">(</span>ip<span class=\"token punctuation\">)</span> \n　　c <span class=\"token operator\">=</span> curl<span class=\"token punctuation\">.</span><span class=\"token function\">easy_init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> \n　　c<span class=\"token punctuation\">:</span><span class=\"token function\">setopt</span><span class=\"token punctuation\">(</span>curl<span class=\"token punctuation\">.</span>OPT_SSL_VERIFYHOST<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n　　c<span class=\"token punctuation\">:</span><span class=\"token function\">setopt</span><span class=\"token punctuation\">(</span>curl<span class=\"token punctuation\">.</span>OPT_SSL_VERIFYPEER<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n　　c<span class=\"token punctuation\">:</span><span class=\"token function\">setopt</span><span class=\"token punctuation\">(</span>curl<span class=\"token punctuation\">.</span>OPT_URL<span class=\"token punctuation\">,</span> <span class=\"token string\">\"https://\"</span><span class=\"token operator\">..</span>ip<span class=\"token operator\">..</span><span class=\"token string\">\"/xxpage.html\"</span><span class=\"token punctuation\">)</span>\n\n　　c<span class=\"token punctuation\">:</span><span class=\"token function\">setopt</span><span class=\"token punctuation\">(</span>curl<span class=\"token punctuation\">.</span>OPT_WRITEFUNCTION<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span>\n　　　　<span class=\"token comment\">--print(buffer)</span>\n 　 　　<span class=\"token comment\">--print(\"\\r\\n---------------------------\\r\\n\");</span>\n　　　　<span class=\"token keyword\">return</span> <span class=\"token operator\">#</span>buffer\n　　<span class=\"token keyword\">end</span><span class=\"token punctuation\">)</span>\n\n   c<span class=\"token punctuation\">:</span><span class=\"token function\">perform</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token comment\">--设置参数</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">setParameter</span><span class=\"token punctuation\">(</span>ip<span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">)</span> \n　　c <span class=\"token operator\">=</span> curl<span class=\"token punctuation\">.</span><span class=\"token function\">easy_init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> \n　　c<span class=\"token punctuation\">:</span><span class=\"token function\">setopt</span><span class=\"token punctuation\">(</span>curl<span class=\"token punctuation\">.</span>OPT_SSL_VERIFYHOST<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n　　c<span class=\"token punctuation\">:</span><span class=\"token function\">setopt</span><span class=\"token punctuation\">(</span>curl<span class=\"token punctuation\">.</span>OPT_SSL_VERIFYPEER<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n　　c<span class=\"token punctuation\">:</span><span class=\"token function\">setopt</span><span class=\"token punctuation\">(</span>curl<span class=\"token punctuation\">.</span>OPT_URL<span class=\"token punctuation\">,</span> <span class=\"token string\">\"https://\"</span><span class=\"token operator\">..</span>ip<span class=\"token operator\">..</span><span class=\"token string\">\"/xx.php\"</span><span class=\"token punctuation\">)</span> \n　　c<span class=\"token punctuation\">:</span><span class=\"token function\">setopt</span><span class=\"token punctuation\">(</span>curl<span class=\"token punctuation\">.</span>OPT_POSTFIELDS<span class=\"token punctuation\">,</span> <span class=\"token string\">\"DaylightSavingsUsed=1&amp;Dscp=-1\"</span><span class=\"token punctuation\">)</span>\n\n　　<span class=\"token keyword\">local</span> htmlTable <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span>\n　　c<span class=\"token punctuation\">:</span><span class=\"token function\">setopt</span><span class=\"token punctuation\">(</span>curl<span class=\"token punctuation\">.</span>OPT_WRITEFUNCTION<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span>\n　　　　<span class=\"token comment\">--print(buffer)</span>\n 　 　　<span class=\"token comment\">--print(\"\\r\\n---------------------------\\r\\n\");</span>\n　　　　table<span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>htmlTable<span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">)</span>\n　　　　<span class=\"token keyword\">return</span> <span class=\"token operator\">#</span>buffer\n　　<span class=\"token keyword\">end</span><span class=\"token punctuation\">)</span>\n\n   c<span class=\"token punctuation\">:</span><span class=\"token function\">perform</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n　　<span class=\"token keyword\">local</span> htmlStr <span class=\"token operator\">=</span> table<span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span>htmlTable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n　　<span class=\"token keyword\">local</span> resultBuff <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n　　<span class=\"token keyword\">if</span> string<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>htmlStr<span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;result>SUCC&lt;/result>\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">~=</span> <span class=\"token keyword\">nil</span> <span class=\"token keyword\">then</span>\n　　　　resultBuff <span class=\"token operator\">=</span> ip<span class=\"token operator\">..</span><span class=\"token string\">\" config OK\\r\\n\"</span><span class=\"token punctuation\">;</span>\n　　　　<span class=\"token function\">print</span><span class=\"token punctuation\">(</span>resultBuff<span class=\"token punctuation\">)</span>\n　　　　file<span class=\"token punctuation\">:</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>resultBuff<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n　　<span class=\"token keyword\">else</span>\n　　　　resultBuff <span class=\"token operator\">=</span> ip<span class=\"token operator\">..</span><span class=\"token string\">\" config NOK\\r\\n\"</span><span class=\"token punctuation\">;</span>\n　　　　<span class=\"token function\">print</span><span class=\"token punctuation\">(</span>resultBuff<span class=\"token punctuation\">)</span>\n　　　file<span class=\"token punctuation\">:</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>resultBuff<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n　<span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n\n\n<span class=\"token keyword\">local</span> file <span class=\"token operator\">=</span> io<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\\\\result.txt\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"w+\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">for</span> key<span class=\"token punctuation\">,</span>ip <span class=\"token keyword\">in</span> <span class=\"token function\">ipairs</span><span class=\"token punctuation\">(</span>ipList<span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span> \n　　<span class=\"token function\">loginWeb</span><span class=\"token punctuation\">(</span>ip<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n　　<span class=\"token function\">accessPage</span><span class=\"token punctuation\">(</span>ip<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n　　<span class=\"token function\">openLightSave</span><span class=\"token punctuation\">(</span>ip<span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n<span class=\"token keyword\">end</span>\nfile<span class=\"token punctuation\">:</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Done\"</span><span class=\"token punctuation\">)</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>作者：LightSong<br />\n出处：<a href=\"http://www.cnblogs.com/lightsong/\">http://www.cnblogs.com/lightsong/</a><br />\n本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利</p>\n","text":"CURL是 URL命令行工具， 即 command URL， 可以通过命令行模拟各种应用协议的发包， 包括FTP HTTP HTTPS， 官方网站 http:&#x2F;&#x2F;curl.haxx.se&#x2F; luacurl lua curl是基于curl的库libcu...","link":"","photos":[],"count_time":{"symbolsCount":"2.9k","symbolsTime":"3 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[],"toc":"","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Openresty工程如何处理mime定义问题","uid":"bc3b37831d103f6bddad2d9961281834","slug":"old_topic/2016-09-17-191","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.179Z","comments":true,"path":"api/articles/old_topic/2016-09-17-191.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"Lapis处理mime问题，一共使用了两个文件。 mime.types types &#123; text&#x2F;html html htm shtml; text&#x2F;css css; text&#x2F;xml xml; image&#x2F;gif gif; im...","link":"","photos":[],"count_time":{"symbolsCount":"3.4k","symbolsTime":"3 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"《MacTalk 跨越边界》","uid":"d9f46b0969f93bdf774649548bb0ec97","slug":"old_topic/2016-09-17-193","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.225Z","comments":true,"path":"api/articles/old_topic/2016-09-17-193.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"对于池老师的关注是从他到锤子科技之后开始的。关于IT类的散文随笔也看过一些，比如《黑客与画家》，这次看池老师的文章也有类似的读阅体会。 池老师的文章，将IT技术与对其思考的理念杂揉到一起，形散而又主题突出。看到这本书，让人想起了编剧史航对王朔的评价，大概的意思是， 他是一个走在我...","link":"","photos":[],"count_time":{"symbolsCount":531,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}