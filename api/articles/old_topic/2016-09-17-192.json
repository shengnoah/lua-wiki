{"title":"LUACURL使用笔记","uid":"2f345e8c1c99108bbbdc1391c900b270","slug":"old_topic/2016-09-17-192","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T06:15:59.739Z","comments":true,"path":"api/articles/old_topic/2016-09-17-192.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":null,"content":"<p>CURL是 URL命令行工具， 即 command URL， 可以通过命令行模拟各种应用协议的发包， 包括FTP HTTP HTTPS，</p>\n<p>官方网站 </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://curl.haxx.se/</span><br></pre></td></tr></table></figure>\n\n\n<p>luacurl<br>lua curl是基于curl的库libcurl</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://curl.haxx.se/libcurl/</span><br></pre></td></tr></table></figure>\n\n<p>针对libcurl开放的API</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://curl.haxx.se/libcurl/c/</span><br></pre></td></tr></table></figure>\n<p>, 定义lua API对curl基本功能进行封装。</p>\n<p>luauser中列出来3中绑定libcurl的lua封装库</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://lua-users.org/wiki/LuaCurl</span><br></pre></td></tr></table></figure>\n\n<p>其中freepops-luacurl</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://www.freepops.org/en/</span><br></pre></td></tr></table></figure>\n\n<p>实现了libcurl所有的easy 接口 </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://curl.haxx.se/libcurl/c/libcurl-easy.html</span><br></pre></td></tr></table></figure>\n\n\n<p> luaforge上提供一个 windows 上可运行luacurl的压缩包</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://files.luaforge.net/releases/luacurl/freepops-luacurl/0.3.0</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">freepops-lua-curl-binary-win32-openssl</span><br></pre></td></tr></table></figure>\n\n<p>本文示例就采用这个windows可运行包。</p>\n<p>解压后， cmd命令行cd到解压目录，使用 luaxx.exe yy.lua 接口运行示例脚本。</p>\n<p> 示例<br> 例子，实现https方式，登录网站，访问某个网页，修改其中参数的功能。其中xx应用时候需要修改。</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">&quot;curl&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">local</span> ipList = </span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;192.168.1.1&quot;</span>,</span><br><span class=\"line\">　　<span class=\"string\">&quot;192.168.1.1&quot;</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">--登陆</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">loginWeb</span><span class=\"params\">(ip)</span></span> </span><br><span class=\"line\">　　c = curl.easy_init() </span><br><span class=\"line\">　　c:setopt(curl.OPT_SSL_VERIFYHOST, <span class=\"number\">0</span>); </span><br><span class=\"line\">　　c:setopt(curl.OPT_SSL_VERIFYPEER, <span class=\"number\">0</span>); </span><br><span class=\"line\">　　c:setopt(curl.OPT_URL, <span class=\"string\">&quot;https://&quot;</span>..ip..<span class=\"string\">&quot;/&quot;</span>) </span><br><span class=\"line\">   c:setopt(curl.OPT_POSTFIELDS, <span class=\"string\">&quot;Username=admin&amp;Password=admin&amp;Frm_Logintoken=&amp;action=login&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">　　c:setopt(curl.OPT_WRITEFUNCTION, <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(buffer)</span></span></span><br><span class=\"line\">　　　　<span class=\"comment\">--print(buffer)</span></span><br><span class=\"line\"> 　 　　<span class=\"comment\">--print(&quot;\\r\\n---------------------------\\r\\n&quot;);</span></span><br><span class=\"line\">　　　　<span class=\"keyword\">return</span> #buffer</span><br><span class=\"line\">　　<span class=\"keyword\">end</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">   c:perform()</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">--访问页面</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">accessPage</span><span class=\"params\">(ip)</span></span> </span><br><span class=\"line\">　　c = curl.easy_init() </span><br><span class=\"line\">　　c:setopt(curl.OPT_SSL_VERIFYHOST, <span class=\"number\">0</span>); </span><br><span class=\"line\">　　c:setopt(curl.OPT_SSL_VERIFYPEER, <span class=\"number\">0</span>); </span><br><span class=\"line\">　　c:setopt(curl.OPT_URL, <span class=\"string\">&quot;https://&quot;</span>..ip..<span class=\"string\">&quot;/xxpage.html&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">　　c:setopt(curl.OPT_WRITEFUNCTION, <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(buffer)</span></span></span><br><span class=\"line\">　　　　<span class=\"comment\">--print(buffer)</span></span><br><span class=\"line\"> 　 　　<span class=\"comment\">--print(&quot;\\r\\n---------------------------\\r\\n&quot;);</span></span><br><span class=\"line\">　　　　<span class=\"keyword\">return</span> #buffer</span><br><span class=\"line\">　　<span class=\"keyword\">end</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">   c:perform()</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">--设置参数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setParameter</span><span class=\"params\">(ip, file)</span></span> </span><br><span class=\"line\">　　c = curl.easy_init() </span><br><span class=\"line\">　　c:setopt(curl.OPT_SSL_VERIFYHOST, <span class=\"number\">0</span>); </span><br><span class=\"line\">　　c:setopt(curl.OPT_SSL_VERIFYPEER, <span class=\"number\">0</span>); </span><br><span class=\"line\">　　c:setopt(curl.OPT_URL, <span class=\"string\">&quot;https://&quot;</span>..ip..<span class=\"string\">&quot;/xx.php&quot;</span>) </span><br><span class=\"line\">　　c:setopt(curl.OPT_POSTFIELDS, <span class=\"string\">&quot;DaylightSavingsUsed=1&amp;Dscp=-1&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">　　<span class=\"keyword\">local</span> htmlTable = &#123;&#125;</span><br><span class=\"line\">　　c:setopt(curl.OPT_WRITEFUNCTION, <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(buffer)</span></span></span><br><span class=\"line\">　　　　<span class=\"comment\">--print(buffer)</span></span><br><span class=\"line\"> 　 　　<span class=\"comment\">--print(&quot;\\r\\n---------------------------\\r\\n&quot;);</span></span><br><span class=\"line\">　　　　<span class=\"built_in\">table</span>.<span class=\"built_in\">insert</span>(htmlTable, buffer)</span><br><span class=\"line\">　　　　<span class=\"keyword\">return</span> #buffer</span><br><span class=\"line\">　　<span class=\"keyword\">end</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">   c:perform()</span><br><span class=\"line\"></span><br><span class=\"line\">　　<span class=\"keyword\">local</span> htmlStr = <span class=\"built_in\">table</span>.<span class=\"built_in\">concat</span>(htmlTable);</span><br><span class=\"line\">　　<span class=\"keyword\">local</span> resultBuff = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">　　<span class=\"keyword\">if</span> <span class=\"built_in\">string</span>.<span class=\"built_in\">match</span>(htmlStr, <span class=\"string\">&quot;&lt;result&gt;SUCC&lt;/result&gt;&quot;</span>) ~= <span class=\"literal\">nil</span> <span class=\"keyword\">then</span></span><br><span class=\"line\">　　　　resultBuff = ip..<span class=\"string\">&quot; config OK\\r\\n&quot;</span>;</span><br><span class=\"line\">　　　　<span class=\"built_in\">print</span>(resultBuff)</span><br><span class=\"line\">　　　　file:<span class=\"built_in\">write</span>(resultBuff);</span><br><span class=\"line\">　　<span class=\"keyword\">else</span></span><br><span class=\"line\">　　　　resultBuff = ip..<span class=\"string\">&quot; config NOK\\r\\n&quot;</span>;</span><br><span class=\"line\">　　　　<span class=\"built_in\">print</span>(resultBuff)</span><br><span class=\"line\">　　　file:<span class=\"built_in\">write</span>(resultBuff);</span><br><span class=\"line\"></span><br><span class=\"line\">　<span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">local</span> file = <span class=\"built_in\">io</span>.<span class=\"built_in\">open</span>(<span class=\"string\">&quot;.\\\\result.txt&quot;</span>, <span class=\"string\">&quot;w+&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">for</span> key,ip <span class=\"keyword\">in</span> <span class=\"built_in\">ipairs</span>(ipList) <span class=\"keyword\">do</span> </span><br><span class=\"line\">　　loginWeb(ip); </span><br><span class=\"line\">　　accessPage(ip); </span><br><span class=\"line\">　　openLightSave(ip, file); </span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\">file:<span class=\"built_in\">close</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&quot;Done&quot;</span>)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>作者：LightSong<br>出处：<a href=\"http://www.cnblogs.com/lightsong/\">http://www.cnblogs.com/lightsong/</a><br>本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利</p>\n","text":"CURL是 URL命令行工具， 即 command URL， 可以通过命令行模拟各种应用协议的发包， 包括FTP HTTP HTTPS， 官方网站 1http://curl.haxx.se/ luacurllua curl是基于curl的库libcurl 1http://curl...","link":"","photos":[],"count_time":{"symbolsCount":"3k","symbolsTime":"3 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"toc":"","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Openresty工程如何处理mime定义问题","uid":"bc3b37831d103f6bddad2d9961281834","slug":"old_topic/2016-09-17-191","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T06:15:59.739Z","comments":true,"path":"api/articles/old_topic/2016-09-17-191.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":null,"text":"Lapis处理mime问题，一共使用了两个文件。 mime.types 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565...","link":"","photos":[],"count_time":{"symbolsCount":"3.2k","symbolsTime":"3 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Vanilla工程如何设置静态文件夹static","uid":"56f67290590d9d72dc1ccb87fe155f52","slug":"old_topic/2016-09-17-190","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T06:15:59.739Z","comments":true,"path":"api/articles/old_topic/2016-09-17-190.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":null,"text":"修改/config/nginx.conf 加入路由设置[code] location /static/ { alias static/; }[/code] 完整的配置文件，如下：[code]pid tmp/-nginx.pid; This number should be at ...","link":"","photos":[],"count_time":{"symbolsCount":"1.2k","symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}