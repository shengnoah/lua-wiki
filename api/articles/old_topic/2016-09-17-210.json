{"title":"setmetatable和__call","uid":"cec276ee8af804b9a2147b603fad4daa","slug":"old_topic/2016-09-17-210","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.177Z","comments":true,"path":"api/articles/old_topic/2016-09-17-210.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","content":"<p>作者：糖果</p>\n<p>网上找来一个很能说明__call用法的例子：</p>\n<pre class=\"line-numbers language-lua\" data-language=\"lua\"><code class=\"language-lua\"><span class=\"token keyword\">function</span> <span class=\"token function\">f</span><span class=\"token punctuation\">(</span>tb<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> k<span class=\"token punctuation\">,</span>v <span class=\"token keyword\">in</span> <span class=\"token function\">pairs</span><span class=\"token punctuation\">(</span>tb<span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span>\n        <span class=\"token function\">print</span><span class=\"token punctuation\">(</span>k<span class=\"token punctuation\">,</span>v<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">end</span>\n    <span class=\"token keyword\">return</span> x<span class=\"token operator\">+</span>y<span class=\"token operator\">+</span>tb<span class=\"token punctuation\">.</span>n\n<span class=\"token keyword\">end</span>\n\nb <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span>\nb<span class=\"token punctuation\">.</span>__call <span class=\"token operator\">=</span> f\n\n\na <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span>\n<span class=\"token keyword\">function</span> a<span class=\"token punctuation\">:</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span>\na<span class=\"token punctuation\">.</span>n <span class=\"token operator\">=</span> <span class=\"token number\">100</span>\na<span class=\"token punctuation\">.</span>m <span class=\"token operator\">=</span> <span class=\"token number\">200</span>\n<span class=\"token function\">setmetatable</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span>b<span class=\"token punctuation\">)</span>\n<span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token function\">a</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>b作为a的元表的时候，table b={}的表函数,使用__call提定的话，<br />\n在执行a(惨数列表)， 参数列表和b的f函数的参数列表一致， 被指定函数的第一个参数，是一个table，里面存放的是a的成员变量和函数。</p>\n<p>如果这种效果要有C来实现的话，要指向来指向去的指针实现。</p>\n","text":"作者：糖果 网上找来一个很能说明__call用法的例子： function f(tb, x, y) for k,v in pairs(tb) do print(k,v) end return x+y+tb.n end b = &#123;&#125; b.__call = f a...","link":"","photos":[],"count_time":{"symbolsCount":392,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[],"toc":"","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"smbclient，ubuntu访问windows共享文件夹","uid":"f901c944f1965d8d412a5f9878199225","slug":"old_topic/2016-09-17-205","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.166Z","comments":true,"path":"api/articles/old_topic/2016-09-17-205.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"因为有些需求要让Linux通过samba协议访问windows的共享目录，所以做了一下连接的实验。 一.Samba安装 [code] sudo apt-get install samba sudo apt-get install samba-client sudo apt-get...","link":"","photos":[],"count_time":{"symbolsCount":618,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Openresty的非典型安装","uid":"bb30e03d07b81113ffb361e7f94598db","slug":"old_topic/2016-09-17-212","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.223Z","comments":true,"path":"api/articles/old_topic/2016-09-17-212.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"作者：糖果 Openresty也安装了很多遍整理一下安装过程。 上来先更新一下系统 sudo yum update 安装Openresty安装需要的依赖： sudo yum install -y gcc gcc-c++ readline-devel pcre-devel open...","link":"","photos":[],"count_time":{"symbolsCount":556,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}