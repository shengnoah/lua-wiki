{"title":"Moonscript与HTML模板","uid":"ea8283997977848c6827a1a83f28911d","slug":"old_topic/2016-09-17-366","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.222Z","comments":true,"path":"api/articles/old_topic/2016-09-17-366.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","content":"<p>作者：糖果</p>\n<p>Moonscript与HTML模板</p>\n<p>Lapis框架可以用Moonscript直接编程，Moonscript可以将需要模板系统对于的网页输出，一揽子的都在Moonscript中用代码实现，<a href=\"http://xn--leaof-ok2h341apk7e.net/lapis%E4%B8%8B%E6%9C%80%E5%85%B8%E5%9E%8B%E7%9A%84%E5%AE%98%E6%96%B9%E4%BE%8B%E5%AD%90%EF%BC%8C%E5%85%B6%E5%AE%9EDB%E7%9A%84%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%9C%A8moonscript%E4%B8%AD%E9%83%BD%E5%AE%8C%E6%88%90%E4%BA%86%EF%BC%8C%E5%AF%B9%E4%BA%8E%E6%9F%90%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%93%8D%E4%BD%9C%E6%9D%A5%E7%9C%8B%EF%BC%8C%E8%BF%99%E6%98%AF%E5%BE%88%E9%85%B7%E7%9A%84%E3%80%82\">可以看leaof.net/lapis下最典型的官方例子，其实DB的相关操作也可以在moonscript中都完成了，对于某种类型的操作来看，这是很酷的。</a></p>\n<p>我们先来看一下模板的例子：</p>\n<pre class=\"line-numbers language-lua\" data-language=\"lua\"><code class=\"language-lua\">import Widget from require <span class=\"token string\">\"lapis.html\"</span>\n\nclass Index extends Widget\n  content<span class=\"token punctuation\">:</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span>\n    h1 class<span class=\"token punctuation\">:</span> <span class=\"token string\">\"header\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Hello\"</span>\n\n    @user_panel!\n    div class<span class=\"token punctuation\">:</span> <span class=\"token string\">\"body\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n      text <span class=\"token string\">\"Welcome to my site!\"</span>\n\n  user_panel<span class=\"token punctuation\">:</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span>\n    <span class=\"token keyword\">return</span> unless @current_user\n    div class<span class=\"token punctuation\">:</span> <span class=\"token string\">\"user_panel\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Welcome back \"</span> <span class=\"token operator\">..</span> @current_user<span class=\"token punctuation\">.</span>name<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>这段mooncript代码会被翻译成下面的HTML</p>\n<pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>header<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>&lt;%= \"Hello\" %><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\n&lt;% if current_user then %>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>user_panel<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    Welcome back &lt;%= current_user.name %>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n&lt;% end %>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>body<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  Welcome to my site\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>在实际leafo之前的应用代码中，利用的最明显的是下面这段：</p>\n<pre class=\"line-numbers language-lua\" data-language=\"lua\"><code class=\"language-lua\">import Widget from require <span class=\"token string\">\"lapis.html\"</span>\n\nclass PostLayout extends Widget\n  content<span class=\"token punctuation\">:</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span>\n    @page<span class=\"token punctuation\">.</span>template_stack\\push <span class=\"token string\">\"web\"</span>\n\n    div class<span class=\"token punctuation\">:</span> <span class=\"token string\">\"post\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n      div class<span class=\"token punctuation\">:</span> <span class=\"token string\">\"sidebar\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n        text @root\n\n      div class<span class=\"token punctuation\">:</span> <span class=\"token string\">\"main_column\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n        raw @body\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>下面这句话出现了问题：</p>\n<pre class=\"line-numbers language-lua\" data-language=\"lua\"><code class=\"language-lua\">div class<span class=\"token punctuation\">:</span> <span class=\"token string\">\"sidebar\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n  text @root<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>@root在某些情况下晃是一个”…“, 这个会造成左边栏的导航栏消失了。</p>\n<p>这里核心的库就是这个lapis.html</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">import Widget from require &quot;lapis.html&quot;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>代码太长，就贴个连接过来<br />\n<a href=\"https://github.com/leafo/lapis/blob/master/lapis/html.moon\">lapis.html.moon</a><br />\n,Moonscript如果用来做个人项目还是挺酷的。如何用Moonscript生成Html看下面的连接：<a href=\"http://leafo.net/lapis/reference/html_generation.html\">HTML Generation</a>,<br />\nMoonscript生成大量的前端可以维护起来可能有些难度，但做为生成模板描述，还是方便快速有优势。</p>\n<p>上面的模板定义代中，使用了一个助手函数raw：</p>\n<pre class=\"line-numbers language-lua\" data-language=\"lua\"><code class=\"language-lua\">raw @body<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>还使用了另外的一个助手函数：</p>\n<pre class=\"line-numbers language-lua\" data-language=\"lua\"><code class=\"language-lua\">text @root<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"rawstr\"><a class=\"markdownIt-Anchor\" href=\"#rawstr\"></a> raw(str)</h4>\n<blockquote>\n<p>引用文本： — outputs the argument, a string, directly to the buffer without escaping.</p>\n</blockquote>\n<p>raw是直接将字符串写入到buffer，并且不经过转意。</p>\n<h4 id=\"textargs\"><a class=\"markdownIt-Anchor\" href=\"#textargs\"></a> text(args)</h4>\n<blockquote>\n<p>引用文本： — outputs the argument to the buffer, escaping it if it’s a string. If it’s a function, it executes the function in HTML builder environment. If it’s a table, it writes each item in the table</p>\n</blockquote>\n<p>这个函数区别于raws，如果是字符串就转义。是函数就执行。如果是表，把每个元素都写入表。</p>\n<p>上面提到的@root是sitegen的内建变量。</p>\n<blockquote>\n<p>引用文本： $root — a relative path prefix that points back to the top level directory of your site. For example, if the current page is wwww/hello/world.html, the $root would be …/. This make it easy to built URLs to other pages without being concerned about where your page is being rendered to.</p>\n</blockquote>\n<p>一般的情况下,@root值就取&quot;.“、”…&quot; 比较常见。不过，此处这种输出会导致左导航栏消失。sitgen, jekyll,还有这个saepy-log，这三个系统，前二者是静态转换Markdown,saepy-log是从Mysql里，读取Markdown（最开始不是，改成了直接支持Markdown。）三个工具分别用三种语言实现。moonscript(lua), ruby, python(tornado)，设计风格也不一样。对SEO支持比较好的是SAEPY_LOG，最酷的还是sitegen。</p>\n","text":"作者：糖果 Moonscript与HTML模板 Lapis框架可以用Moonscript直接编程，Moonscript可以将需要模板系统对于的网页输出，一揽子的都在Moonscript中用代码实现，可以看leaof.net/lapis下最典型的官方例子，其实DB的相关操作也可以在...","link":"","photos":[],"count_time":{"symbolsCount":"2.4k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#rawstr\"><span class=\"toc-text\"> raw(str)</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#textargs\"><span class=\"toc-text\"> text(args)</span></a></li></ol>","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"MoonScript与JSON","uid":"65fa3173cc522e3fb069063afc992231","slug":"old_topic/2016-09-17-365","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.147Z","comments":true,"path":"api/articles/old_topic/2016-09-17-365.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"作者：糖果 lapis &#x3D; require &quot;lapis&quot; import json_params from require &quot;lapis.application&quot; class App extends lapis.Applicati...","link":"","photos":[],"count_time":{"symbolsCount":"2.3k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"MoonScript's Object","uid":"f17567ac35ebb144b8a5d3dffefc17d8","slug":"old_topic/2016-09-17-367","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.215Z","comments":true,"path":"api/articles/old_topic/2016-09-17-367.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"作者：糖果 Coffescript是一种中间的脚本，可以把这种脚本翻译成JavaScript。而MoonScript，是可以翻译成lua语言的中间脚本。 本文简单的介绍的： 如何在VIM中，实现MoonScript语法高亮。 如何简单的编译MoonScript脚本。 MoonSc...","link":"","photos":[],"count_time":{"symbolsCount":"2.9k","symbolsTime":"3 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}