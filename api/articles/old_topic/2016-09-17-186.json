{"title":"老衲，这代码不能要！","uid":"e5306b1f99d6e83b5a21496ff6f51752","slug":"old_topic/2016-09-17-186","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.207Z","comments":true,"path":"api/articles/old_topic/2016-09-17-186.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","content":"<p>Christ people. This is just sh*t.</p>\n<p>The conflict I get is due to stupid new gcc header file crap. But what<br />\nmakes me upset is that the crap is for completely bogus reasons.</p>\n<p>This is the old code in net/ipv6/ip6_output.c:</p>\n<p>mtu -= hlen + sizeof(struct frag_hdr);</p>\n<p>and this is the new “improved” code that uses fancy stuff that wants<br />\nmagical built-in compiler support and has silly wrapper functions for<br />\nwhen it doesn’t exist:<br />\n[code]<br />\nif (overflow_usub(mtu, hlen + sizeof(struct frag_hdr), &amp;mtu) ||<br />\nmtu &lt;= 7)<br />\ngoto fail_toobig;<br />\n[/code]<br />\nand anybody who thinks that the above is</p>\n<p>(a) legible<br />\n(b) efficient (even with the magical compiler support)<br />\n© particularly safe</p>\n<p>is just incompetent and out to lunch.</p>\n<p>The above code is sh*t, and it generates shit code. It looks bad, and<br />\nthere’s no reason for it.</p>\n<p>The code could <em>easily</em> have been done with just a single and<br />\nunderstandable conditional, and the compiler would actually have<br />\ngenerated better code, and the code would look better and more<br />\nunderstandable. Why is this not</p>\n<p>[code]<br />\nif (mtu &lt; hlen + sizeof(struct frag_hdr) + 8)<br />\ngoto fail_toobig;<br />\nmtu -= hlen + sizeof(struct frag_hdr);<br />\n[/code]<br />\nwhich is the same number of lines, doesn’t use crazy helper functions<br />\nthat nobody knows what they do, and is much more obvious what it<br />\nactually does.</p>\n<p>I guarantee that the second more obvious version is easier to read and<br />\nunderstand. Does anybody really want to dispute this?</p>\n<p>Really. Give me <em>one</em> reason why it was written in that idiotic way<br />\nwith two different conditionals, and a shiny new nonstandard function<br />\nthat wants particular compiler support to generate even half-way sane<br />\ncode, and even then generates worse code? A shiny function that we<br />\nhave never ever needed anywhere else, and that is just<br />\ncompiler-masturbation.</p>\n<p>And yes, you still could have overflow issues if the whole “hlen +<br />\nxyz” expression overflows, but quite frankly, the “overflow_usub()”<br />\ncode had that too. So if you worry about that, then you damn well<br />\ndidn’t do the right thing to begin with.</p>\n<p>So I really see no reason for this kind of complete idiotic crap.</p>\n<p>Tell me why. Because I’m not pulling this kind of completely insane<br />\nstuff that generates conflicts at rc7 time, and that seems to have<br />\nabsolutely no reason for being anm idiotic unreadable mess.</p>\n<p>The code seems <em>designed</em> to use that new “overflow_usub()” code. It<br />\nseems to be an excuse to use that function.</p>\n<p>And it’s a f*cking bad excuse for that braindamage.</p>\n<p>I’m sorry, but we don’t add idiotic new interfaces like this for<br />\nidiotic new code like that.</p>\n<p>Yes, yes, if this had stayed inside the network layer I would never<br />\nhave noticed. But since I <em>did</em> notice, I really don’t want to pull<br />\nthis. In fact, I want to make it clear to <em>everybody</em> that code like<br />\nthis is completely unacceptable. Anybody who thinks that code like<br />\nthis is “safe” and “secure” because it uses fancy overflow detection<br />\nfunctions is so far out to lunch that it’s not even funny. All this<br />\nkind of crap does is to make the code a unreadable mess with code that<br />\nno sane person will ever really understand what it actually does.</p>\n<p>Get rid of it. And I don’t <em>ever</em> want to see that shit again.</p>\n<p>Linus</p>\n<p><a href=\"http://lkml.iu.edu/hypermail/linux/kernel/1510.3/02866.html\">http://lkml.iu.edu/hypermail/linux/kernel/1510.3/02866.html</a></p>\n","text":"Christ people. This is just sh*t. The conflict I get is due to stupid new gcc header file crap. But what makes me upset is that the crap is ...","link":"","photos":[],"count_time":{"symbolsCount":"3.2k","symbolsTime":"3 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[],"toc":"","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Moonscript的WEB工程配置文件","uid":"92825ad55c31699146a13eff573616d1","slug":"old_topic/2016-09-17-185","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.167Z","comments":true,"path":"api/articles/old_topic/2016-09-17-185.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"作者：糖果 http://www.lua.ren Lapis框架默认是没有配置文件，lapis new 创建出来的工程没有对监听的端口和数据库的相关设置，需要在工程目录下创建一个config.moon或是moon.lua配置文件，进行相关的设定。 首先，看一下如何通过Moonsc...","link":"","photos":[],"count_time":{"symbolsCount":"1.1k","symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Moonscript的循环结构","uid":"b8a0477ffed33bd6d0efdb938e9ec4db","slug":"old_topic/2016-09-17-187","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-14T07:45:09.229Z","comments":true,"path":"api/articles/old_topic/2016-09-17-187.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"除了使用迭代器，某些应用场合，我们还需要使用固定次数的循环结构，Moonscript提供While风格 的固定循环控制。 Moonscript class extends lapis.Application [loop: \"/loop\"]:=> @html -> i = 10 w...","link":"","photos":[],"count_time":{"symbolsCount":607,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}