{"title":"Lua数据结构 — Udata（五）","uid":"ec37326988767d8ca215a346ac676ded","slug":"zl/2016-01-01-135_Lua数据结构 — Udata（五）","date":"2024-04-03T03:47:33.035Z","updated":"2024-04-03T03:47:33.036Z","comments":true,"path":"api/articles/zl/2016-01-01-135_Lua数据结构 — Udata（五）.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","content":"<div id=\"toc\" class=\"toc-article\">\n            <strong class=\"toc-title\">文章目录</strong>\n<pre><code>      &lt;/div&gt;\n    \n    &lt;p&gt;&lt;strong&gt;Udata负责存储userdata的数据&lt;/strong&gt;，这部分其实很简单，但是为了保证系列文章的完整性，还是写一篇出来补全。&lt;/p&gt;\n</code></pre>\n<p>下面是Udata的数据结构：</p>\n<p><img src=\"https://keepmovingxin.github.io//images/luaUdata/lua-udata-01.png\" alt=\"\"/></p>\n<p>意义：</p>\n<ol>\n<li>CommonHeader：和与TValue中的GCHeader能对应起来的部分</li>\n<li>metatable：userdata的元表，和table的元表一样的</li>\n<li>env：创建userdata时，会把当前执行语句的curenv赋给userdata的env，可修改</li>\n<li>len：使用userdata的时候绑定对象申请的空间大小</li>\n</ol>\n<p>和TString类似，用户绑定的C对象或数据内存紧跟在Udata后面，在luaS_newudata中（lstring.c 96 – 110）有如下代码：</p>\n<p><img src=\"https://keepmovingxin.github.io//images/luaUdata/lua-udata-02.png\" alt=\"\"/></p>\n<p><img src=\"https://keepmovingxin.github.io//images/luaUdata/lua-udata-03.png\" alt=\"\"/></p>\n<h4 id=\"Udata元表-metable-的作用\"><a href=\"#Udata元表-metable-的作用\" class=\"headerlink\" title=\"Udata元表(metable)的作用\"></a>Udata元表(metable)的作用</h4><p>如果userdata没有元表，那是使用起来将会很麻烦，有元表，可以在脚本这样写：</p>\n<p><img src=\"https://keepmovingxin.github.io//images/luaUdata/lua-udata-04.png\" alt=\"\"/></p>\n<p>从C语言层面来看，myuserdata这个变量其实只是个指针，不像table那样有子元素。但是因为有metatable，由此可以把成员函数放到这个metatable中，在脚本中可以利用它来实现这个类似table的访问方法。</p>\n<h4 id=\"Udata环境-env-的作用\"><a href=\"#Udata环境-env-的作用\" class=\"headerlink\" title=\"Udata环境(env)的作用\"></a>Udata环境(env)的作用</h4><p>env这个成员，默认是存储创建userdata时的环境table，而参考Lua官方的文档后，其实这个env成员在Lua中并没有使用，它的值时什么并不影响Lua的运行。</p>\n<p>这就说明这个成员目前来说是一个用户可以自由操作的table，在<a href=\"http://lua-users.org/wiki/UserDataRefinement\" target=\"_blank\" rel=\"external noopener noreferrer\">UserDataRefinement</a>文章中，告诉了我们一些使用的手段。另外一篇文章<a href=\"http://lua-users.org/lists/lua-l/2005-08/msg00709.html\" target=\"_blank\" rel=\"external noopener noreferrer\">http://lua-users.org/lists/lua-l/2005-08/msg00709.html</a>也对它的使用方法提出了一些建议。</p>\n<p>我比较赞成后一篇文章的看法，对于Udata来说，metatable是一种静态的类型数据(type-common data)，而env则是实例相关的数据(instance-local data)。当然了，怎么用取决于使用者。</p>\n<p><strong>Lua数据结构</strong>系列转自阿里云博客，作者是<strong>罗日健</strong>。<br/>原文链接：<a href=\"http://blog.aliyun.com/789\" target=\"_blank\" rel=\"external noopener noreferrer\">http://blog.aliyun.com/789</a></p>\n<hr/>\n<p>扫描二维码或在微信中搜索 KeepMovingXin<br/><img src=\"https://keepmovingxin.github.io//images/qrcode.jpg\" alt=\"欢迎关注微信公众号！\"/></p>","text":" 文章目录 &lt;/div&gt; &lt;p&gt;&lt;strong&gt;Udata负责存储userdata的数据&lt;/strong&gt;，这部分其实很简单，但是为了保证系列文章的完整性，还是写一篇出来补全。&lt;/p&gt; 下面是Udata的数据结构： 意义...","link":"","photos":[],"count_time":{"symbolsCount":"1k","symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Udata%E5%85%83%E8%A1%A8-metable-%E7%9A%84%E4%BD%9C%E7%94%A8\"><span class=\"toc-text\">Udata元表(metable)的作用</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Udata%E7%8E%AF%E5%A2%83-env-%E7%9A%84%E4%BD%9C%E7%94%A8\"><span class=\"toc-text\">Udata环境(env)的作用</span></a></li></ol>","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Lua table、模块与面向对象","uid":"2c7b59d286ea0f514f3312281292ce52","slug":"zl/2016-01-01-136_Lua table、模块与面向对象","date":"2024-04-03T03:47:33.036Z","updated":"2024-04-03T03:47:33.037Z","comments":true,"path":"api/articles/zl/2016-01-01-136_Lua table、模块与面向对象.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"很久之前接触过lua，最近在工作中又用到了一些，对lua这门语言又有了新的认识和理解。Lua是一门很简洁高效的语言,在openresty项目中大量使用，游戏开发中也使用lua来写一些脚本。在这里记录一下自己对lua中面向对象的理解。 table在lua中是一种kv的数据结构，也指...","link":"","photos":[],"count_time":{"symbolsCount":"2.3k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Lua元表","uid":"0498ed7eca93166bac9cec9951eb31df","slug":"zl/2016-01-01-133_Lua元表","date":"2024-04-03T03:47:33.034Z","updated":"2024-04-03T03:47:33.034Z","comments":true,"path":"api/articles/zl/2016-01-01-133_Lua元表.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"javascript语言本身不支持面向对象，ES2015中增加了class关键字，却不过是prototype语法糖而已，本质上prototype形式的面向对象只能算是一种“模拟”，这其中很重要的原因之一是js从来没有一套完美的深拷贝方案，子类只能借助原型链获取父类方法的引用，这不...","link":"","photos":[],"count_time":{"symbolsCount":"3.5k","symbolsTime":"3 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}