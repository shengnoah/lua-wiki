{"title":"luasql-oracle","uid":"b5f73cdecec20724cdb9cfa27118411f","slug":"zl/2016-01-01-1128_luasql-oracle","date":"2024-04-03T03:47:33.010Z","updated":"2024-04-03T03:47:33.010Z","comments":true,"path":"api/articles/zl/2016-01-01-1128_luasql-oracle.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","content":"<h3 id=\"一安装-mac\"><a href=\"#一安装-mac\" class=\"headerlink\" title=\"一安装  mac\"></a>一安装  mac</h3><p>编译配置：</p>\n<pre><code class=\"bash\">git <span class=\"built_in\">clone</span> https://github.com/keplerproject/luasql\n<span class=\"built_in\">cd</span>  luasql\nvim config\n<p>LUA_LIBDIR ?= <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mi>P</mi><mi>R</mi><mi>E</mi><mi>F</mi><mi>I</mi><mi>X</mi><mo>)</mo><mi mathvariant=\"normal\">/</mi><mi>l</mi><mi>i</mi><mi>b</mi><mi mathvariant=\"normal\">/</mi><mi>l</mi><mi>u</mi><mi>a</mi><mi mathvariant=\"normal\">/</mi></mrow><annotation encoding=\"application/x-tex\">(PREFIX)/lib/lua/</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.75em;\"></span><span class=\"strut bottom\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mopen\">(</span><span class=\"mord mathit\" style=\"margin-right:0.13889em;\">P</span><span class=\"mord mathit\" style=\"margin-right:0.00773em;\">R</span><span class=\"mord mathit\" style=\"margin-right:0.05764em;\">E</span><span class=\"mord mathit\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathit\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathit\" style=\"margin-right:0.07847em;\">X</span><span class=\"mclose\">)</span><span class=\"mord mathrm\">/</span><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathit\">i</span><span class=\"mord mathit\">b</span><span class=\"mord mathrm\">/</span><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">a</span><span class=\"mord mathrm\">/</span></span></span></span>(LUA_SYS_VER)<br />\nLUA_DIR ?= <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mi>P</mi><mi>R</mi><mi>E</mi><mi>F</mi><mi>I</mi><mi>X</mi><mo>)</mo><mi mathvariant=\"normal\">/</mi><mi>s</mi><mi>h</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi mathvariant=\"normal\">/</mi><mi>l</mi><mi>u</mi><mi>a</mi><mi mathvariant=\"normal\">/</mi></mrow><annotation encoding=\"application/x-tex\">(PREFIX)/share/lua/</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.75em;\"></span><span class=\"strut bottom\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mopen\">(</span><span class=\"mord mathit\" style=\"margin-right:0.13889em;\">P</span><span class=\"mord mathit\" style=\"margin-right:0.00773em;\">R</span><span class=\"mord mathit\" style=\"margin-right:0.05764em;\">E</span><span class=\"mord mathit\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord mathit\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathit\" style=\"margin-right:0.07847em;\">X</span><span class=\"mclose\">)</span><span class=\"mord mathrm\">/</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">h</span><span class=\"mord mathit\">a</span><span class=\"mord mathit\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathit\">e</span><span class=\"mord mathrm\">/</span><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">a</span><span class=\"mord mathrm\">/</span></span></span></span>(LUA_SYS_VER)<br />\nLUA_INC ?= /usr/<span class=\"built_in\">local</span>/include/luajit-2.1</p>\n<p><span class=\"comment\"># - Oracle OCI8</span><br />\nDRIVER_LIBS_oci8 ?= -L/opt/oracle/instantclient_11_2 -lz -lclntsh<br />\nDRIVER_INCS_oci8 ?= -I/opt/oracle/instantclient_11_2/sdk/include<br />\n</code></pre></p>\n<p>安装 instantclient-sqlplus<br/>下载sql:<br/><a href=\"http://download.oracle.com/otn/mac/instantclient/11204/instantclient-sqlplus-macos.x64-11.2.0.4.0.zip?AuthParam=1483339513_c6c20f6dbd36fa8991b05173024a45a6\" target=\"_blank\" rel=\"external noopener noreferrer\">instantclient-sqlplus</a></p>\n<pre><code class=\"bash\"><span class=\"built_in\">cd</span> /opt/oracle/instantclient_11_2\nunzip instantclient-sqlplus-macos.x64-11.2.0.4.0.zip\nmv instantclient-sqlplus-macos/* .\nmkdir  /opt/oracle/instantclient_11_2/network/admin/ \n<span class=\"built_in\">cd</span> /opt/oracle/instantclient_11_2/network/admin/ \n<span class=\"comment\"># 增加  tnsnames.ora </span>\ncat  /opt/oracle/instantclient_11_2/network/admin/tnsnames.ora \nUATNEW_RNDEFAULT =\n  (DESCRIPTION =\n    (ADDRESS_LIST =\n      (ADDRESS = (PROTOCOL = TCP)(HOST = 10.57.115.157)(PORT = 1521))\n    )\n    (CONNECT_DATA =\n      (SERVER = DEDICATED)\n      (SERVICE_NAME = newuat)\n    )\n  )\n</code></pre>\n<p>luajit 测试：</p>\n<pre><code class=\"bash\">cat conndb.lua \n<span class=\"built_in\">local</span> driver = require <span class=\"string\">&#34;luasql.oci8&#34;</span>\n<span class=\"built_in\">print</span>(driver)\n<p><span class=\"built_in\">local</span> env = driver.oci8()<br />\n<span class=\"built_in\">print</span>(env)</p>\n<p><span class=\"built_in\">print</span> (os.time())<br />\n<span class=\"built_in\">local</span> dbcon = assert (env:connect(<span class=\"string\">&quot;UATNEW_RNDEFAULT&quot;</span>, <span class=\"string\">&quot;rntrade&quot;</span>, <span class=\"string\">&quot;QWER1234&quot;</span>))<br />\n<span class=\"built_in\">print</span>( dbcon )</p>\n<p>– <span class=\"built_in\">local</span> sql = <span class=\"string\">&quot;select count(1) as c from account_address&quot;</span><br />\n– <span class=\"built_in\">local</span> sql = <span class=\"string\">&quot;select * from send_messges_info WHERE ROWNUM &lt;= 10&quot;</span><br />\n<span class=\"built_in\">local</span> sql = <span class=\"string\">&quot;select count(*) from send_messges_info &quot;</span><br />\n<span class=\"built_in\">local</span> cursor = dbcon:execute(sql)<br />\n<span class=\"built_in\">print</span>(cursor)</p>\n<p><span class=\"built_in\">local</span> ret = cursor:fetch(&#123;&#125;,<span class=\"string\">&quot;a&quot;</span>)<br />\n<span class=\"keyword\">for</span> k , v <span class=\"keyword\">in</span> pairs(ret) <span class=\"keyword\">do</span><br />\n<span class=\"built_in\">print</span>(string.format(<span class=\"string\">&quot;%s %s&quot;</span>,k , v ))<br />\nngx.say(string.format(<span class=\"string\">&quot;短信总数%s %s&quot;</span>,k , v ))<br />\nend<br />\n</code></pre></p>\n<h3 id=\"安装-lua-cjson\"><a href=\"#安装-lua-cjson\" class=\"headerlink\" title=\"安装 lua-cjson\"></a>安装 lua-cjson</h3><pre><code class=\"bash\">git <span class=\"built_in\">clone</span> https://github.com/mpx/lua-cjson.git\n<span class=\"built_in\">cd</span> lua-cjson\n<span class=\"comment\"># 修改 lua 目录：</span>\nLUA_INC ?= /usr/<span class=\"built_in\">local</span>/include/luajit-2.1\n<span class=\"comment\">## MacOSX (Macports)</span>\n<span class=\"comment\">#PREFIX =            /opt/local</span>\n<span class=\"comment\">#  修改CJSON_LDFLAGS =     -shared</span>\nCJSON_LDFLAGS =     -bundle -undefined dynamic_lookup\nmake\n</code></pre>","text":"一安装 mac编译配置： git clone https://github.com/keplerproject/luasql cd luasql vim config LUA_LIBDIR ?= (PREFIX)/lib/lua/(PREFIX)/lib/lua/(PREFIX)...","link":"","photos":[],"count_time":{"symbolsCount":"2k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%B8%80%E5%AE%89%E8%A3%85-mac\"><span class=\"toc-text\">一安装  mac</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85-lua-cjson\"><span class=\"toc-text\">安装 lua-cjson</span></a></li></ol>","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"lua语言积累","uid":"6935b67c5571a61b9b14a6102e1e7e06","slug":"zl/2016-01-01-1134_lua语言积累","date":"2024-04-03T03:47:33.011Z","updated":"2024-04-03T03:47:33.012Z","comments":true,"path":"api/articles/zl/2016-01-01-1134_lua语言积累.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"学习参考网站： http://book.luaer.cn/http://lua-users.org/wiki/TutorialDirectory","link":"","photos":[],"count_time":{"symbolsCount":72,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Linux 下 lua 开发环境安装及安装 luafilesystem","uid":"8f4c30a76f8d788c178eb45d61a32358","slug":"zl/2016-01-01-112_Linux 下 lua 开发环境安装及安装 luafilesystem","date":"2024-04-03T03:47:33.010Z","updated":"2024-04-03T03:47:33.010Z","comments":true,"path":"api/articles/zl/2016-01-01-112_Linux 下 lua 开发环境安装及安装 luafilesystem.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"火云邪神语录：天下武功，无坚不破，唯快不破！Nginx 的看家本领就是速度，Lua 的拿手好戏亦是速度，这两者的结合在速度上无疑有基因上的优势。 最近一直再折腾这个，干脆就稍微整理下。以防后面继续跳坑！ 安装： 1.先安装 lua 的相关依赖安装 C 开发环境由于 gcc 包需要...","link":"","photos":[],"count_time":{"symbolsCount":"2.8k","symbolsTime":"3 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}