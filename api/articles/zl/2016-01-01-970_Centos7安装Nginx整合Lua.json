{"title":"Centos7安装Nginx整合Lua","uid":"b2ed6721ac7c046b1a394babb74083fa","slug":"zl/2016-01-01-970_Centos7安装Nginx整合Lua","date":"2024-04-03T03:47:36.232Z","updated":"2024-04-03T03:47:36.232Z","comments":true,"path":"api/articles/zl/2016-01-01-970_Centos7安装Nginx整合Lua.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","content":"<script async=\"\" src=\"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js\"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>Lua 是一种轻量小巧的脚本语言，用标准C语言编写并以源代码形式开放， 其设计目的是为了嵌入应用程序中，从而为应用程序提供灵活的扩展和定制功能。现在通常把lua迁入nginx中，根据lua脚本规则，强化nginx的能力。本文介绍在centos7中安装nginx整合lua。</p><h2 id=\"环境\"><a href=\"#环境\" class=\"headerlink\" title=\"环境\"></a>环境</h2><p><strong>centos7</strong></p><h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><h4 id=\"关闭防火墙\"><a href=\"#关闭防火墙\" class=\"headerlink\" title=\"关闭防火墙\"></a>关闭防火墙</h4><figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br/><span class=\"line\">2</span><br/></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl stop firewalld.service </span><br/><span class=\"line\">systemctl <span class=\"built_in\">disable</span> firewalld.service <span class=\"comment\">#禁止firewall开机启动</span></span><br/></pre></td></tr></tbody></table></figure><h4 id=\"安装依赖环境\"><a href=\"#安装依赖环境\" class=\"headerlink\" title=\"安装依赖环境\"></a>安装依赖环境</h4><figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br/></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install yum-utils gcc zlib zlib-devel pcre-devel openssl openssl-devel wget</span><br/></pre></td></tr></tbody></table></figure><h4 id=\"安装LuaJIT\"><a href=\"#安装LuaJIT\" class=\"headerlink\" title=\"安装LuaJIT\"></a>安装LuaJIT</h4><figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br/><span class=\"line\">2</span><br/><span class=\"line\">3</span><br/><span class=\"line\">4</span><br/></pre></td><td class=\"code\"><pre><span class=\"line\">wget http://luajit.org/download/LuaJIT-2.0.2.tar.gz</span><br/><span class=\"line\">tar -xvf LuaJIT-2.0.2.tar.gz</span><br/><span class=\"line\"><span class=\"built_in\">cd</span> LuaJIT-2.0.2</span><br/><span class=\"line\">make install</span><br/></pre></td></tr></tbody></table></figure><h4 id=\"安装nginx\"><a href=\"#安装nginx\" class=\"headerlink\" title=\"安装nginx\"></a>安装nginx</h4><p><strong>下载ngx_devel_kit、lua-nginx-module、nginx</strong></p><figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br/><span class=\"line\">2</span><br/><span class=\"line\">3</span><br/><span class=\"line\">4</span><br/><span class=\"line\">5</span><br/><span class=\"line\">6</span><br/><span class=\"line\">7</span><br/></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/simpl/ngx_devel_kit/archive/v0.3.0.tar.gz</span><br/><span class=\"line\">wget https://github.com/openresty/lua-nginx-module/archive/v0.10.9rc7.tar.gz</span><br/><span class=\"line\">wget http://nginx.org/download/nginx-1.12.1.tar.gz </span><br/><span class=\"line\"><span class=\"comment\">#注意下载后的压缩包没有文件名称，但是根据版本号能区分是哪个文件</span></span><br/><span class=\"line\">tar -xvf v0.3.0.tar.gz</span><br/><span class=\"line\">tar -xvf v0.10.9rc7.tar.gz</span><br/><span class=\"line\">tar -xvf nginx-1.12.1.tar.gz</span><br/></pre></td></tr></tbody></table></figure><h4 id=\"编译Nginx\"><a href=\"#编译Nginx\" class=\"headerlink\" title=\"编译Nginx\"></a>编译Nginx</h4><figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br/><span class=\"line\">2</span><br/></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> nginx-1.12.1</span><br/><span class=\"line\">./configure --prefix=/usr/<span class=\"built_in\">local</span>/nginx --add-module=../ngx_devel_kit-0.3.0 --add-module=../lua-nginx-module-0.10.9rc7  --with-http_ssl_module  --with-http_stub_status_module  --with-http_gzip_static_module</span><br/></pre></td></tr></tbody></table></figure><h4 id=\"安装-1\"><a href=\"#安装-1\" class=\"headerlink\" title=\"安装\"></a>安装</h4><figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br/></pre></td><td class=\"code\"><pre><span class=\"line\">make &amp;&amp; make install</span><br/></pre></td></tr></tbody></table></figure><h4 id=\"启动nginx\"><a href=\"#启动nginx\" class=\"headerlink\" title=\"启动nginx\"></a>启动nginx</h4><p>启动时会nginx可能会报错</p><figure class=\"highlight plain\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br/></pre></td><td class=\"code\"><pre><span class=\"line\">./nginx: error while loading shared libraries: libluajit-5.1.so.2: cannot open shared object file:</span><br/></pre></td></tr></tbody></table></figure><p>原因是：找不到libluajit-5.1.so.2这个文件</p><p><strong>解决办法</strong></p><p>找到 libluajit-5.1.so.2,libluajit-5.1.so.2.0.2这两个文件复制到 对应的lib下<br/>64位是 /usr/lib64<br/>32位是 /usr/lib</p><figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br/></pre></td><td class=\"code\"><pre><span class=\"line\">find / -name libluajit-5.1.so.2</span><br/></pre></td></tr></tbody></table></figure><p><img src=\"https://wandouduoduo.github.io//articles/c745ae1a/1.png\" alt=\"\"/></p><p>文件默认是安装在 /usr/local/lib/libluajit-5.1.so.2下</p><figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br/><span class=\"line\">2</span><br/></pre></td><td class=\"code\"><pre><span class=\"line\">cp /usr/<span class=\"built_in\">local</span>/lib/libluajit-5.1.so.2 /usr/lib64/</span><br/><span class=\"line\">cp /usr/<span class=\"built_in\">local</span>/lib/libluajit-5.1.so.2.0.2 /usr/lib64</span><br/></pre></td></tr></tbody></table></figure><p><strong>然后启动</strong></p><figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br/></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/<span class=\"built_in\">local</span>/nginx/sbin/nginx</span><br/></pre></td></tr></tbody></table></figure><h2 id=\"验证\"><a href=\"#验证\" class=\"headerlink\" title=\"验证\"></a>验证</h2><p>在nginx安装目录下，修改nginx.conf文件</p><p>在Server代码块下添加如下代码</p><figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br/><span class=\"line\">2</span><br/><span class=\"line\">3</span><br/><span class=\"line\">4</span><br/></pre></td><td class=\"code\"><pre><span class=\"line\">location /hello{</span><br/><span class=\"line\">        default_type <span class=\"string\">&#39;text/plain&#39;</span>;</span><br/><span class=\"line\">        content_by_lua <span class=\"string\">&#39;ngx.say(&#34;hello,lua&#34;)&#39;</span>;</span><br/><span class=\"line\">}</span><br/></pre></td></tr></tbody></table></figure><p><img src=\"https://wandouduoduo.github.io//articles/c745ae1a/2.png\" alt=\"\"/></p><p><strong>配置生效</strong></p><figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br/><span class=\"line\">2</span><br/></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/<span class=\"built_in\">local</span>/nginx/sbin/nginx -t</span><br/><span class=\"line\">/usr/<span class=\"built_in\">local</span>/nginx/sbin/nginx -s reload</span><br/></pre></td></tr></tbody></table></figure><p><strong>浏览器访问</strong></p><p>访问地址： <a href=\"http://xxx.xxx.xxx/hello\" target=\"_blank\" rel=\"noopener noreferrer\">http://xxx.xxx.xxx/hello</a></p><p><img src=\"https://wandouduoduo.github.io//articles/c745ae1a/3.png\" alt=\"\"/></p><p>到此就成功了。</p><h2 id=\"添加服务\"><a href=\"#添加服务\" class=\"headerlink\" title=\"添加服务\"></a>添加服务</h2><p>这时nginx只能用绝对路径启动，测试和重载，非常不方便。那需要把nginx添加到linux的服务管理中。</p><p><strong>编写nginx.service文件</strong></p><figure class=\"highlight plain\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br/><span class=\"line\">2</span><br/><span class=\"line\">3</span><br/><span class=\"line\">4</span><br/><span class=\"line\">5</span><br/><span class=\"line\">6</span><br/><span class=\"line\">7</span><br/><span class=\"line\">8</span><br/><span class=\"line\">9</span><br/><span class=\"line\">10</span><br/><span class=\"line\">11</span><br/><span class=\"line\">12</span><br/><span class=\"line\">13</span><br/></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br/><span class=\"line\">Description=nginx</span><br/><span class=\"line\">After=network.target</span><br/><span class=\"line\"></span><br/><span class=\"line\">[Service]</span><br/><span class=\"line\">Type=forking</span><br/><span class=\"line\">ExecStart=/usr/local/nginx/sbin/nginx</span><br/><span class=\"line\">ExecReload=/usr/local/nginx/sbin/nginx -s reload</span><br/><span class=\"line\">ExecStop=/usr/local/nginx/sbin/nginx -s quit</span><br/><span class=\"line\">PrivateTmp=true</span><br/><span class=\"line\"></span><br/><span class=\"line\">[Install]</span><br/><span class=\"line\">WantedBy=multi-user.target</span><br/></pre></td></tr></tbody></table></figure><p><strong>添加</strong></p><figure class=\"highlight plain\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br/></pre></td><td class=\"code\"><pre><span class=\"line\">cp ./nginx.service /lib/systemd/system/</span><br/></pre></td></tr></tbody></table></figure><p><strong>重新加载</strong></p><figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br/></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br/></pre></td></tr></tbody></table></figure><p><strong>验证</strong></p><figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br/><span class=\"line\">2</span><br/><span class=\"line\">3</span><br/></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start nginx.service</span><br/><span class=\"line\">systemctl status nginx.service</span><br/><span class=\"line\">systemctl <span class=\"built_in\">enable</span> nginx.service</span><br/></pre></td></tr></tbody></table></figure>","text":"(adsbygoogle=window.adsbygoogle||[]).push({})背景Lua 是一种轻量小巧的脚本语言，用标准C语言编写并以源代码形式开放， 其设计目的是为了嵌入应用程序中，从而为应用程序提供灵活的扩展和定制功能。现在通常把lua迁入nginx中，根据lu...","link":"","photos":[],"count_time":{"symbolsCount":"2.3k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%83%8C%E6%99%AF\"><span class=\"toc-text\">背景</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%8E%AF%E5%A2%83\"><span class=\"toc-text\">环境</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">安装</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99\"><span class=\"toc-text\">关闭防火墙</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96%E7%8E%AF%E5%A2%83\"><span class=\"toc-text\">安装依赖环境</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85LuaJIT\"><span class=\"toc-text\">安装LuaJIT</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85nginx\"><span class=\"toc-text\">安装nginx</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E7%BC%96%E8%AF%91Nginx\"><span class=\"toc-text\">编译Nginx</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85-1\"><span class=\"toc-text\">安装</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%90%AF%E5%8A%A8nginx\"><span class=\"toc-text\">启动nginx</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%AA%8C%E8%AF%81\"><span class=\"toc-text\">验证</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%B7%BB%E5%8A%A0%E6%9C%8D%E5%8A%A1\"><span class=\"toc-text\">添加服务</span></a></li></ol>","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Evaluation of clustering","uid":"30727807ab641aee32f6f2d8ba3f604d","slug":"zl/2016-01-01-972_Evaluation of clustering","date":"2024-04-03T03:47:36.233Z","updated":"2024-04-03T03:47:36.233Z","comments":true,"path":"api/articles/zl/2016-01-01-972_Evaluation of clustering.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"聚类的目标high intra-cluster similarity and low inter-cluster similarity 数据集有groundtruth时，如何评估聚类结果的优劣？ 4种评估方法 purity。 简单。 NMI。从信息论角度解释。 RI。实质是acc...","link":"","photos":[],"count_time":{"symbolsCount":"2k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"lua table深拷贝","uid":"edf7212f56a6607561f8cb09a5c0dcb3","slug":"zl/2016-01-01-971_lua table深拷贝","date":"2024-04-03T03:47:36.232Z","updated":"2024-04-03T03:47:36.233Z","comments":true,"path":"api/articles/zl/2016-01-01-971_lua table深拷贝.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"深拷贝，只需要对table类型进行递归拷贝即可，其他类型直接用赋值拷贝或浅拷贝。 还有，拷贝后的table应与原table具有相同的元表，and元表不需要递归拷贝。 function deepcopy( src ) local lookup_table = &#123;&#125...","link":"","photos":[],"count_time":{"symbolsCount":"3.3k","symbolsTime":"3 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}