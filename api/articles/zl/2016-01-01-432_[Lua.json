{"title":"Lua","uid":"15b0cdc6d03f6c3f6bf8d3a7ff197317","slug":"zl/2016-01-01-432_[Lua","date":"2024-04-03T03:47:35.719Z","updated":"2024-04-03T03:47:35.719Z","comments":true,"path":"api/articles/zl/2016-01-01-432_[Lua.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","content":"<p>读书笔记： Programming in Lua, 4th Edition.</p>\n<h2 id=\"正常函数调用\">正常函数调用</h2>\n<div class=\"language-lua highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"mi\">8</span><span class=\"o\">*</span><span class=\"mi\">9</span><span class=\"p\">,</span> <span class=\"mi\">9</span><span class=\"o\">/</span><span class=\"mi\">8</span><span class=\"p\">)</span>\n<span class=\"n\">a</span> <span class=\"o\">=</span> <span class=\"nb\">math.sin</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"nb\">math.cos</span><span class=\"p\">(</span><span class=\"mi\">10</span><span class=\"p\">)</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"nb\">os.date</span><span class=\"p\">())</span>\n</code></pre></div></div>\n<div class=\"language-lua highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">-- add the elements of sequence &#39;a&#39;</span>\n<span class=\"k\">function</span> <span class=\"nf\">add</span> <span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">)</span>\n    <span class=\"kd\">local</span> <span class=\"n\">sum</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n    <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"o\">#</span><span class=\"n\">a</span> <span class=\"k\">do</span>\n        <span class=\"n\">sum</span> <span class=\"o\">=</span> <span class=\"n\">sum</span> <span class=\"o\">+</span> <span class=\"n\">a</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span>\n    <span class=\"k\">end</span>\n    <span class=\"k\">return</span> <span class=\"n\">sum</span>\n<span class=\"k\">end</span>\n</code></pre></div></div>\n<p>if the function has one single argument and that argument is either a literal string or a table constructor,\nthen the parentheses are optional:</p>\n<p>如果函数只有一个参数，并且这个参数是字符串或者是table的话，函数的括号()可以省略。</p>\n<div class=\"language-lua highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">print</span> <span class=\"s2\">&#34;Hello World&#34;</span>     <span class=\"o\">&lt;</span><span class=\"c1\">--&gt;    print(&#34;Hello World&#34;)</span>\n<span class=\"nb\">dofile</span> <span class=\"s1\">&#39;a.lua&#39;</span>          <span class=\"o\">&lt;</span><span class=\"c1\">--&gt;    dofile (&#39;a.lua&#39;)</span>\n<span class=\"nb\">print</span> <span class=\"s\">[[a multi-line    &lt;--&gt;    print([[a multi-line\n      message]]</span>                     <span class=\"n\">message</span><span class=\"p\">]])</span>\n<span class=\"n\">f</span><span class=\"p\">&#123;</span><span class=\"n\">x</span><span class=\"o\">=</span><span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"n\">y</span><span class=\"o\">=</span><span class=\"mi\">20</span><span class=\"p\">&#125;</span>           <span class=\"o\">&lt;</span><span class=\"c1\">--&gt;    f(&#123;x=10, y=20&#125;)</span>\n<span class=\"nb\">type</span><span class=\"p\">&#123;&#125;</span>                  <span class=\"o\">&lt;</span><span class=\"c1\">--&gt;    type(&#123;&#125;)</span>\n</code></pre></div></div>\n<p>We can call a function with a number of arguments different from its number of parameters. Lua adjusts\nthe number of arguments to the number of parameters by throwing away extra arguments and supplying\nnils to extra parameters. For instance, consider the next function:</p>\n<p>函数调用时提供的参数可以和函数定义时的参数个数不同。不足的用nil补全，多余的话会被自动忽略。</p>\n<div class=\"language-lua highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">function</span> <span class=\"nf\">f</span> <span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"n\">b</span><span class=\"p\">)</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">,</span> <span class=\"n\">b</span><span class=\"p\">)</span>\n<span class=\"k\">end</span>\n<p><span class=\"n\">f</span><span class=\"p\">()</span>           <span class=\"c1\">–&gt; nil nil</span><br />\n<span class=\"n\">f</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">)</span>          <span class=\"c1\">–&gt; 3 nil</span><br />\n<span class=\"n\">f</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">)</span>       <span class=\"c1\">–&gt; 3 4</span><br />\n<span class=\"n\">f</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"mi\">5</span><span class=\"p\">)</span>    <span class=\"c1\">–&gt; 3 4 (5 is discarded)</span><br />\n</code></pre></div></div></p>\n<div class=\"language-lua highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">function</span> <span class=\"nf\">incCount</span> <span class=\"p\">(</span><span class=\"n\">n</span><span class=\"p\">)</span>\n    <span class=\"n\">n</span> <span class=\"o\">=</span> <span class=\"n\">n</span> <span class=\"ow\">or</span> <span class=\"mi\">1</span>\n    <span class=\"n\">globalCounter</span> <span class=\"o\">=</span> <span class=\"n\">globalCounter</span> <span class=\"o\">+</span> <span class=\"n\">n</span>\n<span class=\"k\">end</span>\n</code></pre></div></div>\n<h2 id=\"multiple-results\">Multiple Results</h2>\n<div class=\"language-lua highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">function</span> <span class=\"nf\">maximum</span> <span class=\"p\">(</span><span class=\"n\">a</span><span class=\"p\">)</span>\n    <span class=\"kd\">local</span> <span class=\"n\">mi</span> <span class=\"o\">=</span> <span class=\"mi\">1</span> <span class=\"c1\">-- index of the maximum value</span>\n    <span class=\"kd\">local</span> <span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"n\">a</span><span class=\"p\">[</span><span class=\"n\">mi</span><span class=\"p\">]</span> <span class=\"c1\">-- maximum value</span>\n    <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"o\">#</span><span class=\"n\">a</span> <span class=\"k\">do</span>\n        <span class=\"k\">if</span> <span class=\"n\">a</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span> <span class=\"o\">&gt;</span> <span class=\"n\">m</span> <span class=\"k\">then</span>\n            <span class=\"n\">mi</span> <span class=\"o\">=</span> <span class=\"n\">i</span><span class=\"p\">;</span> <span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"n\">a</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span>\n        <span class=\"k\">end</span>\n    <span class=\"k\">end</span>\n    <span class=\"k\">return</span> <span class=\"n\">m</span><span class=\"p\">,</span> <span class=\"n\">mi</span> <span class=\"c1\">-- return the maximum and its index</span>\n<span class=\"k\">end</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">maximum</span><span class=\"p\">(&#123;</span><span class=\"mi\">8</span><span class=\"p\">,</span><span class=\"mi\">10</span><span class=\"p\">,</span><span class=\"mi\">23</span><span class=\"p\">,</span><span class=\"mi\">12</span><span class=\"p\">,</span><span class=\"mi\">5</span><span class=\"p\">&#125;))</span> <span class=\"c1\">--&gt; 23 3</span>\n</code></pre></div></div>\n<p>Lua always adjusts the number of results from a function to the circumstances of the call.</p>\n<p>When we call a function as a statement, Lua discards all results from the function.</p>\n<p>When we use a call as an expression (e.g., the operand of an addition), Lua keeps only the first result.</p>\n<p>We get all results only when the call is the last (or the only) expression in a list of expressions.</p>\n<div class=\"language-lua highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">function</span> <span class=\"nf\">foo0</span> <span class=\"p\">()</span> <span class=\"k\">end</span>                  <span class=\"c1\">-- returns no results</span>\n<span class=\"k\">function</span> <span class=\"nf\">foo1</span> <span class=\"p\">()</span> <span class=\"k\">return</span> <span class=\"s2\">&#34;a&#34;</span> <span class=\"k\">end</span>       <span class=\"c1\">-- returns 1 result</span>\n<span class=\"k\">function</span> <span class=\"nf\">foo2</span> <span class=\"p\">()</span> <span class=\"k\">return</span> <span class=\"s2\">&#34;a&#34;</span><span class=\"p\">,</span> <span class=\"s2\">&#34;b&#34;</span> <span class=\"k\">end</span>  <span class=\"c1\">-- returns 2 results</span>\n</code></pre></div></div>\n<div class=\"language-lua highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">y</span> <span class=\"o\">=</span> <span class=\"n\">foo2</span><span class=\"p\">()</span>                 <span class=\"c1\">-- x=&#34;a&#34;, y=&#34;b&#34;</span>\n<span class=\"n\">x</span> <span class=\"o\">=</span> <span class=\"n\">foo2</span><span class=\"p\">()</span>                    <span class=\"c1\">-- x=&#34;a&#34;, &#34;b&#34; is discarded</span>\n<span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">y</span><span class=\"p\">,</span> <span class=\"n\">z</span> <span class=\"o\">=</span> <span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"n\">foo2</span><span class=\"p\">()</span>          <span class=\"c1\">-- x=10, y=&#34;a&#34;, z=&#34;b&#34;</span>\n</code></pre></div></div>\n<div class=\"language-lua highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"n\">y</span> <span class=\"o\">=</span> <span class=\"n\">foo0</span><span class=\"p\">()</span> <span class=\"c1\">-- x=nil, y=nil</span>\n<span class=\"n\">x</span><span class=\"p\">,</span><span class=\"n\">y</span> <span class=\"o\">=</span> <span class=\"n\">foo1</span><span class=\"p\">()</span> <span class=\"c1\">-- x=&#34;a&#34;, y=nil</span>\n<span class=\"n\">x</span><span class=\"p\">,</span><span class=\"n\">y</span><span class=\"p\">,</span><span class=\"n\">z</span> <span class=\"o\">=</span> <span class=\"n\">foo2</span><span class=\"p\">()</span> <span class=\"c1\">-- x=&#34;a&#34;, y=&#34;b&#34;, z=nil</span>\n</code></pre></div></div>\n<p>Remember that multiple results only happen when the call is the last (or only) expression in a list. A\nfunction call that is not the last element in the list always produces exactly one result:</p>\n<div class=\"language-lua highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"n\">y</span> <span class=\"o\">=</span> <span class=\"n\">foo2</span><span class=\"p\">(),</span> <span class=\"mi\">20</span> <span class=\"c1\">-- x=&#34;a&#34;, y=20 (&#39;b&#39; discarded)</span>\n<span class=\"n\">x</span><span class=\"p\">,</span><span class=\"n\">y</span> <span class=\"o\">=</span> <span class=\"n\">foo0</span><span class=\"p\">(),</span> <span class=\"mi\">20</span><span class=\"p\">,</span> <span class=\"mi\">30</span> <span class=\"c1\">-- x=nil, y=20 (30 is discarded)</span>\n</code></pre></div></div>\n<div class=\"language-lua highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">foo0</span><span class=\"p\">())</span> <span class=\"c1\">--&gt; (no results)</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">foo1</span><span class=\"p\">())</span> <span class=\"c1\">--&gt; a</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">foo2</span><span class=\"p\">())</span> <span class=\"c1\">--&gt; a b</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">foo2</span><span class=\"p\">(),</span> <span class=\"mi\">1</span><span class=\"p\">)</span> <span class=\"c1\">--&gt; a 1</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">foo2</span><span class=\"p\">()</span> <span class=\"o\">..</span> <span class=\"s2\">&#34;x&#34;</span><span class=\"p\">)</span> <span class=\"c1\">--&gt; ax (see next)</span>\n</code></pre></div></div>\n<p>A constructor also collects all results from a call, without any adjustments:</p>\n<div class=\"language-lua highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">t</span> <span class=\"o\">=</span> <span class=\"p\">&#123;</span><span class=\"n\">foo0</span><span class=\"p\">()&#125;</span> <span class=\"c1\">-- t = &#123;&#125; (an empty table)</span>\n<span class=\"n\">t</span> <span class=\"o\">=</span> <span class=\"p\">&#123;</span><span class=\"n\">foo1</span><span class=\"p\">()&#125;</span> <span class=\"c1\">-- t = &#123;&#34;a&#34;&#125;</span>\n<span class=\"n\">t</span> <span class=\"o\">=</span> <span class=\"p\">&#123;</span><span class=\"n\">foo2</span><span class=\"p\">()&#125;</span> <span class=\"c1\">-- t = &#123;&#34;a&#34;, &#34;b&#34;&#125;</span>\n</code></pre></div></div>\n<p>As always, this behavior happens only when the call is the last expression in the list; calls in any other\nposition produce exactly one result:</p>\n<div class=\"language-lua highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">t</span> <span class=\"o\">=</span> <span class=\"p\">&#123;</span><span class=\"n\">foo0</span><span class=\"p\">(),</span> <span class=\"n\">foo2</span><span class=\"p\">(),</span> <span class=\"mi\">4</span><span class=\"p\">&#125;</span> <span class=\"c1\">-- t[1] = nil, t[2] = &#34;a&#34;, t[3] = 4</span>\n</code></pre></div></div>\n<p>We can force a call to return exactly one result by enclosing it in an extra pair of parentheses:</p>\n<div class=\"language-lua highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">print</span><span class=\"p\">((</span><span class=\"n\">foo0</span><span class=\"p\">()))</span> <span class=\"c1\">--&gt; nil</span>\n<span class=\"nb\">print</span><span class=\"p\">((</span><span class=\"n\">foo1</span><span class=\"p\">()))</span> <span class=\"c1\">--&gt; a</span>\n<span class=\"nb\">print</span><span class=\"p\">((</span><span class=\"n\">foo2</span><span class=\"p\">()))</span> <span class=\"c1\">--&gt; a</span>\n</code></pre></div></div>\n<h2 id=\"variadic-functions-可变参数\">Variadic Functions 可变参数</h2>\n<div class=\"language-lua highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">function</span> <span class=\"nf\">add</span><span class=\"p\">(</span><span class=\"o\">...</span><span class=\"p\">)</span>\n    <span class=\"kd\">local</span> <span class=\"n\">s</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n    <span class=\"k\">for</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">v</span> <span class=\"k\">in</span> <span class=\"nb\">ipairs</span><span class=\"p\">&#123;</span><span class=\"o\">...</span><span class=\"p\">&#125;</span> <span class=\"k\">do</span>\n        <span class=\"n\">s</span> <span class=\"o\">=</span> <span class=\"n\">s</span> <span class=\"o\">+</span> <span class=\"n\">v</span>\n    <span class=\"k\">end</span>\n    <span class=\"k\">return</span> <span class=\"n\">s</span>\n<span class=\"k\">end</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"mi\">25</span><span class=\"p\">,</span> <span class=\"mi\">12</span><span class=\"p\">))</span> <span class=\"c1\">--&gt; 54</span>\n</code></pre></div></div>\n<p>Lua offers the function table.pack.1 This function receives any number of arguments and returns a\nnew table with all its arguments (just like {…}), but this table has also an extra field “n”, with the total\nnumber of arguments.</p>\n<div class=\"language-lua highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">function</span> <span class=\"nf\">nonils</span><span class=\"p\">(</span><span class=\"o\">...</span><span class=\"p\">)</span>\n    <span class=\"kd\">local</span> <span class=\"n\">arg</span> <span class=\"o\">=</span> <span class=\"nb\">table.pack</span><span class=\"p\">(</span><span class=\"o\">...</span><span class=\"p\">)</span>\n    <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">arg</span><span class=\"p\">.</span><span class=\"n\">n</span> <span class=\"k\">do</span>\n        <span class=\"k\">if</span> <span class=\"n\">arg</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span> <span class=\"o\">==</span> <span class=\"kc\">nil</span> <span class=\"k\">then</span>\n            <span class=\"k\">return</span> <span class=\"kc\">false</span>\n        <span class=\"k\">end</span>\n    <span class=\"k\">end</span>\n    <span class=\"k\">return</span> <span class=\"kc\">true</span>\n<span class=\"k\">end</span>\n<p><span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">nonils</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"kc\">nil</span><span class=\"p\">))</span> <span class=\"c1\">–&gt; false</span><br />\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">nonils</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">3</span><span class=\"p\">))</span> <span class=\"c1\">–&gt; true</span><br />\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">nonils</span><span class=\"p\">())</span> <span class=\"c1\">–&gt; true</span><br />\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">nonils</span><span class=\"p\">(</span><span class=\"kc\">nil</span><span class=\"p\">))</span> <span class=\"c1\">–&gt; false</span><br />\n</code></pre></div></div></p>\n<p>A call to select\nhas always one fixed argument, the selector, plus a variable number of extra arguments. If the selector is\na number n, select returns all arguments after the n-th argument; otherwise, the selector should be the\nstring “#”, so that select returns the total number of extra arguments.</p>\n<div class=\"language-lua highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"nb\">select</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"s2\">&#34;a&#34;</span><span class=\"p\">,</span> <span class=\"s2\">&#34;b&#34;</span><span class=\"p\">,</span> <span class=\"s2\">&#34;c&#34;</span><span class=\"p\">))</span> <span class=\"c1\">--&gt; a b c</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"nb\">select</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"s2\">&#34;a&#34;</span><span class=\"p\">,</span> <span class=\"s2\">&#34;b&#34;</span><span class=\"p\">,</span> <span class=\"s2\">&#34;c&#34;</span><span class=\"p\">))</span> <span class=\"c1\">--&gt; b c</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"nb\">select</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"s2\">&#34;a&#34;</span><span class=\"p\">,</span> <span class=\"s2\">&#34;b&#34;</span><span class=\"p\">,</span> <span class=\"s2\">&#34;c&#34;</span><span class=\"p\">))</span> <span class=\"c1\">--&gt; c</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"nb\">select</span><span class=\"p\">(</span><span class=\"s2\">&#34;#&#34;</span><span class=\"p\">,</span> <span class=\"s2\">&#34;a&#34;</span><span class=\"p\">,</span> <span class=\"s2\">&#34;b&#34;</span><span class=\"p\">,</span> <span class=\"s2\">&#34;c&#34;</span><span class=\"p\">))</span> <span class=\"c1\">--&gt; 3</span>\n</code></pre></div></div>\n<div class=\"language-lua highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">function</span> <span class=\"nf\">add</span> <span class=\"p\">(</span><span class=\"o\">...</span><span class=\"p\">)</span>\n    <span class=\"kd\">local</span> <span class=\"n\">s</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"nb\">select</span><span class=\"p\">(</span><span class=\"s2\">&#34;#&#34;</span><span class=\"p\">,</span> <span class=\"o\">...</span><span class=\"p\">)</span> <span class=\"k\">do</span>\n            <span class=\"n\">s</span> <span class=\"o\">=</span> <span class=\"n\">s</span> <span class=\"o\">+</span> <span class=\"nb\">select</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"o\">...</span><span class=\"p\">)</span>\n        <span class=\"k\">end</span>\n    <span class=\"k\">return</span> <span class=\"n\">s</span>\n<span class=\"k\">end</span>\n</code></pre></div></div>\n<h2 id=\"tableunpack\">table.unpack</h2>\n<p>A special function with multiple returns is table.unpack. It takes a list and returns as results all elements\nfrom the list:</p>\n<div class=\"language-lua highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"nb\">table.unpack</span><span class=\"p\">&#123;</span><span class=\"mi\">10</span><span class=\"p\">,</span><span class=\"mi\">20</span><span class=\"p\">,</span><span class=\"mi\">30</span><span class=\"p\">&#125;)</span> <span class=\"c1\">--&gt; 10 20 30</span>\n<span class=\"n\">a</span><span class=\"p\">,</span><span class=\"n\">b</span> <span class=\"o\">=</span> <span class=\"nb\">table.unpack</span><span class=\"p\">&#123;</span><span class=\"mi\">10</span><span class=\"p\">,</span><span class=\"mi\">20</span><span class=\"p\">,</span><span class=\"mi\">30</span><span class=\"p\">&#125;</span> <span class=\"c1\">-- a=10, b=20, 30 is discarded</span>\n</code></pre></div></div>\n<p>As the name implies, table.unpack is the reverse of table.pack. While pack transforms a parameter\nlist into a real Lua list (a table), unpack transforms a real Lua list (a table) into a return list, which\ncan be given as the parameter list to another function.</p>\n<div class=\"language-lua highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">function</span> <span class=\"nf\">unpack</span> <span class=\"p\">(</span><span class=\"n\">t</span><span class=\"p\">,</span> <span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">n</span><span class=\"p\">)</span>\n    <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">i</span> <span class=\"ow\">or</span> <span class=\"mi\">1</span>\n    <span class=\"n\">n</span> <span class=\"o\">=</span> <span class=\"n\">n</span> <span class=\"ow\">or</span> <span class=\"o\">#</span><span class=\"n\">t</span>\n    <span class=\"k\">if</span> <span class=\"n\">i</span> <span class=\"o\">&lt;=</span> <span class=\"n\">n</span> <span class=\"k\">then</span>\n        <span class=\"k\">return</span> <span class=\"n\">t</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">],</span> <span class=\"n\">unpack</span><span class=\"p\">(</span><span class=\"n\">t</span><span class=\"p\">,</span> <span class=\"n\">i</span> <span class=\"o\">+</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">n</span><span class=\"p\">)</span>\n    <span class=\"k\">end</span>\n<span class=\"k\">end</span>\n</code></pre></div></div>\n<h2 id=\"proper-tail-calls\">Proper Tail Calls</h2>\n<p>尾调用：也就是在一个函数A的最后调用一个函数B，因为函数A已经执行完了，所以函数B可以重复利用A的栈空间，提高效率。</p>","text":"读书笔记： Programming in Lua, 4th Edition. 正常函数调用 print(8*9, 9/8) a = math.sin(3) + math.cos(10) print(os.date()) -- add the elements of sequenc...","link":"","photos":[],"count_time":{"symbolsCount":"5.9k","symbolsTime":"5 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%AD%A3%E5%B8%B8%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8\"><span class=\"toc-text\">正常函数调用</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#multiple-results\"><span class=\"toc-text\">Multiple Results</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#variadic-functions-%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0\"><span class=\"toc-text\">Variadic Functions 可变参数</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#tableunpack\"><span class=\"toc-text\">table.unpack</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#proper-tail-calls\"><span class=\"toc-text\">Proper Tail Calls</span></a></li></ol>","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"luasocket getaddrinfo nil 问题","uid":"f597dc45b4c99d9cbe30780591e468ce","slug":"zl/2016-01-01-437_luasocket getaddrinfo nil 问题 ","date":"2024-04-03T03:47:35.720Z","updated":"2024-04-03T03:47:35.721Z","comments":true,"path":"api/articles/zl/2016-01-01-437_luasocket getaddrinfo nil 问题 .json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"使用 luarocks 安装 luasocket，在调用 bind 时，报： socket.lua:29: attempt to call field ‘getaddrinfo’ (a nil value) 继续执行以下 lua 代码片段： Lua 5.1.4 Copyright...","link":"","photos":[],"count_time":{"symbolsCount":"2.2k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Lua string 哈希碰撞","uid":"238efc63608af17eea7a4ab65a98f6e7","slug":"zl/2016-01-01-433_Lua string 哈希碰撞 ","date":"2024-04-03T03:47:35.719Z","updated":"2024-04-03T03:47:35.720Z","comments":true,"path":"api/articles/zl/2016-01-01-433_Lua string 哈希碰撞 .json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"Lua 中 40 字节以下的字符串会被内部化到一张表中(Lua 5.3)，这张表挂在 global state 结构下。对于短字符串，相同的串在同一虚拟机上只会存在一份，这被称为字符串的内部化。 其实字符串在 Lua VM 中是以两种内部形式保存的：短字符串及长字符串。其界限默认...","link":"","photos":[],"count_time":{"symbolsCount":"2.2k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}