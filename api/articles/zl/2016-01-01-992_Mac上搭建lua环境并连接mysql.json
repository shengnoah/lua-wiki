{"title":"Mac上搭建lua环境并连接mysql","uid":"80eaeb4f03e297865aa72cd0ce564033","slug":"zl/2016-01-01-992_Mac上搭建lua环境并连接mysql","date":"2024-04-03T03:47:36.241Z","updated":"2024-04-03T03:47:36.241Z","comments":true,"path":"api/articles/zl/2016-01-01-992_Mac上搭建lua环境并连接mysql.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","content":"<p>Lua 是一种轻量小巧的脚本语言，用标准C语言编写并以源代码形式开放， 其设计目的是为了嵌入应用程序中，从而为应用程序提供灵活的扩展和定制功能。(以上摘抄自菜鸟教程)</p>\n<p>鉴于Lua的诸多优势，我想在接下来的开发中应用Lua去完成一些需要脚本实现的工作。本文将记录我在Mac上搭建Lua的开发环境搭建以及实现对mysql的数据库访问。</p>\n<h3 id=\"1-Lua安装\"><a href=\"#1-Lua安装\" class=\"headerlink\" title=\"1. Lua安装\"></a>1. Lua安装</h3><h4 id=\"源码编译安装\"><a href=\"#源码编译安装\" class=\"headerlink\" title=\"源码编译安装\"></a>源码编译安装</h4><figure class=\"highlight plain\"><table><tbody><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">curl -R -O http://www.lua.org/ftp/lua-5.3.0.tar.gz</div><div class=\"line\">tar zxf lua-5.3.0.tar.gz</div><div class=\"line\">cd lua-5.3.0</div><div class=\"line\">make macosx test</div><div class=\"line\">make install</div></pre></td></tr></tbody></table></figure>\n<p>由于mac的当前系统版本下，连root用户都无法在/usr目录下创建写文件，故需要到lua的Makefile文件中将所有需要创建到/usr目录下的文件改到本用户目录下，Makefile的部分配置信息如下：<br/></p><figure class=\"highlight plain\"><table><tbody><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">INSTALL_TOP= /usr/local</div><div class=\"line\">INSTALL_BIN= $(INSTALL_TOP)/bin</div><div class=\"line\">INSTALL_INC= $(INSTALL_TOP)/include</div><div class=\"line\">INSTALL_LIB= $(INSTALL_TOP)/lib</div><div class=\"line\">INSTALL_MAN= $(INSTALL_TOP)/man/man1</div><div class=\"line\">INSTALL_LMOD= $(INSTALL_TOP)/share/lua/$V</div><div class=\"line\">INSTALL_CMOD= $(INSTALL_TOP)/lib/lua/$V</div></pre></td></tr></tbody></table></figure><p></p>\n<p>将INSTALL_TOP的值改为~/任意目录</p>\n<h4 id=\"homebrew安装\"><a href=\"#homebrew安装\" class=\"headerlink\" title=\"homebrew安装\"></a>homebrew安装</h4><figure class=\"highlight plain\"><table><tbody><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">brew install lua</div></pre></td></tr></tbody></table></figure>\n<p>mac下用这种方式安装肯定是最简单的，只是版本可能会稍微落后些</p>\n<p>接下来我们创建一个 HelloWorld.lua 文件，代码如下:<br/></p><figure class=\"highlight lua\"><table><tbody><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#34;Hello World!&#34;</span>)</div></pre></td></tr></tbody></table></figure><p></p>\n<p>执行以下命令:<br/></p><figure class=\"highlight plain\"><table><tbody><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">lua HelloWorld.lua</div></pre></td></tr></tbody></table></figure><p></p>\n<p>输出结果为：<br/></p><figure class=\"highlight plain\"><table><tbody><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">Hello World!</div></pre></td></tr></tbody></table></figure><p></p>\n<h3 id=\"2-Lua连接mysql\"><a href=\"#2-Lua连接mysql\" class=\"headerlink\" title=\"2. Lua连接mysql\"></a>2. Lua连接mysql</h3><p>Lua 数据库的操作库：LuaSQL。它是开源的，支持的数据库有：ODBC, ADO, Oracle, MySQL, SQLite 和 PostgreSQL。</p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">wget http://luarocks.org/releases/luarocks-2.2.1.tar.gz</div><div class=\"line\">tar zxpf luarocks-2.2.1.tar.gz</div><div class=\"line\"><span class=\"built_in\">cd</span> luarocks-2.2.1</div><div class=\"line\">./configure; sudo make bootstrap</div><div class=\"line\">sudo luarocks install luasocket</div><div class=\"line\">luarocks install luasql-mysql</div></pre></td></tr></tbody></table></figure>\n<p>以上步骤中，sudo luarocks install luasql-mysql这一步在mac中会出错，报找不到mysql.h文件，如果是linux上可以用apt-get install  lua-sql-mysql来安装，mac下，笔者经过研究采用的方式是先安装一个mysql数据库，然后去github上下载luasql的源码，解压后，进入目录编译安装。具体操作如下<br/></p><figure class=\"highlight plain\"><table><tbody><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">sudo make mysql</div></pre></td></tr></tbody></table></figure><p></p>\n<p>将src目录下ls_mysql.c里的#include “mysql.h”改成如下路径：</p>\n<figure class=\"highlight c\"><table><tbody><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"></div></pre></td></tr></tbody></table></figure>\n<p>随后将Makefile文件里的install:下的配置信息改成如下路径：<br/></p><figure class=\"highlight plain\"><table><tbody><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">install:</div><div class=\"line\">\tmkdir -p /users/shizhouyong/program/luasql</div><div class=\"line\">\tcp src/*.so /users/shizhouyong/program/luasql</div></pre></td></tr></tbody></table></figure><p></p>\n<p>最后<br/></p><figure class=\"highlight plain\"><table><tbody><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">make install</div></pre></td></tr></tbody></table></figure><p></p>\n<p>通过以上方式安装后笔者发现只能在/users/shizhouyong/program/luasql目录下执行<br/>附上：<a href=\"https://github.com/keplerproject/luasql\" target=\"_blank\" rel=\"external noopener noreferrer\">luasql源码的github地址</a></p>\n<h3 id=\"3-Lua-连接MySql-数据库\"><a href=\"#3-Lua-连接MySql-数据库\" class=\"headerlink\" title=\"3. Lua 连接MySql 数据库\"></a>3. Lua 连接MySql 数据库</h3><figure class=\"highlight lua\"><table><tbody><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div></pre></td><td class=\"code\"><pre><div class=\"line\">luasql = <span class=\"built_in\">require</span> <span class=\"string\">&#34;luasql.mysql&#34;</span></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">env = luasql.mysql()</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">--连接数据库</span></div><div class=\"line\">conn = env:connect(<span class=\"string\">&#34;数据库名&#34;</span>,<span class=\"string\">&#34;用户名&#34;</span>,<span class=\"string\">&#34;密码&#34;</span>,<span class=\"string\">&#34;IP地址&#34;</span>,端口)</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">--设置数据库的编码格式</span></div><div class=\"line\">conn:<span class=\"built_in\">execute</span><span class=\"string\">&#34;SET NAMES UTF8&#34;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">--执行数据库操作</span></div><div class=\"line\">cur = conn:<span class=\"built_in\">execute</span>(<span class=\"string\">&#34;select * from role&#34;</span>)</div><div class=\"line\"></div><div class=\"line\">row = cur:fetch({},<span class=\"string\">&#34;a&#34;</span>)</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">--文件对象的创建</span></div><div class=\"line\">file = <span class=\"built_in\">io</span>.<span class=\"built_in\">open</span>(<span class=\"string\">&#34;role.txt&#34;</span>,<span class=\"string\">&#34;w+&#34;</span>);</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">while</span> row <span class=\"keyword\">do</span></div><div class=\"line\">    var = <span class=\"built_in\">string</span>.<span class=\"built_in\">format</span>(<span class=\"string\">&#34;%d %sn&#34;</span>, row.id, row.name)</div><div class=\"line\"></div><div class=\"line\">    <span class=\"built_in\">print</span>(var)</div><div class=\"line\"></div><div class=\"line\">    file:<span class=\"built_in\">write</span>(var)</div><div class=\"line\"></div><div class=\"line\">    row = cur:fetch(row,<span class=\"string\">&#34;a&#34;</span>)</div><div class=\"line\"><span class=\"keyword\">end</span></div><div class=\"line\"></div><div class=\"line\">file:<span class=\"built_in\">close</span>()  <span class=\"comment\">--关闭文件对象</span></div><div class=\"line\">conn:<span class=\"built_in\">close</span>()  <span class=\"comment\">--关闭数据库连接</span></div><div class=\"line\">env:<span class=\"built_in\">close</span>()   <span class=\"comment\">--关闭数据库环境</span></div></pre></td></tr></tbody></table></figure>\n<p>通过以上方式安装后，笔者发现只能在/users/shizhouyong/program目录下执行引入luasql.mysql包的lua脚本，否则会报找不到mysql.so，具体原因笔者会持续研究。</p>","text":"Lua 是一种轻量小巧的脚本语言，用标准C语言编写并以源代码形式开放， 其设计目的是为了嵌入应用程序中，从而为应用程序提供灵活的扩展和定制功能。(以上摘抄自菜鸟教程) 鉴于Lua的诸多优势，我想在接下来的开发中应用Lua去完成一些需要脚本实现的工作。本文将记录我在Mac上搭建Lu...","link":"","photos":[],"count_time":{"symbolsCount":"2.3k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1-Lua%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">1. Lua安装</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">源码编译安装</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#homebrew%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">homebrew安装</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2-Lua%E8%BF%9E%E6%8E%A5mysql\"><span class=\"toc-text\">2. Lua连接mysql</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3-Lua-%E8%BF%9E%E6%8E%A5MySql-%E6%95%B0%E6%8D%AE%E5%BA%93\"><span class=\"toc-text\">3. Lua 连接MySql 数据库</span></a></li></ol>","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"基于AndroLua_Pro的Android开发笔记","uid":"fa8a6a5f27aae6005a6ca0b8e749bdc4","slug":"zl/2016-01-01-991_基于AndroLua_Pro的Android开发笔记","date":"2024-04-03T03:47:36.241Z","updated":"2024-04-03T03:47:36.241Z","comments":true,"path":"api/articles/zl/2016-01-01-991_基于AndroLua_Pro的Android开发笔记.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":" 温馨提示:请使用电脑浏览器打开,以确保最佳的阅读体验,谢谢.(￣▽￣)” 骚年, 学海无涯, 编程你怕不怕? 啥,你说怕? 那么你还看个P啊. [0]英文大小写忽略[1]文章中的 alua 和 AndroLua的含义一样[2]文章中的 AndroLua_Pro 和 AndroL...","link":"","photos":[],"count_time":{"symbolsCount":"1.3k","symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Lua table、模块与面向对象","uid":"2c7b59d286ea0f514f3312281292ce52","slug":"zl/2016-01-01-988_Lua table、模块与面向对象","date":"2024-04-03T03:47:36.240Z","updated":"2024-04-03T03:47:36.240Z","comments":true,"path":"api/articles/zl/2016-01-01-988_Lua table、模块与面向对象.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"很久之前接触过lua，最近在工作中又用到了一些，对lua这门语言又有了新的认识和理解。Lua是一门很简洁高效的语言,在openresty项目中大量使用，游戏开发中也使用lua来写一些脚本。在这里记录一下自己对lua中面向对象的理解。 table在lua中是一种kv的数据结构，也指...","link":"","photos":[],"count_time":{"symbolsCount":"2.3k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}