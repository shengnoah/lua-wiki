{"title":"Lua 汉字拼音首字母提取","uid":"7210045a47c00c031b29ac526b186e4c","slug":"zl/2016-01-01-394_Lua 汉字拼音首字母提取 ","date":"2024-04-03T03:47:35.684Z","updated":"2024-04-03T03:47:35.684Z","comments":true,"path":"api/articles/zl/2016-01-01-394_Lua 汉字拼音首字母提取 .json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","content":"<p>最近项目上有个需求，需要将一些联系人数据按照拼音首字母排序。google 了一番，竟然没有找到一个合适的 Lua 解决方案。倒是找到一个 lua-pinyin，粗略翻了下源码发现其是将所有的中文返回全部完整的拼音，原理是将所有汉字对应拼音创建好数据字典，载入 Lua，之后查询这个字典，返回对应的拼音。但是这对于我这个需求来说显然是太臃肿了，我只需要返回首字母就可以了，却载入一个巨大的字典，感觉有点浪费内存，尤其是在 OR 对于 Lua 的内存是有限制的情况下。</p>\n<p>为此自己造了个轮子：<a href=\"https://github.com/ms2008/lua-resty-pyf\">lua-resty-pyf</a>，感兴趣的同学可以去 github 搜下。这里我来说下原理。</p>\n<p>如果单从排序的角度来看，我们其实完全可以利用 GBK 中文的顺序编码来解决，而且 GBK 是固定字节编码，即：两个字节(一个区码和一个位码)。我们先计算出汉字对应的 GBK 码点，之后按照码点排序就实现了首字母的排序。</p>\n<p>如果需要提取出首字母用于检索，我们就必须建立一个映射关系，把所有汉字对应的首字母全部映射进去。好在已经有个老外做了这部分的工作，这里我用 ffi 简单封装了下，暴露出了 lua 的接口。</p>\n<p>需要注意的是我们这里使用的是 Unicode 的码点。也许你现在有个疑问？不是说 Lua 5.1 以下都是不支持 Unicode 的吗？</p>\n<p>首先 lua string 是一个 raw buffer，按字节存储的，是 <code class=\"highlighter-rouge\">","text":"最近项目上有个需求，需要将一些联系人数据按照拼音首字母排序。google 了一番，竟然没有找到一个合适的 Lua 解决方案。倒是找到一个 lua-pinyin，粗略翻了下源码发现其是将所有的中文返回全部完整的拼音，原理是将所有汉字对应拼音创建好数据字典，载入 Lua，之后查询这个...","link":"","photos":[],"count_time":{"symbolsCount":598,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"toc":"","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"LeetCode 150. Evaluate Reverse Polish Notation","uid":"9f85f1e7fd699a9f48cac697ebdd7c0c","slug":"zl/2016-01-01-397_LeetCode 150. Evaluate Reverse Polish Notation","date":"2024-04-03T03:47:35.685Z","updated":"2024-04-03T03:47:35.686Z","comments":true,"path":"api/articles/zl/2016-01-01-397_LeetCode 150. Evaluate Reverse Polish Notation.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"题目描述根据逆波兰表示法（后缀表达式），求表达式的值。 有效的运算符包括 +, -, *, / 。每个运算对象可以是整数，也可以是另一个逆波兰表达式。 说明： 整数除法只保留整数部分。给定逆波兰表达式总是有效的。换句话说，表达式总会得出有效数值且不存在除数为 0 的情况。 tag...","link":"","photos":[],"count_time":{"symbolsCount":"2k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"浅谈 ngx_lua 在 UPYUN 的应用","uid":"0626f334e1e0773ffd33c02e85588fe8","slug":"zl/2016-01-01-395_浅谈 ngx_lua 在 UPYUN 的应用","date":"2024-04-03T03:47:35.684Z","updated":"2024-04-03T03:47:35.684Z","comments":true,"path":"api/articles/zl/2016-01-01-395_浅谈 ngx_lua 在 UPYUN 的应用.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"ngx_lua 是一个 NGINX 的第三方扩展模块，它能够将 Lua 代码嵌入到 NGINX 中来执行。 UPYUN CDN 大量使用了 NGINX 作为反向代理服务器，其中绝大部分的业务逻辑已经由 Lua 来驱动了。 这个主题之前在 OSC 源创会 2014 北京站 和 Se...","link":"","photos":[],"count_time":{"symbolsCount":"8.4k","symbolsTime":"8 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}