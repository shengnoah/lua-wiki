{"title":"Lua 学习 chapter27","uid":"6fa85b2c9d2fb1c7122f1bf9a96bb9e7","slug":"zl/2016-01-01-305_Lua 学习 chapter27 ","date":"2024-04-03T03:47:35.585Z","updated":"2024-04-03T03:47:35.585Z","comments":true,"path":"api/articles/zl/2016-01-01-305_Lua 学习 chapter27 .json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","content":"<h3 id=\"目录\">目录</h3>\n<ol>\n  <li>lua堆栈操作</li>\n</ol>\n<blockquote>\n  <p>只有疯狂过，你才知道自己究竟能不能成功。</p>\n</blockquote>\n<h2 id=\"lua堆栈操作\">lua堆栈操作</h2>\n<p>针对于lua堆栈的操作。</p>\n<div class=\"language-c highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><table class=\"rouge-table\"><tbody><tr><td class=\"rouge-gutter gl\"><pre class=\"lineno\">1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n</pre></td><td class=\"rouge-code\"><pre><span class=\"k\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">stackDump</span><span class=\"p\">(</span><span class=\"n\">lua_State</span><span class=\"o\">*</span> <span class=\"n\">L</span><span class=\"p\">)</span> <span class=\"p\">&#123;</span>\n\t<span class=\"kt\">int</span> <span class=\"n\">i</span><span class=\"p\">;</span>\n\t<span class=\"kt\">int</span> <span class=\"n\">top</span> <span class=\"o\">=</span> <span class=\"n\">lua_gettop</span><span class=\"p\">(</span><span class=\"n\">L</span><span class=\"p\">);</span>\n\t<span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;=</span> <span class=\"n\">top</span><span class=\"p\">;</span> <span class=\"n\">i</span><span class=\"o\">++</span><span class=\"p\">)</span>\n\t<span class=\"p\">&#123;</span>\n\t\t<span class=\"kt\">int</span> <span class=\"n\">t</span> <span class=\"o\">=</span> <span class=\"n\">lua_type</span><span class=\"p\">(</span><span class=\"n\">L</span><span class=\"p\">,</span> <span class=\"n\">i</span><span class=\"p\">);</span>\n\t\t<span class=\"k\">switch</span> <span class=\"p\">(</span><span class=\"n\">t</span><span class=\"p\">)</span>\n\t\t<span class=\"p\">&#123;</span>\n\t\t<span class=\"k\">case</span> <span class=\"n\">LUA_TSTRING</span><span class=\"p\">:</span> <span class=\"p\">&#123;</span>\n\t\t\t<span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&#34;%s&#34;</span><span class=\"p\">,</span> <span class=\"n\">lua_tostring</span><span class=\"p\">(</span><span class=\"n\">L</span><span class=\"p\">,</span> <span class=\"n\">i</span><span class=\"p\">));</span>\n\t\t\t<span class=\"k\">break</span><span class=\"p\">;</span>\n\t\t<span class=\"p\">&#125;</span>\n\t\t<span class=\"k\">case</span> <span class=\"n\">LUA_TBOOLEAN</span><span class=\"p\">:</span> <span class=\"p\">&#123;</span>\n\t\t\t<span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"n\">lua_toboolean</span><span class=\"p\">(</span><span class=\"n\">L</span><span class=\"p\">,</span> <span class=\"n\">i</span><span class=\"p\">)</span> <span class=\"o\">?</span> <span class=\"s\">&#34;true&#34;</span> <span class=\"o\">:</span> <span class=\"s\">&#34;false&#34;</span><span class=\"p\">);</span>\n\t\t\t<span class=\"k\">break</span><span class=\"p\">;</span>\n\t\t<span class=\"p\">&#125;</span>\n\t\t<span class=\"k\">case</span> <span class=\"n\">LUA_TNUMBER</span><span class=\"p\">:</span> <span class=\"p\">&#123;</span>\n\t\t\t<span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&#34;%g&#34;</span><span class=\"p\">,</span> <span class=\"n\">lua_tonumber</span><span class=\"p\">(</span><span class=\"n\">L</span><span class=\"p\">,</span> <span class=\"n\">i</span><span class=\"p\">));</span>\n\t\t\t<span class=\"k\">break</span><span class=\"p\">;</span>\n\t\t<span class=\"p\">&#125;</span>\n\t\t<span class=\"nl\">default:</span>\n\t\t\t<span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&#34;%s&#34;</span><span class=\"p\">,</span> <span class=\"n\">lua_typename</span><span class=\"p\">(</span><span class=\"n\">L</span><span class=\"p\">,</span> <span class=\"n\">t</span><span class=\"p\">));</span>\n\t\t\t<span class=\"k\">break</span><span class=\"p\">;</span>\n\t\t<span class=\"p\">&#125;</span>\n\t\t<span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&#34; &#34;</span><span class=\"p\">);</span>\n\t<span class=\"p\">&#125;</span>\n\t<span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&#34;</span><span class=\"se\">n</span><span class=\"s\">&#34;</span><span class=\"p\">);</span>\n<span class=\"p\">&#125;</span>\n<p><span class=\"k\">static</span> <span class=\"kt\">void</span> <span class=\"nf\">test</span><span class=\"p\">()</span> <span class=\"p\">&#123;</span><br />\n<span class=\"n\">lua_State</span><span class=\"o\">*</span> <span class=\"n\">L</span> <span class=\"o\">=</span> <span class=\"n\">luaL_newstate</span><span class=\"p\">();</span></p>\n<pre><code>&lt;span class=&quot;n&quot;&gt;lua_pushboolean&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n&lt;span class=&quot;n&quot;&gt;lua_pushnumber&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n&lt;span class=&quot;n&quot;&gt;lua_pushnil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n&lt;span class=&quot;n&quot;&gt;lua_pushstring&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;#34;hello&amp;#34;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;\n&lt;span class=&quot;n&quot;&gt;stackDump&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//true 10 nil hello\n</code></pre>\n<p></span>\t<span class=\"n\">lua_pushvalue</span><span class=\"p\">(</span><span class=\"n\">L</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mi\">4</span><span class=\"p\">);</span><span class=\"c1\">//将指定索引的值压到栈顶<br />\n</span>\t<span class=\"n\">stackDump</span><span class=\"p\">(</span><span class=\"n\">L</span><span class=\"p\">);</span> <span class=\"c1\">//true 10 nil hello true<br />\n</span>\t<span class=\"n\">lua_replace</span><span class=\"p\">(</span><span class=\"n\">L</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">);</span><span class=\"c1\">//pop栈顶元素，并将pop的值设置到指定索引<br />\n</span>\t<span class=\"n\">stackDump</span><span class=\"p\">(</span><span class=\"n\">L</span><span class=\"p\">);</span><span class=\"c1\">// true 10 true hello<br />\n</span>\t<span class=\"n\">lua_settop</span><span class=\"p\">(</span><span class=\"n\">L</span><span class=\"p\">,</span> <span class=\"mi\">6</span><span class=\"p\">);</span><span class=\"c1\">//设置栈中元素个数,0的话清空栈，大于原来个数补nil<br />\n</span>\t<span class=\"n\">stackDump</span><span class=\"p\">(</span><span class=\"n\">L</span><span class=\"p\">);</span><span class=\"c1\">//true 10 true hello nil nil<br />\n</span>\t<span class=\"n\">lua_rotate</span><span class=\"p\">(</span><span class=\"n\">L</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">);</span><span class=\"c1\">//旋转指定位置的值，并把栈顶元素补充过来<br />\n</span>\t<span class=\"n\">stackDump</span><span class=\"p\">(</span><span class=\"n\">L</span><span class=\"p\">);</span><span class=\"c1\">//true 10 nil true hello nil<br />\n</span>\t<span class=\"n\">lua_remove</span><span class=\"p\">(</span><span class=\"n\">L</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mi\">3</span><span class=\"p\">);</span><span class=\"c1\">//移除指定位置的值<br />\n</span>\t<span class=\"n\">stackDump</span><span class=\"p\">(</span><span class=\"n\">L</span><span class=\"p\">);</span><span class=\"c1\">//true 10 nil hello nil<br />\n</span>\t<span class=\"n\">lua_close</span><span class=\"p\">(</span><span class=\"n\">L</span><span class=\"p\">);</span><br />\n<span class=\"p\">}</span><br />\n</pre></td></tr></tbody></table></code></pre></div></div></p>\n<pre><code>            &lt;hr style=&quot;visibility: hidden;&quot;/&gt;\n            \n            &lt;hr style=&quot;visibility: hidden;&quot;/&gt;\n</code></pre>\n","text":"目录 lua堆栈操作 只有疯狂过，你才知道自己究竟能不能成功。 lua堆栈操作 针对于lua堆栈的操作。 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 ...","link":"","photos":[],"count_time":{"symbolsCount":"2.8k","symbolsTime":"3 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%9B%AE%E5%BD%95\"><span class=\"toc-text\">目录</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#lua%E5%A0%86%E6%A0%88%E6%93%8D%E4%BD%9C\"><span class=\"toc-text\">lua堆栈操作</span></a>","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Lua基本类型及Basic Functions","uid":"832209621f9ee266a7ca0e324979ce03","slug":"zl/2016-01-01-306_Lua基本类型及Basic Functions","date":"2024-04-03T03:47:35.585Z","updated":"2024-04-03T03:47:35.586Z","comments":true,"path":"api/articles/zl/2016-01-01-306_Lua基本类型及Basic Functions.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"Lua基本类型及Basic Functions &lt;/div&gt; &lt;div class=&quot;content&quot;&gt; 概述 Lua的基本类型 基本类型 e.g. function testType() print (string.format(&#...","link":"","photos":[],"count_time":{"symbolsCount":"5.2k","symbolsTime":"5 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"lua c api","uid":"a088e52eeedd5a2e08a78395ae73ef54","slug":"zl/2016-01-01-304_lua c api ","date":"2024-04-03T03:47:35.584Z","updated":"2024-04-03T03:47:35.584Z","comments":true,"path":"api/articles/zl/2016-01-01-304_lua c api .json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"一 概述 《lua c api》系列文章描述的是 C 语言作为宿主语言，与 Lua 程序通讯的 API 接口。 二 stack Lua 使用虚拟的栈与宿主 C 语言进行通讯，在栈中的每个元素都是 Lua 识别的数据类型。每当 Lua 调用 C 时，被调用的 C 函数都会得到一个新...","link":"","photos":[],"count_time":{"symbolsCount":"2.5k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}