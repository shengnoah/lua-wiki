{"title":"soluation to rails assest precompile cause server cpu usage too high","uid":"51d900f8d491ac355b082a85f5471588","slug":"zl/2016-01-01-1135_soluation to rails assest precompile cause server ","date":"2024-04-03T03:47:33.012Z","updated":"2024-04-03T03:47:33.012Z","comments":true,"path":"api/articles/zl/2016-01-01-1135_soluation to rails assest precompile cause server .json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","content":"<p>I was using Mina to deploy Rails project to Digital Ocean VPS (1GB memory)</p>\n<p><br/></p>\n<p>in mina <code class=\"highlighter-rouge\">confir/deploy.rb</code> file<br/>\nthere are one line:</p>\n<div class=\"highlighter-rouge\"><pre class=\"highlight\"><code>invoke :&#39;rails:assets_precompile&#39;\n</code></pre>\n</div>\n<p>it mean precompile assest file on server</p>\n<p><br/></p>\n<p>this it take way too long</p>\n<div class=\"highlighter-rouge\"><pre class=\"highlight\"><code>I, [2016-08-03T01:58:08.085687 #26033]  INFO -- : Writing /var/www/FS/tmp/build-147020368219820/public/assets/bootstrap.min-a624ed6e3c01894e8daa1456e852c26ce1ab4e8d52dcfd9ee4055395c9d39e5c.js\nI, [2016-08-03T01:58:08.086095 #26033]  INFO -- : Writing /var/www/FS/tmp/build-147020368219820/public/assets/bootstrap.min-a624ed6e3c01894e8daa1456e852c26ce1ab4e8d52dcfd9ee4055395c9d39e5c.js.gz\n-----&gt; Cleaning up old releases (keeping 5)\n-----&gt; Deploy finished\n-----&gt; Building\n-----&gt; Moving build to releases/12\n-----&gt; Build finished\n-----&gt; Launching\n-----&gt; Updating the current symlink\n-----&gt; Launching\nCommand phased-restart sent success\n-----&gt; Done. Deployed v12\nConnection to 107.170.237.232 closed.\n       Elapsed time: 215.61 seconds\n</code></pre>\n</div>\n<p><br/></p>\n<p>And most importantly when I run <code class=\"highlighter-rouge\">ps aux</code> <br/>\nNode.js take 97~100% CPU <br/>\nWTF</p>\n<p><br/></p>\n<h3 id=\"soluation\">Soluation:</h3>\n<ol>\n  <li>\n    <p>Upgrade you VPS memory (we choose this, upgrade from 1GB -&gt; 2GB)</p>\n  </li>\n  <li>\n    <p>Precompile localy push to Github and then deploy ( tried, work fine )</p>\n  </li>\n  <li>\n    <p>Create SWAP Space on Ubuntu ( tried, but not working on me )</p>\n  </li>\n</ol>\n<p>I saw the third soluation from here: <br/>\n<a href=\"http://stackoverflow.com/questions/22272339/rake-assetsprecompile-gets-killed-when-there-is-a-console-session-open-in-produ\">http://stackoverflow.com/questions/22272339/rake-assetsprecompile-gets-killed-when-there-is-a-console-session-open-in-produ</a></p>\n<p><br/></p>\n<p>if you got better soluation, please comment let me know, thanks</p>","text":"I was using Mina to deploy Rails project to Digital Ocean VPS (1GB memory) in mina confir/deploy.rb file there are one line: invoke :&#39;ra...","link":"","photos":[],"count_time":{"symbolsCount":"1.5k","symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#soluation\"><span class=\"toc-text\">Soluation:</span></a></li></ol>","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Erlang+Lua的一次重构","uid":"7635535fb530719b6f10fbc7f8fdcc90","slug":"zl/2016-01-01-113_Erlang+Lua的一次重构","date":"2024-04-03T03:47:33.013Z","updated":"2024-04-03T03:47:33.013Z","comments":true,"path":"api/articles/zl/2016-01-01-113_Erlang+Lua的一次重构.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"目前所在的项目基于erlang cluster搭建框架，再接入lua用于写逻辑。由于之前有一些erlang+lua的开发经验，因此着手项目的重构和优化，过程中一些体会，记录于此。 先简述一下项目架构，erlang做集群，网络层，节点交互，DB交互等，lua层只写逻辑。一个erla...","link":"","photos":[],"count_time":{"symbolsCount":"2.5k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"xcode support lua","uid":"4401d4c7e5eb56f024517d1e1ceff086","slug":"zl/2016-01-01-1136_xcode support lua","date":"2024-04-03T03:47:33.012Z","updated":"2024-04-03T03:47:33.012Z","comments":true,"path":"api/articles/zl/2016-01-01-1136_xcode support lua.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":" 在lua开发时，我是用mac开发的，需要用Xcode进行调试，这就需要Xcode支持lua,并代码高亮。但默认是不支持的，这就需要我们设置了。 ####最简单的办法: 下载Lua-In-Xcode 按照说明在shll中执行sudo ./Add-Lua.sh --beta 重启X...","link":"","photos":[],"count_time":{"symbolsCount":183,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}