{"title":"lua","uid":"df60e476b394b1dd4755ec96c53302ff","slug":"zl/2016-01-01-776_lua","date":"2024-04-03T03:47:36.012Z","updated":"2024-04-03T03:47:36.013Z","comments":true,"path":"api/articles/zl/2016-01-01-776_lua.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","content":"<h2 id=\"LuaInterface-库\"><a href=\"#LuaInterface-库\" class=\"headerlink\" title=\"LuaInterface 库\"></a>LuaInterface 库</h2><p><span class=\"exturl\" data-url=\"aHR0cDovL2x1YWZvcmdlLm5ldC9wcm9qZWN0cy9sdWFpbnRlcmZhY2Uv\" title=\"http://luaforge.net/projects/luainterface/\">LuaInterface下载地址<i class=\"fa fa-external-link\"></i></span></p>\n<ul>\n<li>LuaInterface是一个用于在Lua语言和Microsoft .NET平台的公共语言运行时（CLR）之间集成的库。 Lua脚本可以使用它来实例化CLR对象，访问属性，调用方法，甚至使用Lua函数处理事件。</li>\n<li>LuaInterface.Lua类是CLR访问Lua解释器的主要接口，一个LuaInterface.Lua类对象就代表了一个Lua解释器（或Lua执行环境），Lua解释器可以同时存在多个，并且它们之间是完全相互独立的。</li>\n</ul>\n<h2 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h2><h3 id=\"在-C-中调用-Lua\"><a href=\"#在-C-中调用-Lua\" class=\"headerlink\" title=\"在 C# 中调用 Lua\"></a>在 C# 中调用 Lua</h3><figure class=\"highlight lua\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br/><span class=\"line\">2</span><br/><span class=\"line\">3</span><br/><span class=\"line\">4</span><br/><span class=\"line\">5</span><br/><span class=\"line\">6</span><br/><span class=\"line\">7</span><br/><span class=\"line\">8</span><br/><span class=\"line\">9</span><br/><span class=\"line\">10</span><br/><span class=\"line\">11</span><br/></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br/><span class=\"line\">MyMath = {}</span><br/><span class=\"line\"></span><br/><span class=\"line\">MyMath.Name = <span class=\"string\">&#34;MyMath&#34;</span></span><br/><span class=\"line\">MyMath.PI = <span class=\"number\">3.1415</span></span><br/><span class=\"line\"></span><br/><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"params\">(first, second)</span></span></span><br/><span class=\"line\">    <span class=\"keyword\">return</span> first+second</span><br/><span class=\"line\"><span class=\"keyword\">end</span></span><br/><span class=\"line\"></span><br/><span class=\"line\"><span class=\"keyword\">return</span> MyMath</span><br/></pre></td></tr></tbody></table></figure>\n<figure class=\"highlight csharp\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br/><span class=\"line\">2</span><br/><span class=\"line\">3</span><br/><span class=\"line\">4</span><br/><span class=\"line\">5</span><br/><span class=\"line\">6</span><br/><span class=\"line\">7</span><br/><span class=\"line\">8</span><br/><span class=\"line\">9</span><br/><span class=\"line\">10</span><br/><span class=\"line\">11</span><br/><span class=\"line\">12</span><br/><span class=\"line\">13</span><br/><span class=\"line\">14</span><br/><span class=\"line\">15</span><br/><span class=\"line\">16</span><br/><span class=\"line\">17</span><br/><span class=\"line\">18</span><br/><span class=\"line\">19</span><br/><span class=\"line\">20</span><br/><span class=\"line\">21</span><br/><span class=\"line\">22</span><br/><span class=\"line\">23</span><br/><span class=\"line\">24</span><br/><span class=\"line\">25</span><br/><span class=\"line\">26</span><br/><span class=\"line\">27</span><br/><span class=\"line\">28</span><br/><span class=\"line\">29</span><br/><span class=\"line\">30</span><br/><span class=\"line\">31</span><br/><span class=\"line\">32</span><br/></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Program.cs</span></span><br/><span class=\"line\"><span class=\"keyword\">using</span> System;</span><br/><span class=\"line\"><span class=\"keyword\">using</span> LuaInterface;</span><br/><span class=\"line\"></span><br/><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title\">Program</span> {</span><br/><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">Main</span>(<span class=\"params\"><span class=\"keyword\">string</span>[] args</span>)</span> {</span><br/><span class=\"line\">        <span class=\"comment\">// 创建 Lua 解释器</span></span><br/><span class=\"line\">        Lua lua = <span class=\"keyword\">new</span> Lua();</span><br/><span class=\"line\"></span><br/><span class=\"line\">        <span class=\"comment\">// 执行 Lua 语句</span></span><br/><span class=\"line\">        lua.DoString(<span class=\"string\">&#34;print(&#39;Lua in C#&#39;)&#34;</span>);</span><br/><span class=\"line\"></span><br/><span class=\"line\">        lua.DoString(<span class=\"string\">@&#34;</span></span><br/><span class=\"line\"><span class=\"string\">            for i=1, 5, 1 do</span></span><br/><span class=\"line\"><span class=\"string\">                print(i);</span></span><br/><span class=\"line\"><span class=\"string\">            end</span></span><br/><span class=\"line\"><span class=\"string\">        &#34;</span>);</span><br/><span class=\"line\"></span><br/><span class=\"line\">        <span class=\"comment\">// 执行 Lua 文件，参数为 Lua 文件所在路径，下面 MyMath.lua 文件放在项目输出目录中</span></span><br/><span class=\"line\">        lua.DoFile(<span class=\"string\">&#34;MyMath.lua&#34;</span>);</span><br/><span class=\"line\"></span><br/><span class=\"line\">        <span class=\"comment\">// 使用 Lua 文件中的变量</span></span><br/><span class=\"line\">        Console.WriteLine(lua.GetString(<span class=\"string\">&#34;MyMath.Name&#34;</span>));</span><br/><span class=\"line\">        Console.WriteLine(lua.GetNumber(<span class=\"string\">&#34;MyMath.PI&#34;</span>));</span><br/><span class=\"line\"></span><br/><span class=\"line\">        <span class=\"comment\">// 使用 Lua 文件中的函数</span></span><br/><span class=\"line\">        LuaFunction Add = lua.GetFunction(<span class=\"string\">&#34;MyMath.Add&#34;</span>);</span><br/><span class=\"line\">        Console.WriteLine(Add.Call(<span class=\"number\">1</span>, <span class=\"number\">2</span>)[<span class=\"number\">0</span>]);</span><br/><span class=\"line\"></span><br/><span class=\"line\">        Console.ReadLine();</span><br/><span class=\"line\">    }</span><br/><span class=\"line\">}</span><br/></pre></td></tr></tbody></table></figure>\n<figure class=\"highlight plain\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br/><span class=\"line\">2</span><br/><span class=\"line\">3</span><br/><span class=\"line\">4</span><br/><span class=\"line\">5</span><br/><span class=\"line\">6</span><br/><span class=\"line\">7</span><br/><span class=\"line\">8</span><br/><span class=\"line\">9</span><br/></pre></td><td class=\"code\"><pre><span class=\"line\">Lua in C#</span><br/><span class=\"line\">1</span><br/><span class=\"line\">2</span><br/><span class=\"line\">3</span><br/><span class=\"line\">4</span><br/><span class=\"line\">5</span><br/><span class=\"line\">MyMath</span><br/><span class=\"line\">3.1415</span><br/><span class=\"line\">3</span><br/></pre></td></tr></tbody></table></figure>\n<h3 id=\"在-Lua-中调用-C\"><a href=\"#在-Lua-中调用-C\" class=\"headerlink\" title=\"在 Lua 中调用 C\"></a>在 Lua 中调用 C</h3><pre><code>测试项目名称：CSharpAndLua\n</code></pre><figure class=\"highlight csharp\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br/><span class=\"line\">2</span><br/><span class=\"line\">3</span><br/><span class=\"line\">4</span><br/><span class=\"line\">5</span><br/><span class=\"line\">6</span><br/><span class=\"line\">7</span><br/><span class=\"line\">8</span><br/><span class=\"line\">9</span><br/><span class=\"line\">10</span><br/><span class=\"line\">11</span><br/><span class=\"line\">12</span><br/><span class=\"line\">13</span><br/><span class=\"line\">14</span><br/><span class=\"line\">15</span><br/></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Tools.cs</span></span><br/><span class=\"line\"><span class=\"keyword\">using</span> System;</span><br/><span class=\"line\"></span><br/><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title\">CSharpAndLuaTest</span> {</span><br/><span class=\"line\">    <span class=\"keyword\">class</span> <span class=\"title\">Tools</span> {</span><br/><span class=\"line\"></span><br/><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">Show</span>(<span class=\"params\"></span>)</span> {</span><br/><span class=\"line\">            Console.WriteLine(<span class=\"string\">&#34;Show something ... &#34;</span>);</span><br/><span class=\"line\">        }</span><br/><span class=\"line\"></span><br/><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Print</span>(<span class=\"params\"></span>)</span> {</span><br/><span class=\"line\">            Console.WriteLine(<span class=\"string\">&#34;This is member method.&#34;</span>);</span><br/><span class=\"line\">        }</span><br/><span class=\"line\">    }</span><br/><span class=\"line\">}</span><br/></pre></td></tr></tbody></table></figure>\n<figure class=\"highlight lua\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br/><span class=\"line\">2</span><br/><span class=\"line\">3</span><br/><span class=\"line\">4</span><br/><span class=\"line\">5</span><br/><span class=\"line\">6</span><br/><span class=\"line\">7</span><br/><span class=\"line\">8</span><br/><span class=\"line\">9</span><br/></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- Main.lua</span></span><br/><span class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">&#34;luanet&#34;</span>)   <span class=\"comment\">-- 引用 luanet 程序集</span></span><br/><span class=\"line\">luanet.load_assembly(<span class=\"string\">&#34;CSharpAndLua&#34;</span>) <span class=\"comment\">-- 加载程序集</span></span><br/><span class=\"line\">Tools = luanet.import_type(<span class=\"string\">&#34;CSharpAndLuaTest.Tools&#34;</span>); <span class=\"comment\">-- 引用类型</span></span><br/><span class=\"line\"></span><br/><span class=\"line\">Tools.Show();   <span class=\"comment\">-- 调用静态方法</span></span><br/><span class=\"line\"></span><br/><span class=\"line\">myTools = Tools()</span><br/><span class=\"line\">myTools:Print() <span class=\"comment\">-- 调用成员方法</span></span><br/></pre></td></tr></tbody></table></figure>\n<figure class=\"highlight csharp\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br/><span class=\"line\">2</span><br/><span class=\"line\">3</span><br/><span class=\"line\">4</span><br/><span class=\"line\">5</span><br/><span class=\"line\">6</span><br/><span class=\"line\">7</span><br/><span class=\"line\">8</span><br/><span class=\"line\">9</span><br/><span class=\"line\">10</span><br/><span class=\"line\">11</span><br/><span class=\"line\">12</span><br/><span class=\"line\">13</span><br/><span class=\"line\">14</span><br/><span class=\"line\">15</span><br/></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Program.cs</span></span><br/><span class=\"line\"><span class=\"keyword\">using</span> System;</span><br/><span class=\"line\"><span class=\"keyword\">using</span> LuaInterface;</span><br/><span class=\"line\"></span><br/><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title\">CSharpAndLua</span> {</span><br/><span class=\"line\">    <span class=\"keyword\">class</span> <span class=\"title\">Program</span> {</span><br/><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">Main</span>(<span class=\"params\"><span class=\"keyword\">string</span>[] args</span>)</span> {</span><br/><span class=\"line\">            <span class=\"comment\">// 创建 Lua 解释器</span></span><br/><span class=\"line\">            Lua lua = <span class=\"keyword\">new</span> Lua();</span><br/><span class=\"line\">            lua.DoFile(<span class=\"string\">&#34;Main.lua&#34;</span>);</span><br/><span class=\"line\"></span><br/><span class=\"line\">            Console.ReadLine();</span><br/><span class=\"line\">        }</span><br/><span class=\"line\">    }</span><br/><span class=\"line\">}</span><br/></pre></td></tr></tbody></table></figure>\n<figure class=\"highlight plain\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br/><span class=\"line\">2</span><br/></pre></td><td class=\"code\"><pre><span class=\"line\">Show something ...</span><br/><span class=\"line\">This is member method.</span><br/></pre></td></tr></tbody></table></figure>\n<h3 id=\"热更新初尝试\"><a href=\"#热更新初尝试\" class=\"headerlink\" title=\"热更新初尝试\"></a>热更新初尝试</h3><ol>\n<li>打开项目程序集所在的根目录bin</li>\n<li>更改Lua脚本代码内容</li>\n<li>运行程序集</li>\n</ol>\n<p>修改 lua 文件<br/></p><figure class=\"highlight lua\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br/><span class=\"line\">2</span><br/><span class=\"line\">3</span><br/><span class=\"line\">4</span><br/><span class=\"line\">5</span><br/><span class=\"line\">6</span><br/><span class=\"line\">7</span><br/><span class=\"line\">8</span><br/><span class=\"line\">9</span><br/><span class=\"line\">10</span><br/><span class=\"line\">11</span><br/></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- Main.lua</span></span><br/><span class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">&#34;luanet&#34;</span>)   <span class=\"comment\">-- 引用 luanet 程序集</span></span><br/><span class=\"line\">luanet.load_assembly(<span class=\"string\">&#34;CSharpAndLua&#34;</span>) <span class=\"comment\">-- 加载程序集</span></span><br/><span class=\"line\">Tools = luanet.import_type(<span class=\"string\">&#34;CSharpAndLuaTest.Tools&#34;</span>); <span class=\"comment\">-- 引用类型</span></span><br/><span class=\"line\"></span><br/><span class=\"line\">Tools.Show();   <span class=\"comment\">-- 调用静态方法</span></span><br/><span class=\"line\"></span><br/><span class=\"line\">myTools = Tools()</span><br/><span class=\"line\">myTools:Print() <span class=\"comment\">-- 调用成员方法</span></span><br/><span class=\"line\"></span><br/><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#34;Update this file.&#34;</span>)</span><br/></pre></td></tr></tbody></table></figure><br/><figure class=\"highlight plain\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br/><span class=\"line\">2</span><br/><span class=\"line\">3</span><br/></pre></td><td class=\"code\"><pre><span class=\"line\">Show something ...</span><br/><span class=\"line\">This is member method.</span><br/><span class=\"line\">Update this file.</span><br/></pre></td></tr></tbody></table></figure><p></p>","text":"LuaInterface 库LuaInterface下载地址 LuaInterface是一个用于在Lua语言和Microsoft .NET平台的公共语言运行时（CLR）之间集成的库。 Lua脚本可以使用它来实例化CLR对象，访问属性，调用方法，甚至使用Lua函数处理事件。 Lua...","link":"","photos":[],"count_time":{"symbolsCount":"2.6k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#LuaInterface-%E5%BA%93\"><span class=\"toc-text\">LuaInterface 库</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%A4%BA%E4%BE%8B\"><span class=\"toc-text\">示例</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%9C%A8-C-%E4%B8%AD%E8%B0%83%E7%94%A8-Lua\"><span class=\"toc-text\">在 C# 中调用 Lua</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%9C%A8-Lua-%E4%B8%AD%E8%B0%83%E7%94%A8-C\"><span class=\"toc-text\">在 Lua 中调用 C</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%83%AD%E6%9B%B4%E6%96%B0%E5%88%9D%E5%B0%9D%E8%AF%95\"><span class=\"toc-text\">热更新初尝试</span></a></li></ol></li></ol>","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Lua 学习 chapter30 编写c函数的技巧","uid":"f028d85db621373afc63d8d068278fba","slug":"zl/2016-01-01-777_Lua 学习 chapter30 编写c函数的技巧 ","date":"2024-04-03T03:47:36.013Z","updated":"2024-04-03T03:47:36.015Z","comments":true,"path":"api/articles/zl/2016-01-01-777_Lua 学习 chapter30 编写c函数的技巧 .json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"目录 数组操作 字符串操作 在c函数中保存状态 生活总需要一点仪式感，然后慢慢的像那个趋向完美的自己靠近。 数组操作 Lua中的数组就是以特殊的方式使用边。像lua_setttable and lua_gettable这种用来操作的通用函数，也可以用于操作数组，不过C API为使...","link":"","photos":[],"count_time":{"symbolsCount":"4.9k","symbolsTime":"4 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Lua Learning Notes","uid":"4b8499e3ac801948195a5de99e588873","slug":"zl/2016-01-01-775_Lua Learning Notes","date":"2024-04-03T03:47:36.012Z","updated":"2024-04-03T03:47:36.012Z","comments":true,"path":"api/articles/zl/2016-01-01-775_Lua Learning Notes.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"注释 -- 单行注释 –[[ 多行注释 ]] 变量 a = &#34;string&#34; b = 10 b = nil -- &#39;b&#39; deleted local c = 0 变量没有类型, 默认为全局变量, 使用local关键字声明局部变量, 要删除变量只需要...","link":"","photos":[],"count_time":{"symbolsCount":"1.4k","symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}