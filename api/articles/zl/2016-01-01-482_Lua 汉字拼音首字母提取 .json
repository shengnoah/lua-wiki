{"title":"Lua 汉字拼音首字母提取","uid":"7210045a47c00c031b29ac526b186e4c","slug":"zl/2016-01-01-482_Lua 汉字拼音首字母提取 ","date":"2024-04-03T03:47:35.762Z","updated":"2024-04-03T03:47:35.763Z","comments":true,"path":"api/articles/zl/2016-01-01-482_Lua 汉字拼音首字母提取 .json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","content":"<p>最近项目上有个需求，需要将一些联系人数据按照拼音首字母排序。google 了一番，竟然没有找到一个合适的 Lua 解决方案。倒是找到一个 lua-pinyin，粗略翻了下源码发现其是将所有的中文返回全部完整的拼音，原理是将所有汉字对应拼音创建好数据字典，载入 Lua，之后查询这个字典，返回对应的拼音。但是这对于我这个需求来说显然是太臃肿了，我只需要返回首字母就可以了，却载入一个巨大的字典，感觉有点浪费内存，尤其是在 OR 对于 Lua 的内存是有限制的情况下。</p>\n<p>为此自己造了个轮子：<a href=\"https://github.com/ms2008/lua-resty-pyf\">lua-resty-pyf</a>，感兴趣的同学可以去 github 搜下。这里我来说下原理。</p>\n<p>如果单从排序的角度来看，我们其实完全可以利用 GBK 中文的顺序编码来解决，而且 GBK 是固定字节编码，即：两个字节(一个区码和一个位码)。我们先计算出汉字对应的 GBK 码点，之后按照码点排序就实现了首字母的排序。</p>\n<p>如果需要提取出首字母用于检索，我们就必须建立一个映射关系，把所有汉字对应的首字母全部映射进去。好在已经有个老外做了这部分的工作，这里我用 ffi 简单封装了下，暴露出了 lua 的接口。</p>\n<p>需要注意的是我们这里使用的是 Unicode 的码点。也许你现在有个疑问？不是说 Lua 5.1 以下都是不支持 Unicode 的吗？</p>\n<p>首先 lua string 是一个 raw buffer，按字节存储的，是 <code class=\"highlighter-rouge\">","text":"最近项目上有个需求，需要将一些联系人数据按照拼音首字母排序。google 了一番，竟然没有找到一个合适的 Lua 解决方案。倒是找到一个 lua-pinyin，粗略翻了下源码发现其是将所有的中文返回全部完整的拼音，原理是将所有汉字对应拼音创建好数据字典，载入 Lua，之后查询这个...","link":"","photos":[],"count_time":{"symbolsCount":598,"symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"toc":"","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Openrestry(Nginx+Lua)之WAF实现","uid":"80e34abb1affa04007019ffdefc3854a","slug":"zl/2016-01-01-481_Openrestry(Nginx+Lua)之WAF实现","date":"2024-04-03T03:47:35.762Z","updated":"2024-04-03T03:47:35.762Z","comments":true,"path":"api/articles/zl/2016-01-01-481_Openrestry(Nginx+Lua)之WAF实现.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":" &lt;div class=&quot;page-date&quot;&gt; &lt;span id=&quot;busuanzi_container_page_pv&quot;&gt; | 本文阅读量：&lt;span id=&quot;busuanzi_value_pag...","link":"","photos":[],"count_time":{"symbolsCount":"11k","symbolsTime":"10 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"nginx+lua动态改变upstream","uid":"b58a8ea534954f9808bf7947f17026eb","slug":"zl/2016-01-01-47_nginx+lua动态改变upstream","date":"2024-04-03T03:47:35.761Z","updated":"2024-04-03T03:47:35.761Z","comments":true,"path":"api/articles/zl/2016-01-01-47_nginx+lua动态改变upstream.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"在做毕设的时候需要动态改变通过nginx代理的服务器数量。背景大概是我有一个generator不断产生负载打在nginx上，还有一个monitor根据generator生成负载的qps来动态决定需要多少台服务器刚好能够承担这个qps的请求，因此需要动态修改nginx中的upstr...","link":"","photos":[],"count_time":{"symbolsCount":"6.4k","symbolsTime":"6 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}