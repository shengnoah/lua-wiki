{"title":"Lua学习笔记","uid":"d112c00bf05f368c0020529ea6c8efaf","slug":"zl/2016-01-01-8_Lua学习笔记","date":"2024-04-03T03:47:36.171Z","updated":"2024-04-03T03:47:36.172Z","comments":true,"path":"api/articles/zl/2016-01-01-8_Lua学习笔记.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","content":"<pre><code>\t&lt;p&gt;关于Lua的&lt;a href=&quot;http://www.lua.org/about.html&quot; target=&quot;_blank&quot; rel=&quot;external noopener noreferrer&quot;&gt;官方定义&lt;/a&gt;：&lt;/p&gt;\n</code></pre>\n<p>别的我就不多安利了</p>\n<h2 id=\"type\">type</h2>\n<h3 id=\"table\">table</h3>\n<p>table是类似class的hash_map，由data和method两部分组成。简而言之，数据和行为是分离的，后者在Lua中称为metatable。<br>metatable有很多特有的键，在此我们粗暴的认为特有键类似c++中的操作符，它们的值一般为function或table。</p>\n<h4 id=\"setmetatable\">setmetatable</h4>\n<p>我们可以通过setmetatable来赋予table不同的动作。</p>\n<figure class=\"highlight lua\"><table><tr>\n<td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td>\n<td class=\"code\"><pre><span class=\"line\">t = {}              </span><br><span class=\"line\">mt = {}             </span><br><span class=\"line\"><span class=\"built_in\">setmetatable</span>(t, mt) <span class=\"comment\">-- 设定mt为t的metatable</span></span><br><span class=\"line\"><span class=\"built_in\">getmetatable</span>(t)     <span class=\"comment\">-- 返回mt</span></span><br></pre></td>\n</tr></table></figure>\n<p>以上代码可以缩略为：<br><figure class=\"highlight lua\"><table><tr>\n<td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td>\n<td class=\"code\"><pre><span class=\"line\">t = <span class=\"built_in\">setmetatable</span>({}, {})</span><br></pre></td>\n</tr></table></figure></p>\n<h4 id=\"__index与__newindex\">__index与__newindex</h4>\n<figure class=\"highlight lua\"><table><tr>\n<td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td>\n<td class=\"code\"><pre><span class=\"line\">other = {}</span><br><span class=\"line\">t = <span class=\"built_in\">setmetatable</span>({}, { __newindex = other })</span><br><span class=\"line\">t.foo = <span class=\"number\">3</span></span><br><span class=\"line\">t.foo     <span class=\"comment\">-- nil</span></span><br><span class=\"line\">other.foo <span class=\"comment\">-- 3</span></span><br><span class=\"line\">t = <span class=\"built_in\">setmetatable</span>({}, { __index = other })</span><br><span class=\"line\">t.foo     <span class=\"comment\">-- 3</span></span><br><span class=\"line\">other.foo <span class=\"comment\">-- 3</span></span><br></pre></td>\n</tr></table></figure>\n<ul>\n<li>\n<code>__index</code>类似于<code>[]</code>操作符</li>\n<li>\n<code>__newindex</code>类似于<code>[]=</code>操作符</li>\n</ul>\n<figure class=\"highlight lua\"><table><tr>\n<td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td>\n<td class=\"code\"><pre><span class=\"line\">t = <span class=\"built_in\">setmetatable</span>({}, {</span><br><span class=\"line\">  __newindex = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(t, key, value)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">type</span>(value) == <span class=\"string\">\"number\"</span> <span class=\"keyword\">then</span></span><br><span class=\"line\">      <span class=\"built_in\">rawset</span>(t, key, value * value)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      <span class=\"built_in\">rawset</span>(t, key, value)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\">t.foo = <span class=\"string\">\"foo\"</span></span><br><span class=\"line\">t.foo <span class=\"comment\">-- \"foo\"</span></span><br><span class=\"line\">t.bar = <span class=\"number\">4</span></span><br><span class=\"line\">t.bar <span class=\"comment\">-- 16</span></span><br></pre></td>\n</tr></table></figure>\n<ul>\n<li>\n<code>rawget</code>和<code>rawset</code>可以避免调用重载后的操作符（__index和__newindex）</li>\n</ul>\n<h4 id=\"__tostring\">__tostring</h4>\n<figure class=\"highlight lua\"><table><tr>\n<td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td>\n<td class=\"code\"><pre><span class=\"line\">t = <span class=\"built_in\">setmetatable</span>({ <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span> }, {</span><br><span class=\"line\">  __tostring = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(t)</span></span></span><br><span class=\"line\">    sum = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> _, v <span class=\"keyword\">in</span> <span class=\"built_in\">pairs</span>(t) <span class=\"keyword\">do</span> sum = sum + v <span class=\"keyword\">end</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"Sum: \"</span> .. sum</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(t) <span class=\"comment\">-- prints out \"Sum: 6\"</span></span><br></pre></td>\n</tr></table></figure>\n<h4 id=\"operator\">operator</h4>\n<p>运算符只能是函数</p>\n<ul>\n<li>__add</li>\n<li>__sub</li>\n<li>__mul</li>\n<li>__div</li>\n<li>__mod</li>\n<li>__unm</li>\n<li>__concat</li>\n<li>__eq</li>\n<li>__lt</li>\n<li>__le</li>\n</ul>\n<h3 id=\"function\">function</h3>\n<p>一个机智的计数器</p>\n<figure class=\"highlight lua\"><table><tr>\n<td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td>\n<td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"params\">()</span></span></span><br><span class=\"line\">    <span class=\"keyword\">local</span> i = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span></span><br><span class=\"line\">        i = i + <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> i</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\">newCounter1 = InitCounter()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(newCounter1()) <span class=\"comment\">-- 1</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(newCounter1()) <span class=\"comment\">-- 2</span></span><br><span class=\"line\">newCounter2 = InitCounter()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(newCounter2()) <span class=\"comment\">-- 1</span></span><br></pre></td>\n</tr></table></figure>\n<h2 id=\"wheel\">wheel</h2>\n<p>德堪邀请我入坑，考虑了一下还是可行的。<br>现在手头还没拿到项目，所以自己造轮子玩。</p>","text":" &lt;p&gt;关于Lua的&lt;a href=&quot;http://www.lua.org/about.html&quot; target=&quot;_blank&quot; rel=&quot;external noopener noreferrer&quot;&...","link":"","photos":[],"count_time":{"symbolsCount":"1.6k","symbolsTime":"1 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#type\"><span class=\"toc-text\">type</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#table\"><span class=\"toc-text\">table</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#setmetatable\"><span class=\"toc-text\">setmetatable</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#__index%E4%B8%8E__newindex\"><span class=\"toc-text\">__index与__newindex</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#__tostring\"><span class=\"toc-text\">__tostring</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#operator\"><span class=\"toc-text\">operator</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#function\"><span class=\"toc-text\">function</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#wheel\"><span class=\"toc-text\">wheel</span></a></li></ol>","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Lua数据结构的实现","uid":"5670ddb0c3e7d5212a221b327730f4a2","slug":"zl/2016-01-01-903_Lua数据结构的实现","date":"2024-04-03T03:47:36.172Z","updated":"2024-04-03T03:47:36.176Z","comments":true,"path":"api/articles/zl/2016-01-01-903_Lua数据结构的实现.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":" 《Lua程序设计》笔记：高效地使用table来实现一些传统的数据结构 1 数组Lua库和长度操作符都遵循索引从1开始的约定。 2 多维数组123456789101112131415mt = {}for i=1, N do mt[i] = {} for j=1, M do mt[...","link":"","photos":[],"count_time":{"symbolsCount":"2.1k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"【leetcode】 399 Evaluate Division","uid":"08d7b5270d0c73bad7990bd645f47b7c","slug":"zl/2016-01-01-897_【leetcode】 399 Evaluate Division","date":"2024-04-03T03:47:36.170Z","updated":"2024-04-03T03:47:36.170Z","comments":true,"path":"api/articles/zl/2016-01-01-897_【leetcode】 399 Evaluate Division.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"给出一些等式，求给定表达式的结果 描述方程式以A/B=k格式给出，其中A和B是用字符串表示的变量，k是实数（浮点数）。给定一些查询，返回答案。如果答案不存在，返回-1。 比如给定: A / B = 2.0，B / C = 3.0。要求: A / C = ？ B / A = ？ A...","link":"","photos":[],"count_time":{"symbolsCount":"2.6k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}