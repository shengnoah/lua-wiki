{"title":"Lua中ipairs和pairs的区别与使用","uid":"ee708369e43d7b01905981d2b3485e2f","slug":"zl/2016-01-01-254_Lua中ipairs和pairs的区别与使用","date":"2024-04-03T03:47:33.119Z","updated":"2024-04-03T03:47:33.120Z","comments":true,"path":"api/articles/zl/2016-01-01-254_Lua中ipairs和pairs的区别与使用.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","content":"<pre><code>    &lt;div class=&quot;post-nav&quot;&gt;\n      &lt;div class=&quot;post-nav-next post-nav-item&quot;&gt;\n        \n          &lt;a href=&quot;https://hulinhong.com/2015/11/11/lua_cpp_toluapp_tutorial/&quot; rel=&quot;next&quot; title=&quot;tolua++安装&quot;&gt;\n            &lt;i class=&quot;fa fa-chevron-left&quot;&gt;&lt;/i&gt; \n            &lt;p class=&quot;post-nav-pre-next-title&quot;&gt;\n              tolua++安装\n            &lt;/p&gt; \n          &lt;/a&gt;\n        \n      &lt;/div&gt;\n\n      &lt;span class=&quot;post-nav-divider&quot;&gt;&lt;/span&gt;\n\n      &lt;div class=&quot;post-nav-prev post-nav-item&quot;&gt;\n        \n          &lt;a href=&quot;https://hulinhong.com/2015/11/11/lua_cpp_bind/&quot; rel=&quot;prev&quot; title=&quot;C++与Lua本质原始交互API&quot;&gt;\n          &lt;p class=&quot;post-nav-pre-next-title&quot;&gt;\n              C++与Lua本质原始交互API\n          &lt;/p&gt; \n          &lt;i class=&quot;fa fa-chevron-right&quot;&gt;&lt;/i&gt;\n          &lt;/a&gt;\n        \n      &lt;/div&gt;\n    &lt;/div&gt;\n  \n\n  \n  \n\n  \n  \n\n  \n    &lt;p&gt;关于ipairs()和pairs(),Lua官方手册是这样说明的：&lt;/p&gt;\n</code></pre>\n<p><strong>pairs (t)</strong></p>\n<p>If t has a metamethod __pairs, calls it with t as argument and returns the first three results from the call.</p>\n<p>Otherwise, returns three values: the next function, the table t, and nil, so that the construction</p>\n<pre><code>` for k,v in pairs(t) do body end`\n</code></pre><p>will iterate over all key–value pairs of table t.</p>\n<p>See function next for the caveats of modifying the table during its traversal.</p>\n<p><strong>ipairs (t)</strong></p>\n<p>If t has a metamethod __ipairs, calls it with t as argument and returns the first three results from the call.</p>\n<p>Otherwise, returns three values: an iterator function, the table t, and 0, so that the construction</p>\n<pre><code>` for i,v in ipairs(t) do body end`\n</code></pre><p>will iterate over the pairs (1,t[1]), (2,t[2]), …, up to the first integer key absent from the table.</p>\n<p>根据官方手册的描述，pairs会遍历表中所有的key-value值，而pairs会根据key的数值从1开始加1递增遍历对应的table[i]值，直到出现第一个不是按1递增的数值时候退出。</p>\n<p><strong>. . .</strong></p>\n<p>下面我们以例子说明一下吧<br><figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stars = {[<span class=\"number\">1</span>] = <span class=\"string\">\"Sun\"</span>, [<span class=\"number\">2</span>] = <span class=\"string\">\"Moon\"</span>, [<span class=\"number\">5</span>] = <span class=\"string\">'Earth'</span>}</span><br><span class=\"line\"><span class=\"keyword\">for</span> i, v <span class=\"keyword\">in</span> <span class=\"built_in\">pairs</span>(stars) <span class=\"keyword\">do</span></span><br><span class=\"line\">   <span class=\"built_in\">print</span>(i, v)</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure></p>\n<p>使用pairs()将会遍历表中所有的数据，输出结果是：</p>\n<pre><code>1    Sun\n2    Moon\n5    Earth\n</code></pre><p>如果使用ipairs（）的话，</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> i, v <span class=\"keyword\">in</span> <span class=\"built_in\">ipairs</span>(stars) <span class=\"keyword\">do</span></span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"built_in\">print</span>(i, v)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n<p>当i的值遍历到第三个元素时，i的值为5，此时i并不是上一个次i值（2）的+1递增，所以遍历结束，结果则会是：</p>\n<pre><code>1    Sun\n2    Moon\n</code></pre><p>ipairs()和pairs()的区别就是这么简单。</p>\n<p>还有一个要注意的是pairs()的一个问题，用pairs()遍历是[key]-[value]形式的表是随机的，跟key的哈希值有关系。看以下这个例子：</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stars = {[<span class=\"number\">1</span>] = <span class=\"string\">\"Sun\"</span>, [<span class=\"number\">2</span>] = <span class=\"string\">\"Moon\"</span>, [<span class=\"number\">3</span>] = <span class=\"string\">\"Earth\"</span>, [<span class=\"number\">4</span>] = <span class=\"string\">\"Mars\"</span>, [<span class=\"number\">5</span>] = <span class=\"string\">\"Venus\"</span>}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i, v <span class=\"keyword\">in</span> <span class=\"built_in\">pairs</span>(stars) <span class=\"keyword\">do</span></span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"built_in\">print</span>(i, v)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n<p>结果是：</p>\n<pre><code>2    Moon\n3    Earth\n1    Sun\n4    Mars\n5    Venus\n</code></pre><p>并没有按照其在表中的顺序输出。</p>\n<p>但是如果是这样定义表stars的话</p>\n<p><code>stars = &#123;\"Sun\", \"Moon\",  “Earth”, \"Mars\",  \"Venus\"&#125;</code></p>\n<p>结果则会是</p>\n<pre><code>1    Sun\n2    Moon\n3    Earth\n4    Mars\n5    Venus\n</code></pre><p>你清楚了吗？:)</p>","text":" &lt;div class=&quot;post-nav&quot;&gt; &lt;div class=&quot;post-nav-next post-nav-item&quot;&gt; &lt;a href=&quot;https://hulinhong.com/201...","link":"","photos":[],"count_time":{"symbolsCount":"2.7k","symbolsTime":"2 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"toc":"","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Lua源码阅读：数据结构与栈","uid":"9537102a666b3e62277312d5e670a702","slug":"zl/2016-01-01-255_Lua源码阅读：数据结构与栈","date":"2024-04-03T03:47:33.120Z","updated":"2024-04-03T03:47:33.120Z","comments":true,"path":"api/articles/zl/2016-01-01-255_Lua源码阅读：数据结构与栈.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":" &lt;p&gt;承接上篇虚拟机概述，解析函数执行流程。&lt;/p&gt; 数据结构与栈：每个Lua 虚拟机对应一个 lua_State 结构体，它使用 TValue 数组来模拟栈，其中包括几个与栈相关的成员： stack：栈数组的起始位置 base：当前函数栈的基地址 to...","link":"","photos":[],"count_time":{"symbolsCount":"6k","symbolsTime":"5 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"lua学习笔记（一）","uid":"e8058bc58a0d4fd63c47f20b7d5cde34","slug":"zl/2016-01-01-253_lua学习笔记（一）","date":"2024-04-03T03:47:33.119Z","updated":"2024-04-03T03:47:33.119Z","comments":true,"path":"api/articles/zl/2016-01-01-253_lua学习笔记（一）.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":" &lt;h2 id=&quot;注释&quot;&gt;&lt;a href=&quot;https://Jaxes.github.io/#%E6%B3%A8%E9%87%8A&quot; class=&quot;headerlink&quot; title=&quot;注释&...","link":"","photos":[],"count_time":{"symbolsCount":"4.4k","symbolsTime":"4 mins."},"categories":[{"name":"topic","slug":"topic","count":1441,"path":"api/categories/topic.json"}],"tags":[{"name":"lua文章","slug":"lua文章","count":1133,"path":"api/tags/lua文章.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}