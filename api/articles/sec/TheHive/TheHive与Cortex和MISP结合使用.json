{"title":"TheHive与Cortex和MISP结合使用","uid":"83b2e025a478c2da76012dbffdf74f6e","slug":"sec/TheHive/TheHive与Cortex和MISP结合使用","date":"2024-03-14T07:45:09.052Z","updated":"2024-03-14T07:45:09.052Z","comments":true,"path":"api/articles/sec/TheHive/TheHive与Cortex和MISP结合使用.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","content":"<h1 id=\"thehive与cortex和misp结合使用\"><a class=\"markdownIt-Anchor\" href=\"#thehive与cortex和misp结合使用\"></a> TheHive与Cortex和MISP结合使用</h1>\n<p><a href=\"https://github.com/TheHive-Project/TheHive/\">TheHive</a>, <a href=\"https://github.com/TheHive-Project/Cortex/\">Cortex</a> and <a href=\"http://www.misp-project.org/\">MISP</a> work nicely together and if you’ve read our <a href=\"https://blog.thehive-project.org/2017/06/07/thehive-june-dec-17-roadmap/\">June-Dec 17 roadmap</a> post, the integration of our products with the <em>de facto</em> threat sharing platform will get better in a few months.</p>\n<p>During the <a href=\"https://first.org/conference/2017/program#pthehive-a-scalable-open-source-and-free-incident-response-platform\">FIRST conference presentation</a> we gave last week, we displayed a picture that we will use here to try to explain how these three open source and free products integrate with one another.</p>\n<p><img src=\"https://blogthehiveproject.files.wordpress.com/2017/06/screen-shot-2017-06-16-at-09-58-43.png?w=1100\" alt=\"Screen Shot 2017-06-16 at 09.58.43.png\" /></p>\n<p>A Picture is Worth a Thousand Words…</p>\n<h4 id=\"thehive\"><a class=\"markdownIt-Anchor\" href=\"#thehive\"></a> TheHive</h4>\n<p>TheHive is a Security Incident Response Platform (SIRP). It can receive alerts from different sources (SIEM, IDS, email. etc.) via its REST API. This is where alert feeders come into play.</p>\n<h5 id=\"alert-feeders\"><a class=\"markdownIt-Anchor\" href=\"#alert-feeders\"></a> Alert Feeders</h5>\n<p>Think of an alert feeder as a specialized program which consumes a security event (SIEM alert, email report, IDS alert, and so on), parses it and outputs an alert that its sends to TheHive through <a href=\"https://github.com/TheHive-Project/TheHive4py\">TheHive4py</a>, the Python library we provide to interact with TheHive’s <a href=\"https://github.com/CERT-BDF/TheHiveDocs/blob/master/api/README.md\">REST API</a>.</p>\n<p>We do not supply such feeders but developing them should be straightforward. If not, <a href=\"https://github.com/TheHive-Project/TheHive/#support\">let us know</a>  and we’ll do our best to help you out.</p>\n<h5 id=\"alerts\"><a class=\"markdownIt-Anchor\" href=\"#alerts\"></a> Alerts</h5>\n<p>Any alert sent to TheHive will show up in its <code>Alerts</code> pane. In addition to the sources mentioned above, new or updated MISP events will show up as well in that area <a href=\"https://github.com/TheHive-Project/TheHiveDocs/blob/master/admin/configuration.md#7-misp\">if you configured TheHive to connect to one or several MISP instances</a>. If so, TheHive will poll those MISP instance(s) at every <code>interval</code> looking for new or updated events. If there are any, TheHive will generate an alert which will end up in the <code>Alerts</code> pane.</p>\n<p><img src=\"https://blogthehiveproject.files.wordpress.com/2017/06/screen-shot-2017-06-18-at-15-29-51.png?w=1100\" alt=\"Screen Shot 2017-06-18 at 15.29.51.png\" /></p>\n<p>The Alerts Pane</p>\n<p>Alerts can be ignored, mark as read, previewed and imported. When an alert is imported, it becomes a case that needs to be investigated.</p>\n<h4 id=\"cases\"><a class=\"markdownIt-Anchor\" href=\"#cases\"></a> Cases</h4>\n<p><img src=\"https://blogthehiveproject.files.wordpress.com/2017/06/workflow.png?w=1100\" alt=\"workflow\" /></p>\n<p>The Workflow that is at the Heart of TheHive</p>\n<p>A case can be generated from an alert or created from scratch. It is subdivided into tasks (think identification, containment, eradication, check proxy logs, and so on) and observables (IP addresses, hashes, email addresses, domain names, URLs…). When analysts are working on tasks, they add logs as they go. In TheHive’s terminology, logs are text entries which may contain attachments to help analysts record what they have been doing. Logs can be written using Markdown or a rich-text editor.</p>\n<h5 id=\"case-templates\"><a class=\"markdownIt-Anchor\" href=\"#case-templates\"></a> Case Templates</h5>\n<p>You don’t need to add the same tasks over and over when working on cases belonging to a given category (DDoS, Malspam, APT, …). You can create custom templates to which you add tasks as shown below. This is very useful when you are dealing with alerts so that when you import them, you can select which case template you’d like to apply and there you go!</p>\n<p><img src=\"https://blogthehiveproject.files.wordpress.com/2017/06/screen-shot-2017-06-16-at-10-26-221.png?w=1100\" alt=\"Screen Shot 2017-06-16 at 10.26.22.png\" /></p>\n<p>A Sample Case Template</p>\n<h5 id=\"observables\"><a class=\"markdownIt-Anchor\" href=\"#observables\"></a> Observables</h5>\n<p>Observables can be tagged, flagged as IOCs, and analyzed. When the investigation is well in progress or completed, you may want to share the resulting IOCs or a subset of those with partners and peers. TheHive will support the ability to export that data to MISP in September 2017. Until then, you can still export your IOCs as text, CSV or as a MISP-compatible format that you can use to add them to your MISP instance using the freetext editor. TheHive can export IOCs/observables in protected (hxxps://www[.]somewhere[.]com/) or unprotected mode.</p>\n<p>Every observable must have a TLP (Traffic Light Protocol) level. By default, any added observable is considered TLP:AMBER. Please note that the TLP is taken into account by some analyzers. Wait! Analyzers?</p>\n<h4 id=\"cortex\"><a class=\"markdownIt-Anchor\" href=\"#cortex\"></a> Cortex</h4>\n<p>Cortex is our standalone analysis engine and a perfect companion for TheHive and MISP. Analysts can use it to analyze observables using its Web UI, in which case they can be submitted only one at a time. The Web UI should really be limited to quick assessments of observables before creating a case in TheHive (or in an alternate SIRP). The power of Cortex really comes into play when you <a href=\"https://github.com/TheHive-Project/CortexDocs/blob/master/api/README.md\">use its REST API</a>. TheHive speaks natively to Cortex (as MISP does). Moreover, TheHive can leverage one or several Cortex servers.</p>\n<p><img src=\"https://blogthehiveproject.files.wordpress.com/2017/06/screen-shot-2017-06-18-at-15-57-27.png?w=1100\" alt=\"Screen Shot 2017-06-18 at 15.57.27.png\" /></p>\n<p>Observable Page and List of Analyzers</p>\n<h5 id=\"analyzers\"><a class=\"markdownIt-Anchor\" href=\"#analyzers\"></a> Analyzers</h5>\n<p>As of this writing, <a href=\"https://github.com/TheHive-Project/Cortex#analyzers\">Cortex has 23 analyzers</a> which come in a total of 39 flavors and more will be available soon.</p>\n<p>An analyzer can be written in any programming language supported by Linux though all of our current analyzers are written in Python. This is because we provide a Python library called <a href=\"https://pypi.python.org/pypi/cortexutils/\">Cortexutils</a> which contains a set of utility classes that make it easier to <a href=\"https://github.com/TheHive-Project/CortexDocs/blob/master/api/how-to-create-an-analyzer.md\">write an analyzer</a> in Python.</p>\n<h5 id=\"flavors\"><a class=\"markdownIt-Anchor\" href=\"#flavors\"></a> Flavors</h5>\n<p>Analyzers such as VirusTotal, PassiveTotal or DomainTools can provide different analysis services. Let’s take VirusTotal as an example. You can scan a file or URL. That’s one flavor. You can also obtain the latest available report on <a href=\"http://VirusTotal.com\">VirusTotal.com</a> for a file, hash, domain or IP address. That’s a second flavor. So the VirusTotal analyzer has two flavors.</p>\n<p><img src=\"https://blogthehiveproject.files.wordpress.com/2017/06/screen-shot-2017-06-18-at-16-26-41.png?w=1100\" alt=\"Screen Shot 2017-06-18 at 16.26.41.png\" /></p>\n<p>How about PassiveTotal? It has 8 flavors: unique resolutions lookup, SSL certificate history lookup, malware lookup, passive DNS lookup, data enrichment lookup, SSL certificate details lookup, OSINT lookup and WHOIS data lookup.</p>\n<h5 id=\"the-misp-search-analyzer\"><a class=\"markdownIt-Anchor\" href=\"#the-misp-search-analyzer\"></a> The MISP Search Analyzer</h5>\n<p>At this point, we need to mention a special analyzer that may create some confusion if not understood correctly: the MISP Search analyzer. Thanks to it, Cortex has the ability to search observables within a MISP instance as represented by the arrow that goes from the <code>Analyzers</code> to <code>MISP</code>.</p>\n<p><img src=\"https://blogthehiveproject.files.wordpress.com/2017/06/screen_shot_2017-06-19_at_08_03_54.png?w=1100\" alt=\"Screen_Shot_2017-06-19_at_08_03_54.png\" /></p>\n<p>Search for MISP Events Containing a Given Observable</p>\n<p>When an observable is found in an event, Cortex will return the number of records found (i.e. the number of events where the observable has been found) and a list of links to those events with additional data.</p>\n<p><img src=\"https://blogthehiveproject.files.wordpress.com/2017/06/screen_shot_2017-06-19_at_08_13_16.png?w=1100\" alt=\"Screen_Shot_2017-06-19_at_08_13_16.png\" /></p>\n<p>Searching for a Hash Using the MISP Search Analyzer from the Cortex Web UI</p>\n<p><img src=\"https://blogthehiveproject.files.wordpress.com/2017/06/screen-shot-2017-06-19-at-08-17-04.png?w=1100\" alt=\"Screen Shot 2017-06-19 at 08.17.04.png\" /></p>\n<p>The Same Search Conducted from TheHive: Long Report</p>\n<p><img src=\"https://blogthehiveproject.files.wordpress.com/2017/06/screen-shot-2017-06-19-at-08-18-58.png?w=1100\" alt=\"Screen Shot 2017-06-19 at 08.18.58.png\" /></p>\n<p>Mini-Report</p>\n<p>The current version of the MISP Search analyzer can only search within a single MISP instance but in the near future, it will be able to support multiple ones.</p>\n<h5 id=\"misp-expansion-modules\"><a class=\"markdownIt-Anchor\" href=\"#misp-expansion-modules\"></a> MISP Expansion Modules</h5>\n<p>Besides its own analyzers (which include MISP Search described above), Cortex can also <a href=\"https://github.com/TheHive-Project/CortexDocs/blob/master/misp.md#invoke-misp-modules-within-cortex\">invoke MISP expansion modules</a>. These are normally used by MISP to enrich attributes within events but Cortex can also take advantage of them to analyze observables.</p>\n<p>There is some overlap between the native Cortex analyzers and MISP expansion modules. When choosing between a native analyzer or an expansion module, we highly recommend you select the former. The expansion modules are deactivated in the default Cortex configuration.</p>\n<h5 id=\"jobs\"><a class=\"markdownIt-Anchor\" href=\"#jobs\"></a> Jobs</h5>\n<p>When you submit an observable for analysis, Cortex will create a job and, if successful, it will generate an analysis report in JSON format. TheHive has the ability to parse those results and present them in a human-friendly fashion thanks to report templates we offer for free. So when you’ll submit an observable to Cortex from TheHive, you’ll get back a short (or mini) report and a long one. The first can be thought of as a really tiny <s>Exec</s> Analyst Summary while the second provides more insight and details.</p>\n<h4 id=\"calling-cortex-from-misp\"><a class=\"markdownIt-Anchor\" href=\"#calling-cortex-from-misp\"></a> Calling Cortex from MISP</h4>\n<p>In addition to the expansion modules we have just mentioned, MISP 2.4.73 and up can enrich attributes using Cortex analyzers. <a href=\"https://github.com/TheHive-Project/CortexDocs/blob/master/misp.md#invoke-cortex-analyzers-within-misp\">The configuration is pretty straightforward</a>. So if all you are concerned about is threat intelligence and sharing, you may augment your visibility into a given threat represented as a MISP event by leveraging all current 23 Cortex analyzers and any future ones.</p>\n<p><strong>Conclusion</strong></p>\n<p>TheHive, Cortex and MISP are three open source and free products that can highly aid you combat threats and keep the ‘monsters’ at bay.</p>\n<p>TheHive, as a SIRP, allows you to investigate security incident swiftly in a collaborative manner. Several analysts can work simultaneously on tasks &amp; cases . While cases can be created from scratch, TheHive can receive alerts from different sources thanks to alert feeders which consume security events generated by multiple sources and feed them into TheHive using TheHive4py Python library. TheHive can also sync to one or several MISP instances to receive new and updated events which will appear in the alert pane with all the other alerts generated by other sources. Analysts can then preview new alerts to decide whether they need to be acted upon. If so, they can transform them into investigation cases using templates.</p>\n<p>To analyze the observables collected in the course of an investigation and/or imported from a MISP event, TheHive can rely on one or several Cortex analysis engines. Cortex is another standalone product that we have developed which sole purpose is to allow you to analyze observables at scale thanks to its large number of analyzers, MISP expansion modules and any analyzer you might have developed on the side. Cortex has a REST API that can be used to empower other security products such as  ‘analytics’ software, alternate SIRPs or MISP.</p>\n<p>The highly popular threat sharing platform can indeed enrich attributes thanks to Cortex as it has a native integration with it. And in a few months, you will also be able to export cases from TheHive as MISP events that you can share with peers and partners.</p>\n<p>If you do share, you do care about our collective mission to defend the  digital assets that are under our watch from harm. So let us fight together as one.</p>\n","text":" TheHive与Cortex和MISP结合使用 TheHive, Cortex and MISP work nicely together and if you’ve read our June-Dec 17 roadmap post, the integration of o...","link":"","photos":[],"count_time":{"symbolsCount":"9.2k","symbolsTime":"8 mins."},"categories":[{"name":"安全","slug":"安全","count":38,"path":"api/categories/安全.json"}],"tags":[{"name":"Cortex","slug":"Cortex","count":3,"path":"api/tags/Cortex.json"},{"name":"MISP","slug":"MISP","count":7,"path":"api/tags/MISP.json"},{"name":"TheHive","slug":"TheHive","count":4,"path":"api/tags/TheHive.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#thehive%E4%B8%8Ecortex%E5%92%8Cmisp%E7%BB%93%E5%90%88%E4%BD%BF%E7%94%A8\"><span class=\"toc-text\"> TheHive与Cortex和MISP结合使用</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#thehive\"><span class=\"toc-text\"> TheHive</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#alert-feeders\"><span class=\"toc-text\"> Alert Feeders</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#alerts\"><span class=\"toc-text\"> Alerts</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#cases\"><span class=\"toc-text\"> Cases</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#case-templates\"><span class=\"toc-text\"> Case Templates</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#observables\"><span class=\"toc-text\"> Observables</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#cortex\"><span class=\"toc-text\"> Cortex</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#analyzers\"><span class=\"toc-text\"> Analyzers</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#flavors\"><span class=\"toc-text\"> Flavors</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#the-misp-search-analyzer\"><span class=\"toc-text\"> The MISP Search Analyzer</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#misp-expansion-modules\"><span class=\"toc-text\"> MISP Expansion Modules</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#jobs\"><span class=\"toc-text\"> Jobs</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#calling-cortex-from-misp\"><span class=\"toc-text\"> Calling Cortex from MISP</span></a></li></ol></li></ol></li></ol></li></ol>","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"","uid":"f73a8e23e6f6f669cf99c7dba8fa0722","slug":"sec/TheHive/TheHive与Cortex和MISP它们是如何组合在一起的","date":"2024-03-14T07:45:09.052Z","updated":"2024-03-14T07:45:09.052Z","comments":true,"path":"api/articles/sec/TheHive/TheHive与Cortex和MISP它们是如何组合在一起的.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":"hive、Cortex和MISP可以很好地协同工作，如果你已经阅读了我们6月- 12月17日的路线图，我们的产品与事实上的威胁共享平台的集成将在几个月内变得更好。 在上周的第一次会议演示中，我们展示了一张图片，我们将在这里使用它来解释这三种开源和免费产品是如何相互集成的。 一、T...","link":"","photos":[],"count_time":{"symbolsCount":"3.3k","symbolsTime":"3 mins."},"categories":[],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Thehive中调查案例管理","uid":"2136659a0ceec5506b9726a200666f21","slug":"sec/TheHive/TheHive中调查案例管理","date":"2024-03-14T07:45:09.052Z","updated":"2024-03-14T07:45:09.052Z","comments":true,"path":"api/articles/sec/TheHive/TheHive中调查案例管理.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":"https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg","text":" Thehive中调查案例管理 我花了很长时间寻找一个案例管理系统，我认为它适合分析人员实际执行调查的构造。大多数案例管理系统实际上只是经过改造以适应安全用例的帮助台ticket系统。这是我在soc使用补救、RTIR或OTRS等工具时经常看到的。去年11月，法国CERT Banq...","link":"","photos":[],"count_time":{"symbolsCount":"3.3k","symbolsTime":"3 mins."},"categories":[{"name":"安全","slug":"安全","count":38,"path":"api/categories/安全.json"}],"tags":[{"name":"TheHive","slug":"TheHive","count":4,"path":"api/tags/TheHive.json"}],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}